{"version":3,"sources":["webpack:///./common/static/xmodule/modules/js/001-3918b2d4f383c04fed8227cc9f523d6e.js","webpack:///./common/static/xmodule/modules/js/002-21fbfeacf374a272557610f54a4c1aa2.js","webpack:///./common/static/xmodule/modules/js/004-b0c34afa95eaa6b45d843d92ca523a94.js","webpack:///./common/static/xmodule/modules/js/005-24473527e489aa133bd57ca2ab10c21b.js","webpack:///external \"jQuery\"?0cb8************","webpack:///external \"_\"?b3b9**********"],"names":["JavascriptLoader","executeModuleScripts","el","callback","callbackCalled","completed","completionHandlerGenerator","loaded","placeholders","find","length","i","ref","results","push","index","allComplete","flag","len","undefined","each","placeholder","s","src","$","attr","document","createElement","setAttribute","onload","appendChild","remove","call","window","indexOfHelper","indexOf","item","Problem","element","that","hint_button","prototype","apply","arguments","enableSubmitButtonAfterTimeout","enableSubmitButtonAfterResponse","enableSubmitButton","enable","changeText","disableAllButtonsWhileRunning","operationCallback","isFromCheckOperation","submitAnswersAndSubmitButton","bind","refreshAnswers","updateMathML","jax","refreshMath","event","save_internal","save","gentle_alert","msg","clear_all_notifications","show","reset_internal","reset","get_sr_status","contents","submit_internal","submit","submit_fd","focus_on_save_notification","focus_on_hint_notification","focus_on_submit_notification","focus_on_notification","type","scroll_to_problem_meta","submit_save_waitfor","setupInputTypes","poll","prevTimeout","focusCallback","queueing","forceUpdate","response","updateProgress","renderProgressState","id","data","element_id","url","content","has_timed_out","has_response","render","selector","problemPrefix","MathJax","Hub","Queue","hasOwnProperty","update_schematics","replace","inputs","click","reviewButton","submitButton","submitButtonLabel","submitButtonSubmitText","text","submitButtonSubmittingText","hintButton","resetButton","showButton","saveButton","saveNotification","showAnswerNotification","gentleAlertNotification","submitNotification","focus","ev","icon","target","children","globalTooltipManager","openTooltip","blur","hide","removeClass","addClass","bindResetCorrectness","Collapsible","setCollapsibles","keyup","graded","progress","progressTemplate","curScore","totalScore","attemptsUsed","ngettext","interpolate","earned","num_points","possible","progress_changed","current_score","total_possible","attempts_used","trigger","queued_items","num_queued_items","queuePollerID","clearTimeout","setTimeout","previousTimeout","postWithPrefix","newTimeout","new_queued_items","html","edx","setHtml","HTML","promise","done","gettext","inputAjax","inputId","dispatch","input_id","inputtypeDisplays","inputtype","classes","cls","setupMethod","split","inputtypeSetupMethods","inp","is","e","name","alert","message","questionTitle","animate","scrollTop","offset","top","notification","hintIndex","abortSubmission","error","errorHtml","errors","fd","fileNotSelected","fileTooLarge","maxFileSize","requiredFilesNotSubmitted","settings","timeoutId","unallowedFileSubmitted","FormData","allowedFiles","file","maxSize","requiredFiles","loopI","loopLen","files","StringUtils","filename","splice","size","append","value","processData","contentType","complete","success","Logger","log","answers","ajaxWithPrefix","SR","readTexts","addedStatus","ariaLabel","labeledStatus","parentSection","statusElement","template","closest","label","status","readText","problem","key","safeKey","answer","isArray","display","showMethod","inputtypeShowAnswerMethods","correct_status_html","saveMessage","elid","eqn","mathjaxPreprocessor","preprocessorTag","getAllJax","val","root","toMathML","exception","restart","Callback","After","schematic","update_value","CodeMirror","serialize","answered","atLeastOneTextInputFound","oneTextInputFilled","textField","on","choicegroupBlock","checked","j","checkboxOrRadio","removeAttr","selectField","selectedOption","trim","$inputtypes","add","bindMethod","bindResetCorrectnessByInputtype","formulaequationinput","$p","parent","choicegroup","$element","match","$status","class","style","$select","textline","preprocessor","preprocessorClass","preprocessorClassName","fn","cminput","container","CodeMirrorEditor","CodeMirrorTextArea","linenumbers","mode","spaces","tabsize","Array","parseInt","join","fromTextArea","lineNumbers","indentUnit","tabSize","matchBrackets","lineWrapping","indentWithTabs","smartIndent","extraKeys","Esc","Tab","cm","replaceSelection","getInputField","correctStatusHtml","choice","$inputLabel","$inputStatus","hasClass","choicetextgroup","imageinput","canvas","types","context","rectangle","ctx","coords","rects","reg","rect","abs","height","points","width","Math","exec","stroke","fill","regions","parseCoords","coordinates","JSON","parse","region","beginPath","idx","point","moveTo","lineTo","closePath","getContext","console","fillStyle","strokeStyle","lineWidth","allButtons","initiallyEnabledButtons","filter","button","enableButtons","always","buttons","changeSubmitButtonText","forEach","disabled","submitCanBeEnabled","hintContainer","nextIndex","hint_index","hintMsgContainer","should_enable_next_hint","ImageInput","ImageInputConstructor","constructor","clickHandler","elementId","crossEl","inputEl","posX","offsetX","pageX","left","posY","offsetY","pageY","result","round","css","visibility","cktsim","T_VOLTAGE","T_CURRENT","v_newt_lim","v_abstol","i_abstol","eps","dc_max_iters","max_tran_iters","time_step_increase_factor","lte_step_decrease_factor","nr_step_decrease_factor","reltol","lterel","res_check_abs","sqrt","res_check_rel","Circuit","node_map","ntypes","initial_conditions","devices","device_map","voltage_sources","current_sources","finalized","diddc","node_index","periods","gnd_node","node","ntype","ic","finalize","N","matrix","mat_make","Gl","G","C","soln_max","abstol","solution","rhs","load_linear","n_vsrc","GV","branch","rGV","mat_rank","load_netlist","netlist","component","connections","found_ground","properties","toString","r","d","c","l","v","opamp","n","p","find_solution","load","maxiters","soln","d_sol","abssum_compare","converged","abssum_old","abssum_rhs","use_limiting","down_count","thresh","iter","mat_solve_rq","problem_node","dc","load_dc","ckt","mat_v_mult","mat_copy","iterations","tran","ntpts","tstart","tstop","probenames","no_dc","load_tran","time","q","dqdt","alpha0","alpha1","oldq","alpha2","old2q","beta0","beta1","oldc","mat_scale_add","interp_coeffs","t","t0","t1","t2","dtt0","dtt1","dtt2","dt0dt1","dt0dt2","dt1dt2","pick_step","step_index","min_shrink_factor","max_growth_factor","oldt","old2t","old3t","trapcoeff","maxlteratio","ltecheck","pred","oldsol","old2sol","old3sol","lte","lteratio","max","new_step","lte_step_ratio","pow","min_step","min","max_step","old3q","ar","algebraic","period","per","ceil","max_nsteps","ac","npts","fstart","fstop","source_name","matrixac","load_ac","delta_f","exp","LN10","phase_offset","f","omega","PI","solac","mat_solve","mag","phase","atan2","phasei","L","phase_jump","add_device","n1","n2","parse_number","Resistor","area","Diode","Capacitor","Inductor","VSource","ISource","np","nn","no","ng","A","ratio","Opamp","g","Fet","add_two_terminal","M","get_two_terminal","x","xi_minus_xj","add_conductance_l","add_conductance","add_capacitance","add_to_Gl","add_to_G","add_to_C","add_to_rhs","mat","b","scale","m","temp","B","scalea","scaleb","Nr","Mc","R","one_if_alg","row","col","dest","mat_copy_transposed","Mo","Nc","max_abs_entry","the_rank","start_col","max_v","max_row","mat_scale","max_nonzero_row","maxsumsq","rowp","Mr","sumsq","row_norm","Mrp","inner","max_col","Device","breakpoint","ord","ch","charCodeAt","default_v","slen","multiplier","charAt","start","exponent","parse_source","inflection_point","fun","slice","args","end","arg_end","arg_value","h","w","pwl_source","v1","v2","td","tr","freq","duty_cycle","Infinity","t_change","t_pw","tf","pw","t3","t4","voffset","va","sin","tv_pairs","repeat","nvals","fmod","last_t","last_v","next_t","next_v","numerator","denominator","quotient","floor","npos","nneg","anode","cathode","ais","vt","exp_arg_max","exp_max","vd","exp_arg","temp1","temp2","abs_exp_arg","d_arg","quad","gd","gain","invA","type_sign","kp","beta","lambda","vds","vgs","vgst","gmgs","ids","gds","module","schematics","getAttribute","Schematic","err","msgdiv","border","margins","padding","createTextNode","parentNode","insertBefore","background_style","element_style","thumb_style","normal_style","component_style","selected_style","grid_style","annotation_style","property_size","annotation_size","parts_map","Ground","Label","OpAmp","NFet","PFet","Probe","Ammeter","sch_clipboard","input","show_grid","grid","origin_x","origin_y","cursor_x","cursor_y","window_list","edits_allowed","parts","parts_bin","part","Part","pm","set_component","analyses","diagram_only","submit_analyses","tools","toolbar","add_tool","grid_icon","toggle_grid","enable_tool","cut_icon","cut","copy_icon","copy","paste_icon","paste","dc_analysis","setup_ac_analysis","ac_npts","ac_fstart","ac_fstop","ac_source_name","transient_analysis","tran_npts","tran_tstop","sctl_r","sctl_x","sctl_y","zctl_left","zctl_top","bg_image","tabIndex","borderStyle","borderWidth","borderColor","outline","addEventListener","schematic_mouse_move","schematic_mouse_enter","schematic_mouse_leave","schematic_mouse_down","schematic_mouse_up","schematic_mouse_wheel","schematic_double_click","schematic_key_down","schematic_key_up","status_div","status_height","connection_points","components","dragging","select_rect","wire","operating_point","dc_results","ac_results","transient_results","ctrlKey","shiftKey","altKey","cmdKey","table","rules","frame","backgroundColor","verticalAlign","colSpan","tool","wrapper","position","parts_table","cellPadding","cellSpacing","parts_per_column","part_h","toplevel","onselectstart","nextSibling","load_schematic","zoomall","part_w","add_component","new_c","remove_component","find_connections","cp","location","add_connection_point","cplist","remove_connection_point","old_location","update_connection_point","add_wire","x1","y1","x2","y2","new_wire","Wire","move_end","split_wire","y","dx","dy","check_wires","cc","bisect","redraw_background","check_connection_points","locn","bisect_cp","clean_up_wires","c1","c2","e1","other_end","e2","e3","collinear","unselect_all","which","set_select","drag_begin","selected","move_begin","drag_x","drag_y","drag_end","help","open","rescale","nscale","cx","cy","zoom_factor","zoom_min","zoom_max","origin_min","origin_max","zoomin","zoomout","sch_w","bbox","sch_h","scale_x","scale_y","redraw","clone","initial_value","json","label_connection_points","clear_labels","add_default_labels","next_label","label_connections","get_next_label","propagate_label","stringify","json_with_analyses","extract_circuit","find_probes","info","probe_info","npts_lbl","fstart_lbl","fstop_lbl","source_name_lbl","fields","build_input","build_table","sch","dialog","ac_analysis","x_values","flist","values","fvlist","k","y_values","z_values","probes","probe_maxv","probe_color","array_max","all_max","color","v_max","graph2","graph","graph1","tstop_lbl","probe_list","probe_names","times","tlist","tvlist","x_legend","v_values","i_values","set_property","component_name","property","lineCap","fillRect","first_x","last_x","first_y","last_y","draw_line","min_x","max_x","min_y","max_y","draw","unsel_bbox","drawImage","selections","display_voltage","display_current","arc","strokeRect","cross_cursor","draw_arc","radius","start_radians","end_radians","anticlockwise","filled","draw_text","font","fillText","HTMLCanvasElement","relMouseCoords","totalOffsetX","totalOffsetY","currentElement","offsetLeft","offsetTop","offsetParent","mouse_x","mouse_y","page_x","page_y","srcElement","code","keyCode","preventDefault","rotate","new_part","select","drawCursor","mx","my","sx","sy","zx","zy","delta","reselect","was_previously_selected","move","canonicalize","wheelDelta","detail","edit_properties","nodeValue","append_message","title","plist","getElementsByClassName","field","dialog_check_for_ENTER","body","marginBotton","ok_button","dialog_okay","margin","cancel_button","dialog_cancel","textAlign","window_close","win","a","tbl","col1","col2","className","build_select","options","option","selectedIndex","draw_y","head","close_button","Image","close_icon","cssFloat","window_close_button","window_mouse_down","background","bring_to_front","insert","wlist","zIndex","removeChild","window_mouse_move","window_mouse_up","tracking_window","removeEventListener","tip","child","hidden","backgroundImage","innerHTML","classList","search","tool_enter","tool_leave","tool_click","enabled","tname","removeAttribute","tagName","toLowerCase","stopPropagation","help_icon","CanvasRenderingContext2D","dashedLineTo","fromX","fromY","toX","toY","pattern","lt","gt","capmin","capmax","checkX","thereYet","cap","checkY","dash","ang","cos","view_limits","vmin","vmax","log_range","engineering_notation","nplaces","sign","log10","mantissa","mstring","mlen","endindex","substring","grid_pattern","cursor_pattern","y_legend","z_legend","pwidth","pheight","left_margin","top_margin","right_margin","bottom_margin","tick_length","x_min","array_min","x_max","x_limits","x_scale","plot_x","textBaseline","plot_y","y_max","y_scale","y_min","plot","y_limits","nx","ny","probe_colors_rgb","plot_z","z","z_max","z_scale","z_min","z_limits","tick_length_half","tick_delta","nz","translate","restore","cursor1_x","cursor2_x","graph_mouse_move","redraw_plot","plot_cursor","end_y","graph_x","tx","ty","z1","z2","gx","gy","cursor","part_enter","part_leave","part_mouse_down","part_mouse_up","set_location","right","offsetWidth","bottom","offsetHeight","bounding_box","between","inside","intersect","r1","r2","Component","rotation","props","conns","add_connection","offset_x","offset_y","ConnectionPoint","update_coords","transform_x","transform_y","update_location","amount","old_rotation","move_x","move_y","rot","nx1","ny1","nx2","ny2","draw_circle","rot_angle","aOrient","alignment","near","clear_label","vmap","connection_point_radius","coincident","draw_x","toFixed","globalAlpha","p1","p2","p3","near_distance","D","probe_colors","color_choice","c_e1","c_e2","diode_types","w_over_l","dim","Source","source_functions","build_content","src_types","type_select","source_type_changed","run","first","labels","div","hasChildNodes","firstChild","component_slider","ui","sname","slider","cname","pname","suffix","choices","analysis"],"mappings":"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","file":"CapaModule.js","sourcesContent":["/*** IMPORTS FROM imports-loader ***/\n(function() {\n\n(function() {\n    'use strict';\n    this.JavascriptLoader = (function() {\n        function JavascriptLoader() {\n        }\n\n        /**\n         * Set of library functions that provide common interface for javascript loading\n         * for all module types. All functionality provided by JavascriptLoader should take\n         * place at module scope, i.e. don't run jQuery over entire page.\n         *\n         * executeModuleScripts:\n         *     Scan the module ('el') for \"script_placeholder\"s, then:\n         *\n         *     1) Fetch each script from server\n         *     2) Explicitly attach the script to the <head> of document\n         *     3) Explicitly wait for each script to be loaded\n         *     4) Return to callback function when all scripts loaded\n         */\n        JavascriptLoader.executeModuleScripts = function(el, callback) {\n            var callbackCalled, completed, completionHandlerGenerator, loaded, placeholders;\n            if (!callback) {\n                callback = null; // eslint-disable-line no-param-reassign\n            }\n            placeholders = el.find('.script_placeholder');\n            if (placeholders.length === 0) {\n                if (callback !== null) {\n                    callback();\n                }\n                return [];\n            }\n            // TODO: Verify the execution order of multiple placeholders\n            completed = (function() {\n                var i, ref, results;\n                results = [];\n                for (i = 1, ref = placeholders.length; ref >= 1 ? i <= ref : i >= ref; ref >= 1 ? ++i : --i) {\n                    results.push(false);\n                }\n                return results;\n            }());\n            callbackCalled = false;\n            completionHandlerGenerator = function(index) {\n                return function() {\n                    var allComplete, flag, i, len;\n                    allComplete = true;\n                    completed[index] = true;\n                    for (i = 0, len = completed.length; i < len; i++) {\n                        flag = completed[i];\n                        if (!flag) {\n                            allComplete = false;\n                            break;\n                        }\n                    }\n                    if (allComplete && !callbackCalled) {\n                        callbackCalled = true;\n                        if (callback !== null) {\n                            return callback();\n                        }\n                    }\n                    return undefined;\n                };\n            };\n            // Keep a map of what sources we're loaded from, and don't do it twice.\n            loaded = {};\n            return placeholders.each(function(index, placeholder) {\n                var s, src;\n                // TODO: Check if the script already exists in DOM. If so, (1) copy it\n                // into memory; (2) delete the DOM script element; (3) reappend it.\n                // This would prevent memory bloat and save a network request.\n                src = $(placeholder).attr('data-src');\n                if (!(src in loaded)) {\n                    loaded[src] = true;\n                    s = document.createElement('script');\n                    s.setAttribute('src', src);\n                    s.setAttribute('type', 'text/javascript');\n                    s.onload = completionHandlerGenerator(index);\n                    // Need to use the DOM elements directly or the scripts won't execute properly.\n                    $('head')[0].appendChild(s);\n                } else {\n                    // just call the completion callback directly, without reloading the file\n                    completionHandlerGenerator(index)();\n                }\n                return $(placeholder).remove();\n            });\n        };\n\n        return JavascriptLoader;\n    }());\n}).call(this);\n\n}.call(window));\n\n\n// WEBPACK FOOTER //\n// ./common/static/xmodule/modules/js/001-3918b2d4f383c04fed8227cc9f523d6e.js","/*** IMPORTS FROM imports-loader ***/\n(function() {\n\n/* global MathJax, Collapsible, interpolate, JavascriptLoader, Logger, CodeMirror */\n// Note: this code was originally converted from CoffeeScript, and thus follows some\n// coding conventions that are discouraged by eslint. Some warnings have been suppressed\n// to avoid substantial rewriting of the code. Allow the eslint suppressions to exceed\n// the max line length of 120.\n/* eslint max-len: [\"error\", 120, { \"ignoreComments\": true }] */\n\n(function() {\n    'use strict';\n    var indexOfHelper = [].indexOf ||\n        function(item) {\n            var i, len;\n            for (i = 0, len = this.length; i < len; i++) {\n                if (i in this && this[i] === item) {\n                    return i;\n                }\n            }\n            return -1;\n        };\n\n    this.Problem = (function() {\n        function Problem(element) {\n            var that = this;\n            this.hint_button = function() {\n                return Problem.prototype.hint_button.apply(that, arguments);\n            };\n            this.enableSubmitButtonAfterTimeout = function() {\n                return Problem.prototype.enableSubmitButtonAfterTimeout.apply(that, arguments);\n            };\n            this.enableSubmitButtonAfterResponse = function() {\n                return Problem.prototype.enableSubmitButtonAfterResponse.apply(that, arguments);\n            };\n            this.enableSubmitButton = function(enable, changeText) {\n                if (changeText === null || changeText === undefined) {\n                    changeText = true; // eslint-disable-line no-param-reassign\n                }\n                return Problem.prototype.enableSubmitButton.apply(that, arguments);\n            };\n            this.disableAllButtonsWhileRunning = function(\n                operationCallback, isFromCheckOperation // eslint-disable-line no-unused-vars\n            ) {\n                return Problem.prototype.disableAllButtonsWhileRunning.apply(that, arguments);\n            };\n            this.submitAnswersAndSubmitButton = function(bind) {\n                if (bind === null || bind === undefined) {\n                    bind = false;  // eslint-disable-line no-param-reassign\n                }\n                return Problem.prototype.submitAnswersAndSubmitButton.apply(that, arguments);\n            };\n            this.refreshAnswers = function() {\n                return Problem.prototype.refreshAnswers.apply(that, arguments);\n            };\n            this.updateMathML = function(jax, el) { // eslint-disable-line no-unused-vars\n                return Problem.prototype.updateMathML.apply(that, arguments);\n            };\n            this.refreshMath = function(event, el) { // eslint-disable-line no-unused-vars\n                return Problem.prototype.refreshMath.apply(that, arguments);\n            };\n            this.save_internal = function() {\n                return Problem.prototype.save_internal.apply(that, arguments);\n            };\n            this.save = function() {\n                return Problem.prototype.save.apply(that, arguments);\n            };\n            this.gentle_alert = function(msg) { // eslint-disable-line no-unused-vars\n                return Problem.prototype.gentle_alert.apply(that, arguments);\n            };\n            this.clear_all_notifications = function() {\n                return Problem.prototype.clear_all_notifications.apply(that, arguments);\n            };\n            this.show = function() {\n                return Problem.prototype.show.apply(that, arguments);\n            };\n            this.reset_internal = function() {\n                return Problem.prototype.reset_internal.apply(that, arguments);\n            };\n            this.reset = function() {\n                return Problem.prototype.reset.apply(that, arguments);\n            };\n            this.get_sr_status = function(contents) { // eslint-disable-line no-unused-vars\n                return Problem.prototype.get_sr_status.apply(that, arguments);\n            };\n            this.submit_internal = function() {\n                return Problem.prototype.submit_internal.apply(that, arguments);\n            };\n            this.submit = function() {\n                return Problem.prototype.submit.apply(that, arguments);\n            };\n            this.submit_fd = function() {\n                return Problem.prototype.submit_fd.apply(that, arguments);\n            };\n            this.focus_on_save_notification = function() {\n                return Problem.prototype.focus_on_save_notification.apply(that, arguments);\n            };\n            this.focus_on_hint_notification = function() {\n                return Problem.prototype.focus_on_hint_notification.apply(that, arguments);\n            };\n            this.focus_on_submit_notification = function() {\n                return Problem.prototype.focus_on_submit_notification.apply(that, arguments);\n            };\n            this.focus_on_notification = function(type) { // eslint-disable-line no-unused-vars\n                return Problem.prototype.focus_on_notification.apply(that, arguments);\n            };\n            this.scroll_to_problem_meta = function() {\n                return Problem.prototype.scroll_to_problem_meta.apply(that, arguments);\n            };\n            this.submit_save_waitfor = function(callback) { // eslint-disable-line no-unused-vars\n                return Problem.prototype.submit_save_waitfor.apply(that, arguments);\n            };\n            this.setupInputTypes = function() {\n                return Problem.prototype.setupInputTypes.apply(that, arguments);\n            };\n            this.poll = function(prevTimeout, focusCallback // eslint-disable-line no-unused-vars\n            ) {\n                return Problem.prototype.poll.apply(that, arguments);\n            };\n            this.queueing = function(focusCallback) { // eslint-disable-line no-unused-vars\n                return Problem.prototype.queueing.apply(that, arguments);\n            };\n            this.forceUpdate = function(response) { // eslint-disable-line no-unused-vars\n                return Problem.prototype.forceUpdate.apply(that, arguments);\n            };\n            this.updateProgress = function(response) { // eslint-disable-line no-unused-vars\n                return Problem.prototype.updateProgress.apply(that, arguments);\n            };\n            this.renderProgressState = function() {\n                return Problem.prototype.renderProgressState.apply(that, arguments);\n            };\n            this.bind = function() {\n                return Problem.prototype.bind.apply(that, arguments);\n            };\n            this.el = $(element).find('.problems-wrapper');\n            this.id = this.el.data('problem-id');\n            this.element_id = this.el.attr('id');\n            this.url = this.el.data('url');\n            this.content = this.el.data('content');\n\n            // has_timed_out and has_response are used to ensure that\n            // we wait a minimum of ~ 1s before transitioning the submit\n            // button from disabled to enabled\n            this.has_timed_out = false;\n            this.has_response = false;\n            this.render(this.content);\n        }\n\n        Problem.prototype.$ = function(selector) {\n            return $(selector, this.el);\n        };\n\n        Problem.prototype.bind = function() {\n            var problemPrefix,\n                that = this;\n            if (typeof MathJax !== 'undefined' && MathJax !== null) {\n                this.el.find('.problem > div').each(function(index, element) {\n                    return MathJax.Hub.Queue(['Typeset', MathJax.Hub, element]);\n                });\n            }\n            if (window.hasOwnProperty('update_schematics')) {\n                window.update_schematics();\n            }\n            problemPrefix = this.element_id.replace(/problem_/, '');\n            this.inputs = this.$('[id^=\"input_' + problemPrefix + '_\"]');\n            this.$('div.action button').click(this.refreshAnswers);\n            this.reviewButton = this.$('.notification-btn.review-btn');\n            this.reviewButton.click(this.scroll_to_problem_meta);\n            this.submitButton = this.$('.action .submit');\n            this.submitButtonLabel = this.$('.action .submit .submit-label');\n            this.submitButtonSubmitText = this.submitButtonLabel.text();\n            this.submitButtonSubmittingText = this.submitButton.data('submitting');\n            this.submitButton.click(this.submit_fd);\n            this.hintButton = this.$('.action .hint-button');\n            this.hintButton.click(this.hint_button);\n            this.resetButton = this.$('.action .reset');\n            this.resetButton.click(this.reset);\n            this.showButton = this.$('.action .show');\n            this.showButton.click(this.show);\n            this.saveButton = this.$('.action .save');\n            this.saveNotification = this.$('.notification-save');\n            this.showAnswerNotification = this.$('.notification-show-answer');\n            this.saveButton.click(this.save);\n            this.gentleAlertNotification = this.$('.notification-gentle-alert');\n            this.submitNotification = this.$('.notification-submit');\n\n            // Accessibility helper for sighted keyboard users to show <clarification> tooltips on focus:\n            this.$('.clarification').focus(function(ev) {\n                var icon;\n                icon = $(ev.target).children('i');\n                return window.globalTooltipManager.openTooltip(icon);\n            });\n            this.$('.clarification').blur(function() {\n                return window.globalTooltipManager.hide();\n            });\n            this.$('.review-btn').focus(function(ev) {\n                return $(ev.target).removeClass('sr');\n            });\n            this.$('.review-btn').blur(function(ev) {\n                return $(ev.target).addClass('sr');\n            });\n            this.bindResetCorrectness();\n            if (this.submitButton.length) {\n                this.submitAnswersAndSubmitButton(true);\n            }\n            Collapsible.setCollapsibles(this.el);\n            this.$('input.math').keyup(this.refreshMath);\n            if (typeof MathJax !== 'undefined' && MathJax !== null) {\n                this.$('input.math').each(function(index, element) {\n                    return MathJax.Hub.Queue([that.refreshMath, null, element]);\n                });\n            }\n        };\n\n        Problem.prototype.renderProgressState = function() {\n            var graded, progress, progressTemplate, curScore, totalScore, attemptsUsed;\n            curScore = this.el.data('problem-score');\n            totalScore = this.el.data('problem-total-possible');\n            attemptsUsed = this.el.data('attempts-used');\n            graded = this.el.data('graded');\n\n            // The problem is ungraded if it's explicitly marked as such, or if the total possible score is 0\n            if (graded === 'True' && totalScore !== 0) {\n                graded = true;\n            } else {\n                graded = false;\n            }\n\n            if (curScore === undefined || totalScore === undefined) {\n                // Render an empty string.\n                progressTemplate = '';\n            } else if (curScore === null || curScore === 'None') {\n                // Render 'x point(s) possible (un/graded, results hidden)' if no current score provided.\n                if (graded) {\n                    progressTemplate = ngettext(\n                        // Translators: %(num_points)s is the number of points possible (examples: 1, 3, 10).;\n                        '%(num_points)s point possible (graded, results hidden)',\n                        '%(num_points)s points possible (graded, results hidden)',\n                        totalScore\n                    );\n                } else {\n                    progressTemplate = ngettext(\n                        // Translators: %(num_points)s is the number of points possible (examples: 1, 3, 10).;\n                        '%(num_points)s point possible (ungraded, results hidden)',\n                        '%(num_points)s points possible (ungraded, results hidden)',\n                        totalScore\n                    );\n                }\n            } else if ((attemptsUsed === 0 || totalScore === 0) && curScore === 0) {\n                // Render 'x point(s) possible' if student has not yet attempted question\n                // But if staff has overridden score to a non-zero number, show it\n                if (graded) {\n                    progressTemplate = ngettext(\n                        // Translators: %(num_points)s is the number of points possible (examples: 1, 3, 10).;\n                        '%(num_points)s point possible (graded)', '%(num_points)s points possible (graded)',\n                        totalScore\n                    );\n                } else {\n                    progressTemplate = ngettext(\n                        // Translators: %(num_points)s is the number of points possible (examples: 1, 3, 10).;\n                        '%(num_points)s point possible (ungraded)', '%(num_points)s points possible (ungraded)',\n                        totalScore\n                    );\n                }\n            } else {\n                // Render 'x/y point(s)' if student has attempted question\n                if (graded) {\n                    progressTemplate = ngettext(\n                        // This comment needs to be on one line to be properly scraped for the translators.\n                        // Translators: %(earned)s is the number of points earned. %(possible)s is the total number of points (examples: 0/1, 1/1, 2/3, 5/10). The total number of points will always be at least 1. We pluralize based on the total number of points (example: 0/1 point; 1/2 points);\n                        '%(earned)s/%(possible)s point (graded)', '%(earned)s/%(possible)s points (graded)',\n                        totalScore\n                    );\n                } else {\n                    progressTemplate = ngettext(\n                        // This comment needs to be on one line to be properly scraped for the translators.\n                        // Translators: %(earned)s is the number of points earned. %(possible)s is the total number of points (examples: 0/1, 1/1, 2/3, 5/10). The total number of points will always be at least 1. We pluralize based on the total number of points (example: 0/1 point; 1/2 points);\n                        '%(earned)s/%(possible)s point (ungraded)', '%(earned)s/%(possible)s points (ungraded)',\n                        totalScore\n                    );\n                }\n            }\n            progress = interpolate(\n                progressTemplate, {\n                    earned: curScore,\n                    num_points: totalScore,\n                    possible: totalScore\n                }, true\n            );\n            return this.$('.problem-progress').text(progress);\n        };\n\n        Problem.prototype.updateProgress = function(response) {\n            if (response.progress_changed) {\n                this.el.data('problem-score', response.current_score);\n                this.el.data('problem-total-possible', response.total_possible);\n                this.el.data('attempts-used', response.attempts_used);\n                this.el.trigger('progressChanged');\n            }\n            return this.renderProgressState();\n        };\n\n        Problem.prototype.forceUpdate = function(response) {\n            this.el.data('problem-score', response.current_score);\n            this.el.data('problem-total-possible', response.total_possible);\n            this.el.data('attempts-used', response.attempts_used);\n            this.el.trigger('progressChanged');\n            return this.renderProgressState();\n        };\n\n        Problem.prototype.queueing = function(focusCallback) {\n            var that = this;\n            this.queued_items = this.$('.xqueue');\n            this.num_queued_items = this.queued_items.length;\n            if (this.num_queued_items > 0) {\n                if (window.queuePollerID) { // Only one poller 'thread' per Problem\n                    window.clearTimeout(window.queuePollerID);\n                }\n                window.queuePollerID = window.setTimeout(function() {\n                    return that.poll(1000, focusCallback);\n                }, 1000);\n            }\n        };\n\n        Problem.prototype.poll = function(previousTimeout, focusCallback) {\n            var that = this;\n            return $.postWithPrefix('' + this.url + '/problem_get', function(response) {\n                var newTimeout;\n                // If queueing status changed, then render\n                that.new_queued_items = $(response.html).find('.xqueue');\n                if (that.new_queued_items.length !== that.num_queued_items) {\n                    edx.HtmlUtils.setHtml(that.el, edx.HtmlUtils.HTML(response.html)).promise().done(function() {\n                        return typeof focusCallback === 'function' ? focusCallback() : void 0;\n                    });\n                    JavascriptLoader.executeModuleScripts(that.el, function() {\n                        that.setupInputTypes();\n                        that.bind();\n                    });\n                }\n                that.num_queued_items = that.new_queued_items.length;\n                if (that.num_queued_items === 0) {\n                    that.forceUpdate(response);\n                    delete window.queuePollerID;\n                } else {\n                    newTimeout = previousTimeout * 2;\n                    // if the timeout is greather than 1 minute\n                    if (newTimeout >= 60000) {\n                        delete window.queuePollerID;\n                        that.gentle_alert(\n                            gettext('The grading process is still running. Refresh the page to see updates.')\n                        );\n                    } else {\n                        window.queuePollerID = window.setTimeout(function() {\n                            return that.poll(newTimeout, focusCallback);\n                        }, newTimeout);\n                    }\n                }\n            });\n        };\n\n        /**\n         * Use this if you want to make an ajax call on the input type object\n         * static method so you don't have to instantiate a Problem in order to use it\n         *\n         * Input:\n         *     url: the AJAX url of the problem\n         *     inputId: the inputId of the input you would like to make the call on\n         *         NOTE: the id is the ${id} part of \"input_${id}\" during rendering\n         *             If this function is passed the entire prefixed id, the backend may have trouble\n         *             finding the correct input\n         *     dispatch: string that indicates how this data should be handled by the inputtype\n         *     data: dictionary of data to send to the server\n         *     callback: the function that will be called once the AJAX call has been completed.\n         *          It will be passed a response object\n         */\n        Problem.inputAjax = function(url, inputId, dispatch, data, callback) {\n            data.dispatch = dispatch; // eslint-disable-line no-param-reassign\n            data.input_id = inputId; // eslint-disable-line no-param-reassign\n            return $.postWithPrefix('' + url + '/input_ajax', data, callback);\n        };\n\n        Problem.prototype.render = function(content, focusCallback) {\n            var that = this;\n            if (content) {\n                this.el.html(content);\n                return JavascriptLoader.executeModuleScripts(this.el, function() {\n                    that.setupInputTypes();\n                    that.bind();\n                    that.queueing(focusCallback);\n                    that.renderProgressState();\n                    return typeof focusCallback === 'function' ? focusCallback() : void 0;\n                });\n            } else {\n                return $.postWithPrefix('' + this.url + '/problem_get', function(response) {\n                    that.el.html(response.html);\n                    return JavascriptLoader.executeModuleScripts(that.el, function() {\n                        that.setupInputTypes();\n                        that.bind();\n                        that.queueing();\n                        return that.forceUpdate(response);\n                    });\n                });\n            }\n        };\n\n        Problem.prototype.setupInputTypes = function() {\n            var that = this;\n            this.inputtypeDisplays = {};\n            return this.el.find('.capa_inputtype').each(function(index, inputtype) {\n                var classes, cls, id, setupMethod, i, len, results;\n                classes = $(inputtype).attr('class').split(' ');\n                id = $(inputtype).attr('id');\n                results = [];\n                for (i = 0, len = classes.length; i < len; i++) {\n                    cls = classes[i];\n                    setupMethod = that.inputtypeSetupMethods[cls];\n                    if (setupMethod != null) {\n                        results.push(that.inputtypeDisplays[id] = setupMethod(inputtype));\n                    } else {\n                        results.push(void 0);\n                    }\n                }\n                return results;\n            });\n        };\n\n        /**\n         * If some function wants to be called before sending the answer to the\n         * server, give it a chance to do so.\n         *\n         * submit_save_waitfor allows the callee to send alerts if the user's input is\n         * invalid. To do so, the callee must throw an exception named \"WaitforException\".\n         * This and any other errors or exceptions that arise from the callee are rethrown\n         * and abort the submission.\n         *\n         * In order to use this feature, add a 'data-waitfor' attribute to the input,\n         * and specify the function to be called by the submit button before sending off @answers\n         */\n        Problem.prototype.submit_save_waitfor = function(callback) {\n            var flag, inp, i, len, ref,\n                that = this;\n            flag = false;\n            ref = this.inputs;\n            for (i = 0, len = ref.length; i < len; i++) {\n                inp = ref[i];\n                if ($(inp).is('input[waitfor]')) {\n                    try {\n                        $(inp).data('waitfor')(function() {\n                            that.refreshAnswers();\n                            return callback();\n                        });\n                    } catch (e) {\n                        if (e.name === 'Waitfor Exception') {\n                            alert(e.message); // eslint-disable-line no-alert\n                        } else {\n                            alert( // eslint-disable-line no-alert\n                                gettext('Could not grade your answer. The submission was aborted.')\n                            );\n                        }\n                        throw e;\n                    }\n                    flag = true;\n                } else {\n                    flag = false;\n                }\n            }\n            return flag;\n        };\n\n        // Scroll to problem metadata and next focus is problem input\n        Problem.prototype.scroll_to_problem_meta = function() {\n            var questionTitle;\n            questionTitle = this.$('.problem-header');\n            if (questionTitle.length > 0) {\n                $('html, body').animate({\n                    scrollTop: questionTitle.offset().top\n                }, 500);\n                questionTitle.focus();\n            }\n        };\n\n        Problem.prototype.focus_on_notification = function(type) {\n            var notification;\n            notification = this.$('.notification-' + type);\n            if (notification.length > 0) {\n                notification.focus();\n            }\n        };\n\n        Problem.prototype.focus_on_submit_notification = function() {\n            this.focus_on_notification('submit');\n        };\n\n        Problem.prototype.focus_on_hint_notification = function(hintIndex) {\n            this.$('.notification-hint .notification-message > ol > li.hint-index-' + hintIndex).focus();\n        };\n\n        Problem.prototype.focus_on_save_notification = function() {\n            this.focus_on_notification('save');\n        };\n\n        /**\n         * 'submit_fd' uses FormData to allow file submissions in the 'problem_check' dispatch,\n         *      in addition to simple querystring-based answers\n         *\n         * NOTE: The dispatch 'problem_check' is being singled out for the use of FormData;\n         *       maybe preferable to consolidate all dispatches to use FormData\n         */\n        Problem.prototype.submit_fd = function() {\n            var abortSubmission, error, errorHtml, errors, fd, fileNotSelected, fileTooLarge, maxFileSize,\n                requiredFilesNotSubmitted, settings, timeoutId, unallowedFileSubmitted, i, len,\n                that = this;\n\n            // If there are no file inputs in the problem, we can fall back on submit.\n            if (this.el.find('input:file').length === 0) {\n                this.submit();\n                return;\n            }\n            this.enableSubmitButton(false);\n            if (!window.FormData) {\n                alert(gettext('Submission aborted! Sorry, your browser does not support file uploads. If you can, please use Chrome or Safari which have been verified to support file uploads.')); // eslint-disable-line max-len, no-alert\n                this.enableSubmitButton(true);\n                return;\n            }\n            timeoutId = this.enableSubmitButtonAfterTimeout();\n            fd = new FormData();\n\n            // Sanity checks on submission\n            maxFileSize = 4 * 1000 * 1000;\n            fileTooLarge = false;\n            fileNotSelected = false;\n            requiredFilesNotSubmitted = false;\n            unallowedFileSubmitted = false;\n\n            errors = [];\n            this.inputs.each(function(index, element) {\n                var allowedFiles, file, maxSize, requiredFiles, loopI, loopLen, ref;\n                if (element.type === 'file') {\n                    requiredFiles = $(element).data('required_files');\n                    allowedFiles = $(element).data('allowed_files');\n                    ref = element.files;\n                    for (loopI = 0, loopLen = ref.length; loopI < loopLen; loopI++) {\n                        file = ref[loopI];\n                        if (allowedFiles.length !== 0 && indexOfHelper.call(allowedFiles, file.name) < 0) {\n                            unallowedFileSubmitted = true;\n                            errors.push(edx.StringUtils.interpolate(\n                                gettext('You submitted {filename}; only {allowedFiles} are allowed.'), {\n                                    filename: file.name,\n                                    allowedFiles: allowedFiles\n                                }\n                            ));\n                        }\n                        if (indexOfHelper.call(requiredFiles, file.name) >= 0) {\n                            requiredFiles.splice(requiredFiles.indexOf(file.name), 1);\n                        }\n                        if (file.size > maxFileSize) {\n                            fileTooLarge = true;\n                            maxSize = maxFileSize / (1000 * 1000);\n                            errors.push(edx.StringUtils.interpolate(\n                                gettext('Your file {filename} is too large (max size: {maxSize}MB).'), {\n                                    filename: file.name,\n                                    maxSize: maxSize\n                                }\n                            ));\n                        }\n                        fd.append(element.id, file);\n                    }\n                    if (element.files.length === 0) {\n                        fileNotSelected = true;\n                        fd.append(element.id, ''); // In case we want to allow submissions with no file\n                    }\n                    if (requiredFiles.length !== 0) {\n                        requiredFilesNotSubmitted = true;\n                        errors.push(edx.StringUtils.interpolate(\n                            gettext('You did not submit the required files: {requiredFiles}.'), {\n                                requiredFiles: requiredFiles\n                            }\n                        ));\n                    }\n                } else {\n                    fd.append(element.id, element.value);\n                }\n            });\n            if (fileNotSelected) {\n                errors.push(gettext('You did not select any files to submit.'));\n            }\n            errorHtml = '<ul>\\n';\n            for (i = 0, len = errors.length; i < len; i++) {\n                error = errors[i];\n                errorHtml += '<li>' + error + '</li>\\n';\n            }\n            errorHtml += '</ul>';\n            this.gentle_alert(errorHtml);\n            abortSubmission = fileTooLarge || fileNotSelected || unallowedFileSubmitted || requiredFilesNotSubmitted;\n            if (abortSubmission) {\n                window.clearTimeout(timeoutId);\n                this.enableSubmitButton(true);\n            } else {\n                settings = {\n                    type: 'POST',\n                    data: fd,\n                    processData: false,\n                    contentType: false,\n                    complete: this.enableSubmitButtonAfterResponse,\n                    success: function(response) {\n                        switch (response.success) {\n                        case 'submitted':\n                        case 'incorrect':\n                        case 'correct':\n                            that.render(response.contents);\n                            that.updateProgress(response);\n                            break;\n                        default:\n                            that.gentle_alert(response.success);\n                        }\n                        return Logger.log('problem_graded', [that.answers, response.contents], that.id);\n                    }\n                };\n                $.ajaxWithPrefix('' + this.url + '/problem_check', settings);\n            }\n        };\n\n        Problem.prototype.submit = function() {\n            if (!this.submit_save_waitfor(this.submit_internal)) {\n                this.disableAllButtonsWhileRunning(this.submit_internal, true);\n            }\n        };\n\n        Problem.prototype.submit_internal = function() {\n            var that = this;\n            Logger.log('problem_check', this.answers);\n            return $.postWithPrefix('' + this.url + '/problem_check', this.answers, function(response) {\n                switch (response.success) {\n                case 'submitted':\n                case 'incorrect':\n                case 'correct':\n                    window.SR.readTexts(that.get_sr_status(response.contents));\n                    that.el.trigger('contentChanged', [that.id, response.contents, response]);\n                    that.render(response.contents, that.focus_on_submit_notification);\n                    that.updateProgress(response);\n                    break;\n                default:\n                    that.saveNotification.hide();\n                    that.gentle_alert(response.success);\n                }\n                return Logger.log('problem_graded', [that.answers, response.contents], that.id);\n            });\n        };\n\n        /**\n         * This method builds up an array of strings to send to the page screen-reader span.\n         * It first gets all elements with class \"status\", and then looks to see if they are contained\n         * in sections with aria-labels. If so, labels are prepended to the status element text.\n         * If not, just the text of the status elements are returned.\n         */\n        Problem.prototype.get_sr_status = function(contents) {\n            var addedStatus, ariaLabel, element, labeledStatus, parentSection, statusElement, template, i, len;\n            statusElement = $(contents).find('.status');\n            labeledStatus = [];\n            for (i = 0, len = statusElement.length; i < len; i++) {\n                element = statusElement[i];\n                parentSection = $(element).closest('.wrapper-problem-response');\n                addedStatus = false;\n                if (parentSection) {\n                    ariaLabel = parentSection.attr('aria-label');\n                    if (ariaLabel) {\n                        // Translators: This is only translated to allow for reordering of label and associated status.;\n                        template = gettext('{label}: {status}');\n                        labeledStatus.push(edx.StringUtils.interpolate(\n                            template, {\n                                label: ariaLabel,\n                                status: $(element).text()\n                            }\n                        ));\n                        addedStatus = true;\n                    }\n                }\n                if (!addedStatus) {\n                    labeledStatus.push($(element).text());\n                }\n            }\n            return labeledStatus;\n        };\n\n        Problem.prototype.reset = function() {\n            return this.disableAllButtonsWhileRunning(this.reset_internal, false);\n        };\n\n        Problem.prototype.reset_internal = function() {\n            var that = this;\n            Logger.log('problem_reset', this.answers);\n            return $.postWithPrefix('' + this.url + '/problem_reset', {\n                id: this.id\n            }, function(response) {\n                if (response.success) {\n                    that.el.trigger('contentChanged', [that.id, response.html, response]);\n                    that.render(response.html, that.scroll_to_problem_meta);\n                    that.updateProgress(response);\n                    return window.SR.readText(gettext('This problem has been reset.'));\n                } else {\n                    return that.gentle_alert(response.msg);\n                }\n            });\n        };\n\n        // TODO this needs modification to deal with javascript responses; perhaps we\n        // need something where responsetypes can define their own behavior when show\n        // is called.\n        Problem.prototype.show = function() {\n            var that = this;\n            Logger.log('problem_show', {\n                problem: this.id\n            });\n            return $.postWithPrefix('' + this.url + '/problem_show', function(response) {\n                var answers;\n                answers = response.answers;\n                $.each(answers, function(key, value) {\n                    var safeKey = key.replace(':', '\\\\:'); // fix for courses which use url_names with colons, e.g. problem:question1\n                    var answer;\n                    if (!$.isArray(value)) {\n                        answer = that.$('#answer_' + safeKey + ', #solution_' + safeKey);\n                        edx.HtmlUtils.setHtml(answer, edx.HtmlUtils.HTML(value));\n                        Collapsible.setCollapsibles(answer);\n\n                        // Sometimes, `value` is just a string containing a MathJax formula.\n                        // If this is the case, jQuery will throw an error in some corner cases\n                        // because of an incorrect selector. We setup a try..catch so that\n                        // the script doesn't break in such cases.\n                        //\n                        // We will fallback to the second `if statement` below, if an\n                        // error is thrown by jQuery.\n                        try {\n                            return $(value).find('.detailed-solution');\n                        } catch (e) {\n                            return {};\n                        }\n\n                        // TODO remove the above once everything is extracted into its own\n                        // inputtype functions.\n                    }\n                });\n                that.el.find('.capa_inputtype').each(function(index, inputtype) {\n                    var classes, cls, display, showMethod, i, len, results;\n                    classes = $(inputtype).attr('class').split(' ');\n                    results = [];\n                    for (i = 0, len = classes.length; i < len; i++) {\n                        cls = classes[i];\n                        display = that.inputtypeDisplays[$(inputtype).attr('id')];\n                        showMethod = that.inputtypeShowAnswerMethods[cls];\n                        if (showMethod != null) {\n                            results.push(showMethod(inputtype, display, answers, response.correct_status_html));\n                        } else {\n                            results.push(void 0);\n                        }\n                    }\n                    return results;\n                });\n                if (typeof MathJax !== 'undefined' && MathJax !== null) {\n                    that.el.find('.problem > div').each(function(index, element) {\n                        return MathJax.Hub.Queue(['Typeset', MathJax.Hub, element]);\n                    });\n                }\n                that.el.find('.show').attr('disabled', 'disabled');\n                that.updateProgress(response);\n                that.clear_all_notifications();\n                that.showAnswerNotification.show();\n                that.focus_on_notification('show-answer');\n            });\n        };\n\n        Problem.prototype.clear_all_notifications = function() {\n            this.submitNotification.remove();\n            this.gentleAlertNotification.hide();\n            this.saveNotification.hide();\n            this.showAnswerNotification.hide();\n        };\n\n        Problem.prototype.gentle_alert = function(msg) {\n            edx.HtmlUtils.setHtml(\n                this.el.find('.notification-gentle-alert .notification-message'),\n                edx.HtmlUtils.HTML(msg)\n            );\n            this.clear_all_notifications();\n            this.gentleAlertNotification.show();\n            this.gentleAlertNotification.focus();\n        };\n\n        Problem.prototype.save = function() {\n            if (!this.submit_save_waitfor(this.save_internal)) {\n                this.disableAllButtonsWhileRunning(this.save_internal, false);\n            }\n        };\n\n        Problem.prototype.save_internal = function() {\n            var that = this;\n            Logger.log('problem_save', this.answers);\n            return $.postWithPrefix('' + this.url + '/problem_save', this.answers, function(response) {\n                var saveMessage;\n                saveMessage = response.msg;\n                if (response.success) {\n                    that.el.trigger('contentChanged', [that.id, response.html, response]);\n                    edx.HtmlUtils.setHtml(\n                        that.el.find('.notification-save .notification-message'),\n                        edx.HtmlUtils.HTML(saveMessage)\n                    );\n                    that.clear_all_notifications();\n                    that.el.find('.wrapper-problem-response .message').hide();\n                    that.saveNotification.show();\n                    that.focus_on_save_notification();\n                } else {\n                    that.gentle_alert(saveMessage);\n                }\n            });\n        };\n\n        Problem.prototype.refreshMath = function(event, element) {\n            var elid, eqn, jax, mathjaxPreprocessor, preprocessorTag, target;\n            if (!element) {\n                element = event.target; // eslint-disable-line no-param-reassign\n            }\n            elid = element.id.replace(/^input_/, '');\n            target = 'display_' + elid;\n\n            // MathJax preprocessor is loaded by 'setupInputTypes'\n            preprocessorTag = 'inputtype_' + elid;\n            mathjaxPreprocessor = this.inputtypeDisplays[preprocessorTag];\n            if (typeof MathJax !== 'undefined' && MathJax !== null && MathJax.Hub.getAllJax(target)[0]) {\n                jax = MathJax.Hub.getAllJax(target)[0];\n                eqn = $(element).val();\n                if (mathjaxPreprocessor) {\n                    eqn = mathjaxPreprocessor(eqn);\n                }\n                MathJax.Hub.Queue(['Text', jax, eqn], [this.updateMathML, jax, element]);\n            }\n        };\n\n        Problem.prototype.updateMathML = function(jax, element) {\n            try {\n                $('#' + element.id + '_dynamath').val(jax.root.toMathML(''));\n            } catch (exception) {\n                if (!exception.restart) {\n                    throw exception;\n                }\n                if (typeof MathJax !== 'undefined' && MathJax !== null) {\n                    MathJax.Callback.After([this.refreshMath, jax], exception.restart);\n                }\n            }\n        };\n\n        Problem.prototype.refreshAnswers = function() {\n            this.$('input.schematic').each(function(index, element) {\n                return element.schematic.update_value();\n            });\n            this.$('.CodeMirror').each(function(index, element) {\n                if (element.CodeMirror.save) {\n                    element.CodeMirror.save();\n                }\n            });\n            this.answers = this.inputs.serialize();\n        };\n\n        /**\n         * Used to check available answers and if something is checked (or the answer is set in some textbox),\n         * the \"Submit\" button becomes enabled. Otherwise it is disabled by default.\n         *\n         * Arguments:\n         *    bind (boolean): used on the first check to attach event handlers to input fields\n         *       to change \"Submit\" enable status in case of some manipulations with answers\n         */\n        Problem.prototype.submitAnswersAndSubmitButton = function(bind) {\n            var answered, atLeastOneTextInputFound, oneTextInputFilled,\n                that = this;\n            if (bind === null || bind === undefined) {\n                bind = false; // eslint-disable-line no-param-reassign\n            }\n            answered = true;\n            atLeastOneTextInputFound = false;\n            oneTextInputFilled = false;\n            this.el.find('input:text').each(function(i, textField) {\n                if ($(textField).is(':visible')) {\n                    atLeastOneTextInputFound = true;\n                    if ($(textField).val() !== '') {\n                        oneTextInputFilled = true;\n                    }\n                    if (bind) {\n                        $(textField).on('input', function() {\n                            that.saveNotification.hide();\n                            that.showAnswerNotification.hide();\n                            that.submitAnswersAndSubmitButton();\n                        });\n                    }\n                }\n            });\n            if (atLeastOneTextInputFound && !oneTextInputFilled) {\n                answered = false;\n            }\n            this.el.find('.choicegroup').each(function(i, choicegroupBlock) {\n                var checked;\n                checked = false;\n                $(choicegroupBlock).find('input[type=checkbox], input[type=radio]').\n                    each(function(j, checkboxOrRadio) {\n                        if ($(checkboxOrRadio).is(':checked')) {\n                            checked = true;\n                        }\n                        if (bind) {\n                            $(checkboxOrRadio).on('click', function() {\n                                that.saveNotification.hide();\n                                that.el.find('.show').removeAttr('disabled');\n                                that.showAnswerNotification.hide();\n                                that.submitAnswersAndSubmitButton();\n                            });\n                        }\n                    });\n                if (!checked) {\n                    answered = false;\n                }\n            });\n            this.el.find('select').each(function(i, selectField) {\n                var selectedOption = $(selectField).find('option:selected').text()\n                    .trim();\n                if (selectedOption === 'Select an option') {\n                    answered = false;\n                }\n                if (bind) {\n                    $(selectField).on('change', function() {\n                        that.saveNotification.hide();\n                        that.showAnswerNotification.hide();\n                        that.submitAnswersAndSubmitButton();\n                    });\n                }\n            });\n            if (answered) {\n                return this.enableSubmitButton(true);\n            } else {\n                return this.enableSubmitButton(false, false);\n            }\n        };\n\n        Problem.prototype.bindResetCorrectness = function() {\n            // Loop through all input types.\n            // Bind the reset functions at that scope.\n            var $inputtypes,\n                that = this;\n            $inputtypes = this.el.find('.capa_inputtype').add(this.el.find('.inputtype'));\n            return $inputtypes.each(function(index, inputtype) {\n                var bindMethod, classes, cls, i, len, results;\n                classes = $(inputtype).attr('class').split(' ');\n                results = [];\n                for (i = 0, len = classes.length; i < len; i++) {\n                    cls = classes[i];\n                    bindMethod = that.bindResetCorrectnessByInputtype[cls];\n                    if (bindMethod != null) {\n                        results.push(bindMethod(inputtype));\n                    } else {\n                        results.push(void 0);\n                    }\n                }\n                return results;\n            });\n        };\n\n        // Find all places where each input type displays its correct-ness\n        // Replace them with their original state--'unanswered'.\n        Problem.prototype.bindResetCorrectnessByInputtype = {\n            // These are run at the scope of the capa inputtype\n            // They should set handlers on each <input> to reset the whole.\n            formulaequationinput: function(element) {\n                return $(element).find('input').on('input', function() {\n                    var $p;\n                    $p = $(element).find('span.status');\n                    return $p.parent().removeAttr('class').addClass('unsubmitted');\n                });\n            },\n            choicegroup: function(element) {\n                var $element, id;\n                $element = $(element);\n                id = ($element.attr('id').match(/^inputtype_(.*)$/))[1];\n                return $element.find('input').on('change', function() {\n                    var $status;\n                    $status = $('#status_' + id);\n                    if ($status[0]) {\n                        $status.removeAttr('class').addClass('status unanswered');\n                    } else {\n                        $('<span>', {\n                            class: 'status unanswered',\n                            style: 'display: inline-block;',\n                            id: 'status_' + id\n                        });\n                    }\n                    $element.find('label').find('span.status.correct').remove();\n                    return $element.find('label').removeAttr('class');\n                });\n            },\n            'option-input': function(element) {\n                var $select, id;\n                $select = $(element).find('select');\n                id = ($select.attr('id').match(/^input_(.*)$/))[1];\n                return $select.on('change', function() {\n                    return $('#status_' + id).removeAttr('class').addClass('unanswered')\n                        .find('.sr')\n                        .text(gettext('unsubmitted'));\n                });\n            },\n            textline: function(element) {\n                return $(element).find('input').on('input', function() {\n                    var $p;\n                    $p = $(element).find('span.status');\n                    return $p.parent().removeClass('correct incorrect').addClass('unsubmitted');\n                });\n            }\n        };\n\n        Problem.prototype.inputtypeSetupMethods = {\n            'text-input-dynamath': function(element) {\n                /*\n                 Return: function (eqn) -> eqn that preprocesses the user formula input before\n                 it is fed into MathJax. Return 'false' if no preprocessor specified\n                 */\n                var data, preprocessor, preprocessorClass, preprocessorClassName;\n                data = $(element).find('.text-input-dynamath_data');\n                preprocessorClassName = data.data('preprocessor');\n                preprocessorClass = window[preprocessorClassName];\n                if (preprocessorClass == null) {\n                    return false;\n                } else {\n                    preprocessor = new preprocessorClass();\n                    return preprocessor.fn;\n                }\n            },\n            cminput: function(container) {\n                var CodeMirrorEditor, CodeMirrorTextArea, element, id, linenumbers, mode, spaces, tabsize;\n                element = $(container).find('textarea');\n                tabsize = element.data('tabsize');\n                mode = element.data('mode');\n                linenumbers = element.data('linenums');\n                spaces = Array(parseInt(tabsize, 10) + 1).join(' ');\n                CodeMirrorEditor = CodeMirror.fromTextArea(element[0], {\n                    lineNumbers: linenumbers,\n                    indentUnit: tabsize,\n                    tabSize: tabsize,\n                    mode: mode,\n                    matchBrackets: true,\n                    lineWrapping: true,\n                    indentWithTabs: false,\n                    smartIndent: false,\n                    extraKeys: {\n                        Esc: function() {\n                            $('.grader-status').focus();\n                            return false;\n                        },\n                        Tab: function(cm) {\n                            cm.replaceSelection(spaces, 'end');\n                            return false;\n                        }\n                    }\n                });\n                id = element.attr('id').replace(/^input_/, '');\n                CodeMirrorTextArea = CodeMirrorEditor.getInputField();\n                CodeMirrorTextArea.setAttribute('id', 'cm-textarea-' + id);\n                CodeMirrorTextArea.setAttribute('aria-describedby', 'cm-editor-exit-message-' + id + ' status_' + id);\n                return CodeMirrorEditor;\n            }\n        };\n\n        Problem.prototype.inputtypeShowAnswerMethods = {\n            choicegroup: function(element, display, answers, correctStatusHtml) {\n                var answer, choice, inputId, i, len, results, $element, $inputLabel, $inputStatus;\n                $element = $(element);\n                inputId = $element.attr('id').replace(/inputtype_/, '');\n                inputId = inputId.replace(':', '\\\\:'); // fix for courses which use url_names with colons, e.g. problem:question1\n                answer = answers[inputId];\n                results = [];\n                for (i = 0, len = answer.length; i < len; i++) {\n                    choice = answer[i];\n                    $inputLabel = $element.find('#input_' + inputId + '_' + choice).parent('label');\n                    $inputStatus = $inputLabel.find('#status_' + inputId);\n                    // If the correct answer was already Submitted before \"Show Answer\" was selected,\n                    // the status HTML will already be present. Otherwise, inject the status HTML.\n\n                    // If the learner clicked a different answer after Submit, their submitted answers\n                    // will be marked as \"unanswered\". In that case, for correct answers update the\n                    // classes accordingly.\n                    if ($inputStatus.hasClass('unanswered')) {\n                        $inputStatus.removeAttr('class').addClass('status correct');\n                        $inputLabel.addClass('choicegroup_correct');\n                    } else if (!$inputLabel.hasClass('choicegroup_correct')) {\n                        // If the status HTML is not already present (due to clicking Submit), append\n                        // the status HTML for correct answers.\n                        edx.HtmlUtils.append($inputLabel, edx.HtmlUtils.HTML(correctStatusHtml));\n                        results.push($inputLabel.addClass('choicegroup_correct'));\n                    }\n                }\n                return results;\n            },\n            choicetextgroup: function(element, display, answers) {\n                var answer, choice, inputId, i, len, results, $element;\n                $element = $(element);\n                inputId = $element.attr('id').replace(/inputtype_/, '');\n                answer = answers[inputId];\n                results = [];\n                for (i = 0, len = answer.length; i < len; i++) {\n                    choice = answer[i];\n                    results.push($element.find('section#forinput' + choice).addClass('choicetextgroup_show_correct'));\n                }\n                return results;\n            },\n            imageinput: function(element, display, answers) {\n                // answers is a dict of (answer_id, answer_text) for each answer for this question.\n                //\n                // @Examples:\n                // {'anwser_id': {\n                //    'rectangle': '(10,10)-(20,30);(12,12)-(40,60)',\n                //    'regions': '[[10,10], [30,30], [10, 30], [30, 10]]'\n                // } }\n                var canvas, container, id, types, context, $element;\n                types = {\n                    rectangle: function(ctx, coords) {\n                        var rects, reg;\n                        reg = /^\\(([0-9]+),([0-9]+)\\)-\\(([0-9]+),([0-9]+)\\)$/;\n                        rects = coords.replace(/\\s*/g, '').split(/;/);\n                        $.each(rects, function(index, rect) {\n                            var abs, height, points, width;\n                            abs = Math.abs;\n                            points = reg.exec(rect);\n                            if (points) {\n                                width = abs(points[3] - points[1]);\n                                height = abs(points[4] - points[2]);\n                                ctx.rect(points[1], points[2], width, height);\n                            }\n                        });\n                        ctx.stroke();\n                        return ctx.fill();\n                    },\n                    regions: function(ctx, coords) {\n                        var parseCoords;\n                        parseCoords = function(coordinates) {\n                            var reg;\n                            reg = JSON.parse(coordinates);\n\n                            // Regions is list of lists [region1, region2, region3, ...] where regionN\n                            // is disordered list of points: [[1,1], [100,100], [50,50], [20, 70]].\n                            // If there is only one region in the list, simpler notation can be used:\n                            // regions=\"[[10,10], [30,30], [10, 30], [30, 10]]\" (without explicitly\n                            // setting outer list)\n                            if (typeof reg[0][0][0] === 'undefined') {\n                                // we have [[1,2],[3,4],[5,6]] - single region\n                                // instead of [[[1,2],[3,4],[5,6], [[1,2],[3,4],[5,6]]]\n                                // or [[[1,2],[3,4],[5,6]]] - multiple regions syntax\n                                reg = [reg];\n                            }\n                            return reg;\n                        };\n                        return $.each(parseCoords(coords), function(index, region) {\n                            ctx.beginPath();\n                            $.each(region, function(idx, point) {\n                                if (idx === 0) {\n                                    return ctx.moveTo(point[0], point[1]);\n                                } else {\n                                    return ctx.lineTo(point[0], point[1]);\n                                }\n                            });\n                            ctx.closePath();\n                            ctx.stroke();\n                            return ctx.fill();\n                        });\n                    }\n                };\n                $element = $(element);\n                id = $element.attr('id').replace(/inputtype_/, '');\n                container = $element.find('#answer_' + id);\n                canvas = document.createElement('canvas');\n                canvas.width = container.data('width');\n                canvas.height = container.data('height');\n                if (canvas.getContext) {\n                    context = canvas.getContext('2d');\n                } else {\n                    console.log('Canvas is not supported.'); // eslint-disable-line no-console\n                }\n                context.fillStyle = 'rgba(255,255,255,.3)';\n                context.strokeStyle = '#FF0000';\n                context.lineWidth = '2';\n                if (answers[id]) {\n                    $.each(answers[id], function(key, value) {\n                        if ((types[key] !== null && types[key] !== undefined) && value) {\n                            types[key](context, value);\n                        }\n                    });\n                    container.html(canvas);\n                } else {\n                    console.log('Answer is absent for image input with id=' + id); // eslint-disable-line no-console\n                }\n            }\n        };\n\n        /**\n         * Used to keep the buttons disabled while operationCallback is running.\n         *\n         * params:\n         *      'operationCallback' is an operation to be run.\n         *      isFromCheckOperation' is a boolean to keep track if 'operationCallback' was\n         *           from submit, if so then text of submit button will be changed as well.\n         *\n         */\n        Problem.prototype.disableAllButtonsWhileRunning = function(operationCallback, isFromCheckOperation) {\n            var that = this;\n            var allButtons = [this.resetButton, this.saveButton, this.showButton, this.hintButton, this.submitButton];\n            var initiallyEnabledButtons = allButtons.filter(function(button) {\n                return !button.attr('disabled');\n            });\n            this.enableButtons(initiallyEnabledButtons, false, isFromCheckOperation);\n            return operationCallback().always(function() {\n                return that.enableButtons(initiallyEnabledButtons, true, isFromCheckOperation);\n            });\n        };\n\n        /**\n         * Enables/disables buttons by removing/adding the disabled attribute. The submit button is checked\n         *     separately due to the changing text it contains.\n         *\n         * params:\n         *     'buttons' is an array of buttons that will have their 'disabled' attribute modified\n         *     'enable' a boolean to either enable or disable the buttons passed in the first parameter\n         *     'changeSubmitButtonText' is a boolean to keep track if operation was initiated\n         *         from submit so that text of submit button will also be changed while disabling/enabling\n         *         the submit button.\n         */\n        Problem.prototype.enableButtons = function(buttons, enable, changeSubmitButtonText) {\n            var that = this;\n            buttons.forEach(function(button) {\n                if (button.hasClass('submit')) {\n                    that.enableSubmitButton(enable, changeSubmitButtonText);\n                } else if (enable) {\n                    button.removeAttr('disabled');\n                } else {\n                    button.attr({disabled: 'disabled'});\n                }\n            });\n        };\n\n        /**\n         *  Used to disable submit button to reduce chance of accidental double-submissions.\n         *\n         * params:\n         *     'enable' is a boolean to determine enabling/disabling of submit button.\n         *     'changeText' is a boolean to determine if there is need to change the\n         *         text of submit button as well.\n         */\n        Problem.prototype.enableSubmitButton = function(enable, changeText) {\n            var submitCanBeEnabled;\n            if (changeText === null || changeText === undefined) {\n                changeText = true; // eslint-disable-line no-param-reassign\n            }\n            if (enable) {\n                submitCanBeEnabled = this.submitButton.data('should-enable-submit-button') === 'True';\n                if (submitCanBeEnabled) {\n                    this.submitButton.removeAttr('disabled');\n                }\n                if (changeText) {\n                    this.submitButtonLabel.text(this.submitButtonSubmitText);\n                }\n            } else {\n                this.submitButton.attr({disabled: 'disabled'});\n                if (changeText) {\n                    this.submitButtonLabel.text(this.submitButtonSubmittingText);\n                }\n            }\n        };\n\n        Problem.prototype.enableSubmitButtonAfterResponse = function() {\n            this.has_response = true;\n            if (!this.has_timed_out) {\n                // Server has returned response before our timeout.\n                return this.enableSubmitButton(false);\n            } else {\n                return this.enableSubmitButton(true);\n            }\n        };\n\n        Problem.prototype.enableSubmitButtonAfterTimeout = function() {\n            var enableSubmitButton,\n                that = this;\n            this.has_timed_out = false;\n            this.has_response = false;\n            enableSubmitButton = function() {\n                that.has_timed_out = true;\n                if (that.has_response) {\n                    that.enableSubmitButton(true);\n                }\n            };\n            return window.setTimeout(enableSubmitButton, 750);\n        };\n\n        Problem.prototype.hint_button = function() {\n            // Store the index of the currently shown hint as an attribute.\n            // Use that to compute the next hint number when the button is clicked.\n            var hintContainer, hintIndex, nextIndex,\n                that = this;\n            hintContainer = this.$('.problem-hint');\n            hintIndex = hintContainer.attr('hint_index');\n            if (hintIndex === void 0) {\n                nextIndex = 0;\n            } else {\n                nextIndex = parseInt(hintIndex, 10) + 1;\n            }\n            return $.postWithPrefix('' + this.url + '/hint_button', {\n                hint_index: nextIndex,\n                input_id: this.id\n            }, function(response) {\n                var hintMsgContainer;\n                if (response.success) {\n                    hintMsgContainer = that.$('.problem-hint .notification-message');\n                    hintContainer.attr('hint_index', response.hint_index);\n                    edx.HtmlUtils.setHtml(hintMsgContainer, edx.HtmlUtils.HTML(response.msg));\n                    MathJax.Hub.Queue(['Typeset', MathJax.Hub, hintContainer[0]]);\n                    if (response.should_enable_next_hint) {\n                        that.hintButton.removeAttr('disabled');\n                    } else {\n                        that.hintButton.attr({disabled: 'disabled'});\n                    }\n                    that.el.find('.notification-hint').show();\n                    that.focus_on_hint_notification(nextIndex);\n                } else {\n                    that.gentle_alert(response.msg);\n                }\n            });\n        };\n\n        return Problem;\n    }).call(this);\n}).call(this);\n\n}.call(window));\n\n\n// WEBPACK FOOTER //\n// ./common/static/xmodule/modules/js/002-21fbfeacf374a272557610f54a4c1aa2.js","/*** IMPORTS FROM imports-loader ***/\n(function() {\n\n/**\n * Simple image input\n *\n *\n * Click on image. Update the coordinates of a dot on the image.\n * The new coordinates are the location of the click.\n */\n\n/**\n * 'The wise adapt themselves to circumstances, as water molds itself to the\n * pitcher.'\n *\n * ~ Chinese Proverb\n */\n\nwindow.ImageInput = (function($, undefined) {\n    var ImageInput = ImageInputConstructor;\n\n    ImageInput.prototype = {\n        constructor: ImageInputConstructor,\n        clickHandler: clickHandler\n    };\n\n    return ImageInput;\n\n    function ImageInputConstructor(elementId) {\n        this.el = $('#imageinput_' + elementId);\n        this.crossEl = $('#cross_' + elementId);\n        this.inputEl = $('#input_' + elementId);\n\n        this.el.on('click', this.clickHandler.bind(this));\n    }\n\n    function clickHandler(event) {\n        var offset = this.el.offset(),\n            posX = event.offsetX ?\n                event.offsetX : event.pageX - offset.left,\n            posY = event.offsetY ?\n                event.offsetY : event.pageY - offset.top,\n\n            // To reduce differences between values returned by different kinds\n            // of browsers, we round `posX` and `posY`.\n            //\n            // IE10: `posX` and `posY` - float.\n            // Chrome, FF: `posX` and `posY` - integers.\n            result = '[' + Math.round(posX) + ',' + Math.round(posY) + ']';\n\n        this.crossEl.css({\n            left: posX - 15,\n            top: posY - 15,\n            visibility: 'visible'\n        });\n\n        this.inputEl.val(result);\n    }\n}).call(this, window.jQuery);\n\n}.call(window));\n\n\n// WEBPACK FOOTER //\n// ./common/static/xmodule/modules/js/004-b0c34afa95eaa6b45d843d92ca523a94.js","/*** IMPORTS FROM imports-loader ***/\n(function() {\n\n/* eslint-disable */\n\n//////////////////////////////////////////////////////////////////////////////\n//\n//  Circuit simulator\n//\n//////////////////////////////////////////////////////////////////////////////\n\n// Copyright (C) 2011 Massachusetts Institute of Technology\n\n\n// create a circuit for simulation using \"new cktsim.Circuit()\"\n\n// for modified nodal analysis (MNA) stamps see\n// http://www.analog-electronics.eu/analog-electronics/modified-nodal-analysis/modified-nodal-analysis.xhtml\n\nvar cktsim = (function() {\n\t///////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Circuit\n\t//\n\t//////////////////////////////////////////////////////////////////////////////\n\n    // types of \"nodes\" in the linear system\n    var T_VOLTAGE = 0;\n    var T_CURRENT = 1;\n\n    var v_newt_lim = 0.3; // Voltage limited Newton great for Mos/diodes\n    var v_abstol = 1e-6; // Absolute voltage error tolerance\n    var i_abstol = 1e-12; // Absolute current error tolerance\n    var eps = 1.0e-12; // A very small number compared to one.\n    var dc_max_iters = 1000; // max iterations before giving up\n    var max_tran_iters = 20; // max iterations before giving up\n    var time_step_increase_factor = 2.0; // How much can lte let timestep grow.\n    var lte_step_decrease_factor = 8; // Limit lte one-iter timestep shrink.\n    var nr_step_decrease_factor = 4; // Newton failure timestep shrink.\n    var reltol = 0.0001; // Relative tol to max observed value\n    var lterel = 10; // LTE/Newton tolerance ratio (> 10!)\n    var res_check_abs = Math.sqrt(i_abstol); // Loose Newton residue check\n    var res_check_rel = Math.sqrt(reltol); // Loose Newton residue check\n\n\tfunction Circuit() {\n        this.node_map = [];\n\t    this.ntypes = [];\n        this.initial_conditions = [];\n        this.devices = [];\n        this.device_map = [];\n        this.voltage_sources = [];\n        this.current_sources = [];\n\t    this.finalized = false;\n\t    this.diddc = false;\n\t    this.node_index = -1;\n\t    this.periods = 1\n\t}\n\n\t// index of ground node\n\tCircuit.prototype.gnd_node = function() {\n\t    return -1;\n\t}\n\n\t// allocate a new node index\n\tCircuit.prototype.node = function(name,ntype,ic) {\n\t    this.node_index += 1;\n\t    if (name) this.node_map[name] = this.node_index;\n\t    this.ntypes.push(ntype);\n\t    this.initial_conditions.push(ic);\n\t    return this.node_index;\n\t}\n\n\t// call to finalize the circuit in preparation for simulation\n\tCircuit.prototype.finalize = function() {\n\t    if (!this.finalized) {\n\t\tthis.finalized = true;\n\t\tthis.N = this.node_index + 1;  // number of nodes\n\n\t\t// give each device a chance to finalize itself\n\t\tfor (var i = this.devices.length - 1; i >= 0; --i)\n\t\t    this.devices[i].finalize(this);\n\n\t\t// set up augmented matrix and various temp vectors\n\t\tthis.matrix = mat_make(this.N, this.N+1);\n\t\tthis.Gl = mat_make(this.N, this.N);  // Matrix for linear conductances\n\t\tthis.G = mat_make(this.N, this.N);  // Complete conductance matrix\n\t\tthis.C = mat_make(this.N, this.N);  // Matrix for linear L's and C's\n\n\t\tthis.soln_max = new Array(this.N);   // max abs value seen for each unknown\n\t\tthis.abstol = new Array(this.N);\n\t\tthis.solution = new Array(this.N);\n\t\tthis.rhs = new Array(this.N);\n\t\tfor (var i = this.N - 1; i >= 0; --i) {\n\t\t    this.soln_max[i] = 0.0;\n\t\t    this.abstol[i] = this.ntypes[i] == T_VOLTAGE ? v_abstol : i_abstol;\n\t\t    this.solution[i] = 0.0;\n\t\t    this.rhs[i] = 0.0;\n\t\t}\n\n\t\t// Load up the linear elements once and for all\n\t\tfor (var i = this.devices.length - 1; i >= 0; --i) {\n\t\t    this.devices[i].load_linear(this)\n\t\t}\n\n\t\t// Check for voltage source loops.\n        var n_vsrc = this.voltage_sources.length;\n\t\tif (n_vsrc > 0) { // At least one voltage source\n\t\t    var GV = mat_make(n_vsrc, this.N);  // Loop check\n\t\t    for (var i = n_vsrc - 1; i >= 0; --i) {\n\t\t\tvar branch = this.voltage_sources[i].branch;\n\t\t\tfor (var j = this.N - 1; j >= 0; j--)\n\t\t\t    GV[i][j] = this.Gl[branch][j];\n\t\t    }\n\t\t    var rGV = mat_rank(GV);\n\t\t    if (rGV < n_vsrc) {\n\t\t\talert('Warning!!! Circuit has a voltage source loop or a source or current probe shorted by a wire, please remove the source or the wire causing the short.');\n\t\t\talert('Warning!!! Simulator might produce meaningless results or no result with illegal circuits.');\n\t\t\treturn false;\n\t\t    }\n\t\t}\n\t    }\n\t    return true;\n\t}\n\n\t// load circuit from JSON netlist (see schematic.js)\n\tCircuit.prototype.load_netlist = function(netlist) {\n\t    // set up mapping for all ground connections\n\t    for (var i = netlist.length - 1; i >= 0; --i) {\n\t\tvar component = netlist[i];\n\t\tvar type = component[0];\n\t\tif (type == 'g') {\n\t\t    var connections = component[3];\n\t\t    this.node_map[connections[0]] = this.gnd_node();\n\t\t}\n\t    }\n\n\t    // process each component in the JSON netlist (see schematic.js for format)\n\t    var found_ground = false;\n\t    for (var i = netlist.length - 1; i >= 0; --i) {\n\t\tvar component = netlist[i];\n\t\tvar type = component[0];\n\n\t\t// ignore wires, ground connections, scope probes and view info\n\t\tif (type == 'view' || type == 'w' || type == 'g' || type == 's' || type == 'L') {\n\t\t    continue;\n\t\t}\n\n\t\tvar properties = component[2];\n\t\tvar name = properties['name'];\n\t\tif (name==undefined || name=='')\n\t\t    name = '_' + properties['_json_'].toString();\n\n\t\t// convert node names to circuit indicies\n\t\tvar connections = component[3];\n\t\tfor (var j = connections.length - 1; j >= 0; --j) {\n\t\t    var node = connections[j];\n\t\t    var index = this.node_map[node];\n\t\t    if (index == undefined) index = this.node(node,T_VOLTAGE);\n\t\t    else if (index == this.gnd_node()) found_ground = true;\n\t\t    connections[j] = index;\n\t\t}\n\n\t\t// process the component\n\t\tif (type == 'r')\t// resistor\n\t\t    this.r(connections[0],connections[1],properties['r'],name);\n\t\telse if (type == 'd')\t// diode\n\t\t    this.d(connections[0],connections[1],properties['area'],properties['type'],name);\n\t\telse if (type == 'c')   // capacitor\n\t\t    this.c(connections[0],connections[1],properties['c'],name);\n\t\telse if (type == 'l')\t// inductor\n\t\t    this.l(connections[0],connections[1],properties['l'],name);\n\t\telse if (type == 'v') \t// voltage source\n\t\t    this.v(connections[0],connections[1],properties['value'],name);\n\t\telse if (type == 'i') \t// current source\n\t\t    this.i(connections[0],connections[1],properties['value'],name);\n\t\telse if (type == 'o') \t// op amp\n\t\t    this.opamp(connections[0],connections[1],connections[2],connections[3],properties['A'],name);\n\t\telse if (type == 'n') \t// n fet\n\t\t    this.n(connections[0],connections[1],connections[2],properties['W/L'],name);\n\t\telse if (type == 'p') \t// p fet\n\t\t    this.p(connections[0],connections[1],connections[2],properties['W/L'],name);\n\t\telse if (type == 'a') \t// current probe == 0-volt voltage source\n\t\t    this.v(connections[0],connections[1],'0',name);\n\t    }\n\n\t    if (!found_ground) { // No ground on schematic\n\t\talert('Please make at least one connection to ground  (inverted T symbol)');\n\t\treturn false;\n\t    }\n\t    return true;\n\t}\n\n\t// if converges: updates this.solution, this.soln_max, returns iter count\n\t// otherwise: return undefined and set this.problem_node\n\t// Load should compute -f and df/dx (note the sign pattern!)\n        Circuit.prototype.find_solution = function(load,maxiters) {\n\t    var soln = this.solution;\n\t    var rhs = this.rhs;\n\t    var d_sol = [];\n\t    var abssum_compare;\n\t    var converged,abssum_old=0, abssum_rhs;\n\t    var use_limiting = false;\n\t    var down_count = 0;\n        var thresh;\n\n\t    // iteratively solve until values convere or iteration limit exceeded\n\t    for (var iter = 0; iter < maxiters; iter++) {\n\t\t// set up equations\n\t\tload(this,soln,rhs);\n\n\t\t// Compute norm of rhs, assume variables of v type go with eqns of i type\n\t\tabssum_rhs = 0;\n\t\tfor (var i = this.N - 1; i >= 0; --i)\n\t\t    if (this.ntypes[i] == T_VOLTAGE)\n\t\t\tabssum_rhs += Math.abs(rhs[i]);\n\n\t\tif ((iter > 0) && (use_limiting == false) && (abssum_old < abssum_rhs)) {\n\t\t    // Old rhsnorm was better, undo last iter and turn on limiting\n\t\t    for (var i = this.N - 1; i >= 0; --i)\n\t\t\tsoln[i] -= d_sol[i];\n\t\t    iter -= 1;\n\t\t    use_limiting = true;\n\t\t}\n\t        else {  // Compute the Newton delta\n\t\t    d_sol = mat_solve_rq(this.matrix,rhs);\n\n\t\t    // If norm going down for ten iters, stop limiting\n\t\t    if (abssum_rhs < abssum_old)\n\t\t\tdown_count += 1;\n\t\t    else\n\t\t\tdown_count = 0;\n\t\t    if (down_count > 10) {\n\t\t\tuse_limiting = false;\n\t\t\tdown_count = 0;\n\t\t    }\n\n\t\t    // Update norm of rhs\n\t\t    abssum_old = abssum_rhs;\n\t\t}\n\n\t\t// Update the worst case abssum for comparison.\n\t\tif ((iter == 0) || (abssum_rhs > abssum_compare))\n\t\t    abssum_compare = abssum_rhs;\n\n\t\t// Check residue convergence, but loosely, and give up\n\t\t// on last iteration\n\t\tif ( (iter < (maxiters - 1)) &&\n\t\t     (abssum_rhs > (res_check_abs+res_check_rel*abssum_compare)))\n\t\t    converged = false;\n\t\telse converged = true;\n\n\n\t\t// Update solution and check delta convergence\n\t\tfor (var i = this.N - 1; i >= 0; --i) {\n\t\t    // Simple voltage step limiting to encourage Newton convergence\n\t\t    if (use_limiting) {\n\t\t\tif (this.ntypes[i] == T_VOLTAGE) {\n\t\t\t    d_sol[i] = (d_sol[i] > v_newt_lim) ? v_newt_lim : d_sol[i];\n\t\t\t    d_sol[i] = (d_sol[i] < -v_newt_lim) ? -v_newt_lim : d_sol[i];\n\t\t\t}\n\t\t    }\n\t\t    soln[i] += d_sol[i];\n\t\t    thresh = this.abstol[i] + reltol*this.soln_max[i];\n\t\t    if (Math.abs(d_sol[i]) > thresh) {\n\t\t\tconverged = false;\n\t\t\tthis.problem_node = i;\n\t\t    }\n\t\t}\n\n                if (converged == true) {\n\t\t    for (var i = this.N - 1; i >= 0; --i)\n\t\t\tif (Math.abs(soln[i]) > this.soln_max[i])\n\t\t\t    this.soln_max[i] = Math.abs(soln[i]);\n\t\t    return iter+1;\n\t\t}\n\t    }\n\t    return undefined;\n\t}\n\n\t// DC analysis\n\tCircuit.prototype.dc = function() {\n\t    // Allocation matrices for linear part, etc.\n\t    if (this.finalize() == false)\n\t\treturn undefined;\n\n\t    // Define -f and df/dx for Newton solver\n\t    function load_dc(ckt,soln,rhs) {\n\t\t// rhs is initialized to -Gl * soln\n\t\tmat_v_mult(ckt.Gl, soln, rhs, -1.0);\n\t\t// G matrix is initialized with linear Gl\n\t\tmat_copy(ckt.Gl,ckt.G);\n\t\t// Now load up the nonlinear parts of rhs and G\n\t\tfor (var i = ckt.devices.length - 1; i >= 0; --i)\n\t\t\tckt.devices[i].load_dc(ckt,soln,rhs);\n\t\t// G matrix is copied in to the system matrix\n\t\tmat_copy(ckt.G,ckt.matrix);\n\t    }\n\n\t    // find the operating point\n\t    var iterations = this.find_solution(load_dc,dc_max_iters);\n\n\t    if (typeof iterations == 'undefined') {\n\t    // too many iterations\n\t\tif (this.current_sources.length > 0) {\n\t\t    alert('Newton Method Failed, do your current sources have a conductive path to ground?');\n\t\t} else {\n\t\t    alert('Newton Method Failed, it may be your circuit or it may be our simulator.');\n\t\t}\n\n\t\treturn undefined\n\t    } else {\n\t\t// Note that a dc solution was computed\n\t\tthis.diddc = true;\n\t\t// create solution dictionary\n        var result = [];\n\t\t// capture node voltages\n\t\tfor (var name in this.node_map) {\n\t\t    var index = this.node_map[name];\n\t\t    result[name] = (index == -1) ? 0 : this.solution[index];\n\t\t}\n\t\t// capture branch currents from voltage sources\n\t\tfor (var i = this.voltage_sources.length - 1; i >= 0; --i) {\n\t\t    var v = this.voltage_sources[i];\n\t\t    result['I('+v.name+')'] = this.solution[v.branch];\n\t\t}\n\t\treturn result;\n\t    }\n\t}\n\n\t// Transient analysis (needs work!)\n        Circuit.prototype.tran = function(ntpts, tstart, tstop, probenames, no_dc) {\n\n\t    // Define -f and df/dx for Newton solver\n\t    function load_tran(ckt,soln,rhs) {\n\t\t// Crnt is initialized to -Gl * soln\n\t\tmat_v_mult(ckt.Gl, soln, ckt.c,-1.0);\n\t\t// G matrix is initialized with linear Gl\n\t\tmat_copy(ckt.Gl,ckt.G);\n\t\t// Now load up the nonlinear parts of crnt and G\n\t\tfor (var i = ckt.devices.length - 1; i >= 0; --i)\n\t\t    ckt.devices[i].load_tran(ckt,soln,ckt.c,ckt.time);\n\t\t// Exploit the fact that storage elements are linear\n\t\tmat_v_mult(ckt.C, soln, ckt.q, 1.0);\n\t\t// -rhs = c - dqdt\n\t\tfor (var i = ckt.N-1; i >= 0; --i) {\n\t\t    var dqdt = ckt.alpha0*ckt.q[i] + ckt.alpha1*ckt.oldq[i] +\n\t\t\tckt.alpha2*ckt.old2q[i];\n\t\t    rhs[i] = ckt.beta0[i]*ckt.c[i] + ckt.beta1[i]*ckt.oldc[i] - dqdt;\n\t\t}\n\t\t// matrix = beta0*G + alpha0*C.\n\t\tmat_scale_add(ckt.G,ckt.C,ckt.beta0,ckt.alpha0,ckt.matrix);\n\t    }\n\n\t    var p = new Array(3);\n\t    function interp_coeffs(t, t0, t1, t2) {\n\t\t// Poly coefficients\n\t\tvar dtt0 = (t - t0);\n\t\tvar dtt1 = (t - t1);\n\t\tvar dtt2 = (t - t2);\n\t\tvar dt0dt1 = (t0 - t1);\n\t\tvar dt0dt2 = (t0 - t2);\n\t\tvar dt1dt2 = (t1 - t2);\n\t\tp[0] = (dtt1*dtt2)/(dt0dt1 * dt0dt2);\n\t\tp[1] = (dtt0*dtt2)/(-dt0dt1 * dt1dt2);\n\t\tp[2] = (dtt0*dtt1)/(dt0dt2 * dt1dt2);\n\t\treturn p;\n\t    }\n\n\t    function pick_step(ckt, step_index) {\n\t\tvar min_shrink_factor = 1.0/lte_step_decrease_factor;\n\t        var max_growth_factor = time_step_increase_factor;\n\t\tvar N = ckt.N;\n\t\tvar p = interp_coeffs(ckt.time, ckt.oldt, ckt.old2t, ckt.old3t);\n\t\tvar trapcoeff = 0.5*(ckt.time - ckt.oldt)/(ckt.time - ckt.old3t);\n\t\tvar maxlteratio = 0.0;\n\t\tfor (var i = ckt.N-1; i >= 0; --i) {\n\t\t    if (ckt.ltecheck[i]) { // Check lte on variable\n\t\t\tvar pred = p[0]*ckt.oldsol[i] + p[1]*ckt.old2sol[i] + p[2]*ckt.old3sol[i];\n\t\t\tvar lte = Math.abs((ckt.solution[i] - pred))*trapcoeff;\n\t\t\tvar lteratio = lte/(lterel*(ckt.abstol[i] + reltol*ckt.soln_max[i]));\n\t\t\tmaxlteratio = Math.max(maxlteratio, lteratio);\n\t\t    }\n\t\t}\n\t\tvar new_step;\n\t\tvar lte_step_ratio = 1.0/Math.pow(maxlteratio,1/3); // Cube root because trap\n\t\tif (lte_step_ratio < 1.0) { // Shrink the timestep to make lte\n\t\t    lte_step_ratio = Math.max(lte_step_ratio,min_shrink_factor);\n\t\t    new_step = (ckt.time - ckt.oldt)*0.75*lte_step_ratio;\n\t\t    new_step = Math.max(new_step, ckt.min_step);\n\t\t} else {\n\t\t    lte_step_ratio = Math.min(lte_step_ratio, max_growth_factor);\n\t\t    if (lte_step_ratio > 1.2)  /* Increase timestep due to lte. */\n\t\t\tnew_step = (ckt.time - ckt.oldt) * lte_step_ratio / 1.2;\n\t\t    else\n\t\t\tnew_step = (ckt.time - ckt.oldt);\n\t\t    new_step = Math.min(new_step, ckt.max_step);\n\t\t}\n\t\treturn new_step;\n\t    }\n\n\t    // Standard to do a dc analysis before transient\n\t    // Otherwise, do the setup also done in dc.\n\t    no_dc = false;\n\t    if ((this.diddc == false) && (no_dc == false)) {\n\t\tif (this.dc() == undefined) { // DC failed, realloc mats and vects.\n\t\t    alert('DC failed, trying transient analysis from zero.');\n\t\t    this.finalized = false;  // Reset the finalization.\n\t\t    if (this.finalize() == false)\n\t\t\treturn undefined;\n\t\t}\n\t    }\n\t    else {\n\t\tif (this.finalize() == false) // Allocate matrices and vectors.\n\t\t    return undefined;\n\t    }\n\n\t    // Tired of typing this, and using \"with\" generates hate mail.\n\t    var N = this.N;\n\n\t    // build array to hold list of results for each variable\n\t    // last entry is for timepoints.\n\t    var response = new Array(N + 1);\n        for (var i = N; i >= 0; --i) response[i] = [];\n\n\t    // Allocate back vectors for up to a second order method\n\t    this.old3sol = new Array(this.N);\n\t    this.old3q = new Array(this.N);\n\t    this.old2sol = new Array(this.N);\n\t    this.old2q = new Array(this.N);\n\t    this.oldsol = new Array(this.N);\n\t    this.oldq = new Array(this.N);\n\t    this.q = new Array(this.N);\n\t    this.oldc = new Array(this.N);\n\t    this.c = new Array(this.N);\n\t    this.alpha0 = 1.0;\n\t    this.alpha1 = 0.0;\n\t    this.alpha2 = 0.0;\n\t    this.beta0 = new Array(this.N);\n\t    this.beta1 = new Array(this.N);\n\n\t    // Mark a set of algebraic variable (don't miss hidden ones!).\n\t    this.ar = this.algebraic(this.C);\n\n\t    // Non-algebraic variables and probe variables get lte\n\t    this.ltecheck = new Array(this.N);\n\t    for (var i = N; i >= 0; --i)\n\t\tthis.ltecheck[i] = (this.ar[i] == 0);\n\n\t    for (var name in this.node_map) {\n\t\tvar index = this.node_map[name];\n\t\tfor (var i = probenames.length; i >= 0; --i) {\n\t\t    if (name == probenames[i]) {\n\t\t\tthis.ltecheck[index] = true;\n\t\t\tbreak;\n\t\t    }\n\t\t}\n\t    }\n\n\t    // Check for periodic sources\n\t    var period = tstop - tstart;\n\t    for (var i = this.voltage_sources.length - 1; i >= 0; --i) {\n\t\tvar per = this.voltage_sources[i].src.period;\n\t\tif (per > 0)\n\t\t    period = Math.min(period, per);\n\t    }\n\t    for (var i = this.current_sources.length - 1; i >= 0; --i) {\n\t\tvar per = this.current_sources[i].src.period;\n\t\tif (per > 0)\n\t\t    period = Math.min(period, per);\n\t    }\n\t    this.periods = Math.ceil((tstop - tstart)/period);\n\n\t    this.time = tstart;\n\t    // ntpts adjusted by numbers of periods in input\n\t    this.max_step = (tstop - tstart)/(this.periods*ntpts);\n\t    this.min_step = this.max_step/1e8;\n\t    var new_step = this.max_step/1e6;\n\t    this.oldt = this.time - new_step;\n\n\t    // Initialize old crnts, charges, and solutions.\n\t    load_tran(this,this.solution,this.rhs)\n\t    for (var i = N-1; i >= 0; --i) {\n\t\tthis.old3sol[i] = this.solution[i];\n\t\tthis.old2sol[i] = this.solution[i];\n\t\tthis.oldsol[i] = this.solution[i];\n\t\tthis.old3q[i] = this.q[i];\n\t\tthis.old2q[i] = this.q[i];\n\t\tthis.oldq[i] = this.q[i];\n\t\tthis.oldc[i] = this.c[i];\n\t    }\n\n\t    var beta0,beta1;\n\t    // Start with two pseudo-Euler steps, maximum 50000 steps/period\n\t    var max_nsteps = this.periods*50000;\n\t    for(var step_index = -3; step_index < max_nsteps; step_index++) {\n\t\t// Save the just computed solution, and move back q and c.\n\t\tfor (var i = this.N - 1; i >= 0; --i) {\n\t\t    if (step_index >= 0)\n\t\t\tresponse[i].push(this.solution[i]);\n\t\t    this.oldc[i] = this.c[i];\n\t\t    this.old3sol[i] = this.old2sol[i];\n\t\t    this.old2sol[i] = this.oldsol[i];\n\t\t    this.oldsol[i] = this.solution[i];\n\t\t    this.old3q[i] = this.oldq[i];\n\t\t    this.old2q[i] = this.oldq[i];\n\t\t    this.oldq[i] = this.q[i];\n\t\t}\n\n\t\tif (step_index < 0) {  // Take a prestep using BE\n\t\t    this.old3t = this.old2t - (this.oldt-this.old2t)\n\t\t    this.old2t = this.oldt - (tstart-this.oldt)\n\t\t    this.oldt = tstart - (this.time - this.oldt);\n\t\t    this.time = tstart;\n\t\t    beta0 = 1.0;\n\t\t    beta1 = 0.0;\n\t\t} else {  // Take a regular step\n\t\t    // Save the time, and rotate time wheel\n\t\t    response[this.N].push(this.time);\n\t\t    this.old3t = this.old2t;\n\t\t    this.old2t = this.oldt;\n\t\t    this.oldt = this.time;\n\t\t    // Make sure we come smoothly in to the interval end.\n\t\t    if (this.time >= tstop) break;  // We're done.\n\t\t    else if(this.time + new_step > tstop)\n\t\t\tthis.time = tstop;\n\t\t    else if(this.time + 1.5*new_step > tstop)\n\t\t\tthis.time += (2/3)*(tstop - this.time);\n\t\t    else\n\t\t\tthis.time += new_step;\n\n\t\t    // Use trap (average old and new crnts.\n\t\t    beta0 = 0.5;\n\t\t    beta1 = 0.5;\n\t\t}\n\n\t\t// For trap rule, turn off current avging for algebraic eqns\n\t\tfor (var i = this.N - 1; i >= 0; --i) {\n\t\t    this.beta0[i] = beta0 + this.ar[i]*beta1;\n\t\t    this.beta1[i] = (1.0 - this.ar[i])*beta1;\n\t\t}\n\n\t\t// Loop to find NR converging timestep with okay LTE\n\t\twhile (true) {\n\t\t    // Set the timestep coefficients (alpha2 is for bdf2).\n\t\t    this.alpha0 = 1.0/(this.time - this.oldt);\n\t\t    this.alpha1 = -this.alpha0;\n\t\t    this.alpha2 = 0;\n\n\t\t    // If timestep is 1/10,000th of tstop, just use BE.\n\t\t    if ((this.time-this.oldt) < 1.0e-4*tstop) {\n\t\t\tfor (var i = this.N - 1; i >= 0; --i) {\n\t\t\t    this.beta0[i] = 1.0;\n\t\t\t    this.beta1[i] = 0.0;\n\t\t\t}\n\t\t    }\n\t\t    // Use Newton to compute the solution.\n\t\t    var iterations = this.find_solution(load_tran,max_tran_iters);\n\n\t\t    // If NR succeeds and stepsize is at min, accept and newstep=maxgrowth*minstep.\n\t\t    // Else if Newton Fails, shrink step by a factor and try again\n\t\t    // Else LTE picks new step, if bigger accept current step and go on.\n\t\t    if ((iterations != undefined) &&\n\t\t\t(step_index <= 0 || (this.time-this.oldt) < (1+reltol)*this.min_step)) {\n\t\t\tif (step_index > 0) new_step = time_step_increase_factor*this.min_step;\n\t\t\tbreak;\n\t\t    } else if (iterations == undefined) {  // NR nonconvergence, shrink by factor\n\t\t\tthis.time = this.oldt +\n\t\t\t    (this.time - this.oldt)/nr_step_decrease_factor;\n\t\t    } else {  // Check the LTE and shrink step if needed.\n\t\t\tnew_step = pick_step(this, step_index);\n\t\t\tif (new_step < (1.0 - reltol)*(this.time - this.oldt)) {\n\t\t\t    this.time = this.oldt + new_step;  // Try again\n\t\t\t}\n\t\t\telse\n\t\t\t    break;  // LTE okay, new_step for next step\n\t\t    }\n\t\t}\n\t    }\n\n\t    // create solution dictionary\n        var result = [];\n\t    for (var name in this.node_map) {\n\t\tvar index = this.node_map[name];\n\t\tresult[name] = (index == -1) ? 0 : response[index];\n\t    }\n\t    // capture branch currents from voltage sources\n\t    for (var i = this.voltage_sources.length - 1; i >= 0; --i) {\n\t\tvar v = this.voltage_sources[i];\n\t\tresult['I('+v.name+')'] = response[v.branch];\n\t    }\n\n\t    result['_time_'] = response[this.N];\n\t    return result;\n\t}\n\n\t// AC analysis: npts/decade for freqs in range [fstart,fstop]\n\t// result['_frequencies_'] = vector of log10(sample freqs)\n\t// result['xxx'] = vector of dB(response for node xxx)\n        // NOTE: Normalization removed in schematic.js, jkw.\n        Circuit.prototype.ac = function(npts,fstart,fstop,source_name) {\n\n\t    if (this.dc() == undefined) { // DC failed, realloc mats and vects.\n\t\treturn undefined;\n\t    }\n\n\t    var N = this.N;\n\t    var G = this.G;\n\t    var C = this.C;\n\n\t    // Complex numbers, we're going to need a bigger boat\n\t    var matrixac = mat_make(2*N, (2*N)+1);\n\n            // Get the source used for ac\n\t    if (this.device_map[source_name] === undefined) {\n\t\talert('AC analysis refers to unknown source ' + source_name);\n\t\treturn 'AC analysis failed, unknown source';\n\t    }\n\t    this.device_map[source_name].load_ac(this,this.rhs);\n\n\t    // build array to hold list of magnitude and phases for each node\n\t    // last entry is for frequency values\n\t    var response = new Array(2*N + 1);\n        for (var i = 2*N; i >= 0; --i) response[i] = [];\n\n\t    // multiplicative frequency increase between freq points\n\t    var delta_f = Math.exp(Math.LN10/npts);\n\n\t    var phase_offset = new Array(N);\n\t    for (var i = N-1; i >= 0; --i) phase_offset[i] = 0;\n\n\t    var f = fstart;\n\t    fstop *= 1.0001;  // capture that last freq point!\n\t    while (f <= fstop) {\n\t\tvar omega = 2 * Math.PI * f;\n\t\tresponse[2*N].push(f);   // 2*N for magnitude and phase\n\n\t\t// Find complex x+jy that sats Gx-omega*Cy=rhs; omega*Cx+Gy=0\n\t\t// Note: solac[0:N-1]=x, solac[N:2N-1]=y\n\t\tfor (var i = N-1; i >= 0; --i) {\n\t\t    // First the rhs, replicated for real and imaginary\n\t\t    matrixac[i][2*N] = this.rhs[i];\n\t\t    matrixac[i+N][2*N] = 0;\n\n\t\t    for (var j = N-1; j >= 0; --j) {\n\t\t\tmatrixac[i][j] = G[i][j];\n\t\t\tmatrixac[i+N][j+N] = G[i][j];\n\t\t\tmatrixac[i][j+N] = -omega*C[i][j];\n\t\t\tmatrixac[i+N][j] = omega*C[i][j];\n\t\t    }\n\t\t}\n\n\t\t// Compute the small signal response\n\t\tvar solac = mat_solve(matrixac);\n\n\t\t// Save magnitude and phase\n\t\tfor (var i = N - 1; i >= 0; --i) {\n\t\t    var mag = Math.sqrt(solac[i]*solac[i] + solac[i+N]*solac[i+N]);\n\t\t    response[i].push(mag);\n\n\t\t    // Avoid wrapping phase, add or sub 180 for each jump\n\t\t    var phase = 180*(Math.atan2(solac[i+N],solac[i])/Math.PI);\n\t\t    var phasei = response[i+N];\n\t\t    var L = phasei.length;\n\t\t    // Look for a one-step jump greater than 90 degrees\n\t\t    if (L > 1) {\n\t\t\tvar phase_jump = phase + phase_offset[i] - phasei[L-1];\n\t\t\tif (phase_jump > 90) {\n\t\t\t    phase_offset[i] -= 360;\n\t\t\t} else if (phase_jump < -90) {\n\t\t\t    phase_offset[i] += 360;\n\t\t\t}\n\t\t    }\n\t\t    response[i+N].push(phase + phase_offset[i]);\n\t\t}\n\t\tf *= delta_f;    // increment frequency\n\t    }\n\n\t    // create solution dictionary\n        var result = [];\n\t    for (var name in this.node_map) {\n\t\tvar index = this.node_map[name];\n\t\tresult[name] = (index == -1) ? 0 : response[index];\n\t\tresult[name+'_phase'] = (index == -1) ? 0 : response[index+N];\n\t    }\n\t    result['_frequencies_'] = response[2*N];\n\t    return result;\n\t}\n\n        // Helper for adding devices to a circuit, warns on duplicate device names.\n        Circuit.prototype.add_device = function(d,name) {\n\t    // Add device to list of devices and to device map\n\t    this.devices.push(d);\n\t    d.name = name;\n\t    if (name) {\n\t\tif (this.device_map[name] === undefined)\n\t\t    this.device_map[name] = d;\n\t\telse {\n\t\t    alert('Warning: two circuit elements share the same name ' + name);\n\t\t    this.device_map[name] = d;\n\t\t}\n\t    }\n\t    return d;\n\t}\n\n\tCircuit.prototype.r = function(n1,n2,v,name) {\n\t    // try to convert string value into numeric value, barf if we can't\n\t    if ((typeof v) == 'string') {\n\t\tv = parse_number(v,undefined);\n\t\tif (v === undefined) return undefined;\n\t    }\n\n\t    if (v != 0) {\n\t\tvar d = new Resistor(n1,n2,v);\n\t\treturn this.add_device(d, name);\n\t    } else return this.v(n1,n2,'0',name);   // zero resistance == 0V voltage source\n\t}\n\n\tCircuit.prototype.d = function(n1,n2,area,type,name) {\n\t    // try to convert string value into numeric value, barf if we can't\n\t    if ((typeof area) == 'string') {\n\t\tarea = parse_number(area,undefined);\n\t\tif (area === undefined) return undefined;\n\t    }\n\n\t    if (area != 0) {\n\t\tvar d = new Diode(n1,n2,area,type);\n\t\treturn this.add_device(d, name);\n\t    } // zero area diodes discarded.\n\t}\n\n\tCircuit.prototype.c = function(n1,n2,v,name) {\n\t    // try to convert string value into numeric value, barf if we can't\n\t    if ((typeof v) == 'string') {\n\t\tv = parse_number(v,undefined);\n\t\tif (v === undefined) return undefined;\n\t    }\n\t    var d = new Capacitor(n1,n2,v);\n\t    return this.add_device(d, name);\n\t}\n\n\tCircuit.prototype.l = function(n1,n2,v,name) {\n\t    // try to convert string value into numeric value, barf if we can't\n\t    if ((typeof v) == 'string') {\n\t\tv = parse_number(v,undefined);\n\t\tif (v === undefined) return undefined;\n\t    }\n\t    var branch = this.node(undefined,T_CURRENT);\n\t    var d = new Inductor(n1,n2,branch,v);\n\t    return this.add_device(d, name);\n\t}\n\n        Circuit.prototype.v = function(n1,n2,v,name) {\n\t    var branch = this.node(undefined,T_CURRENT);\n\t    var d = new VSource(n1,n2,branch,v);\n\t    this.voltage_sources.push(d);\n\t    return this.add_device(d, name);\n\t}\n\n\tCircuit.prototype.i = function(n1,n2,v,name) {\n\t    var d = new ISource(n1,n2,v);\n\t    this.current_sources.push(d);\n\t    return this.add_device(d, name);\n\t}\n\n        Circuit.prototype.opamp = function(np,nn,no,ng,A,name) {\n            var ratio;\n\t    // try to convert string value into numeric value, barf if we can't\n\t    if ((typeof A) == 'string') {\n\t\tratio = parse_number(A,undefined);\n\t\tif (A === undefined) return undefined;\n\t    }\n\t    var branch = this.node(undefined,T_CURRENT);\n\t    var d = new Opamp(np,nn,no,ng,branch,A,name);\n\t    return this.add_device(d, name);\n\t}\n\n        Circuit.prototype.n = function(d,g,s, ratio, name) {\n\t    // try to convert string value into numeric value, barf if we can't\n\t    if ((typeof ratio) == 'string') {\n\t\tratio = parse_number(ratio,undefined);\n\t\tif (ratio === undefined) return undefined;\n\t    }\n\t    var d = new Fet(d,g,s,ratio,name,'n');\n\t    return this.add_device(d, name);\n\t}\n\n        Circuit.prototype.p = function(d,g,s, ratio, name) {\n\t    // try to convert string value into numeric value, barf if we can't\n\t    if ((typeof ratio) == 'string') {\n\t\tratio = parse_number(ratio,undefined);\n\t\tif (ratio === undefined) return undefined;\n\t    }\n\t    var d = new Fet(d,g,s,ratio,name,'p');\n\t    return this.add_device(d, name);\n\t}\n\n\t///////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Support for creating conductance and capacitance matrices associated with\n        //  modified nodal analysis (unknowns are node voltages and inductor and voltage\n        //  source currents).\n        //  The linearized circuit is written as\n        //          C d/dt x = G x + rhs\n        //  x - vector of node voltages and element currents\n        //  rhs - vector of source values\n        //  C - Matrix whose values are capacitances and inductances, has many zero rows.\n        //  G - Matrix whose values are conductances and +-1's.\n\t//\n\t////////////////////////////////////////////////////////////////////////////////\n\n\t// add val component between two nodes to matrix M\n\t// Index of -1 refers to ground node\n        Circuit.prototype.add_two_terminal = function(i,j,g,M) {\n\t    if (i >= 0) {\n\t\tM[i][i] += g;\n\t\tif (j >= 0) {\n\t\t    M[i][j] -= g;\n\t\t    M[j][i] -= g;\n\t\t    M[j][j] += g;\n\t\t}\n\t    } else if (j >= 0)\n\t\tM[j][j] += g;\n\t}\n\n\t// add val component between two nodes to matrix M\n\t// Index of -1 refers to ground node\n        Circuit.prototype.get_two_terminal = function(i,j,x) {\n\t    var xi_minus_xj = 0;\n\t    if (i >= 0) xi_minus_xj = x[i];\n\t    if (j >= 0) xi_minus_xj -= x[j];\n\t    return xi_minus_xj\n\t}\n\n        Circuit.prototype.add_conductance_l = function(i,j,g) {\n            this.add_two_terminal(i,j,g, this.Gl)\n\t}\n\n        Circuit.prototype.add_conductance = function(i,j,g) {\n            this.add_two_terminal(i,j,g, this.G)\n\t}\n\n        Circuit.prototype.add_capacitance = function(i,j,c) {\n            this.add_two_terminal(i,j,c,this.C)\n\t}\n\n\t// add individual conductance to Gl matrix\n\tCircuit.prototype.add_to_Gl = function(i,j,g) {\n\t    if (i >=0 && j >= 0)\n\t\tthis.Gl[i][j] += g;\n\t}\n\n\t// add individual conductance to Gl matrix\n\tCircuit.prototype.add_to_G = function(i,j,g) {\n\t    if (i >=0 && j >= 0)\n\t\tthis.G[i][j] += g;\n\t}\n\n\t// add individual capacitance to C matrix\n\tCircuit.prototype.add_to_C = function(i,j,c) {\n\t    if (i >=0 && j >= 0)\n\t\tthis.C[i][j] += c;\n\t}\n\n\t// add source info to rhs\n        Circuit.prototype.add_to_rhs = function(i,v,rhs) {\n\t    if (i >= 0)\trhs[i] += v;\n\t}\n\n\n\t///////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Generic matrix support - making, copying, factoring, rank, etc\n\t//  Note, Matrices are stored using nested javascript arrays.\n\t////////////////////////////////////////////////////////////////////////////////\n\n        // Allocate an NxM matrix\n        function mat_make(N,M) {\n\t    var mat = new Array(N);\n\t    for (var i = N - 1; i >= 0; --i) {\n\t\tmat[i] = new Array(M);\n\t\tfor (var j = M - 1; j >= 0; --j) {\n\t\t    mat[i][j] = 0.0;\n\t\t}\n\t    }\n\t    return mat;\n\t}\n\n        // Form b = scale*Mx\n        function mat_v_mult(M,x,b,scale) {\n\t    var n = M.length;\n\t    var m = M[0].length;\n\n\t    if (n != b.length || m != x.length)\n\t\tthrow 'Rows of M mismatched to b or cols mismatch to x.';\n\n\t    for (var i = 0; i < n; i++) {\n\t\tvar temp = 0;\n\t\tfor (var j = 0; j < m; j++) temp += M[i][j]*x[j];\n\t\tb[i] = scale*temp;  // Recall the neg in the name\n\t    }\n\t}\n\n        // C = scalea*A + scaleb*B, scalea, scaleb eithers numbers or arrays (row scaling)\n        function mat_scale_add(A, B, scalea, scaleb, C) {\n\t    var n = A.length;\n\t    var m = A[0].length;\n\n\t    if (n > B.length || m > B[0].length)\n\t\tthrow 'Row or columns of A to large for B';\n\t    if (n > C.length || m > C[0].length)\n\t\tthrow 'Row or columns of A to large for C';\n\t    if ((typeof scalea == 'number') && (typeof scaleb == 'number'))\n\t\tfor (var i = 0; i < n; i++)\n\t\t    for (var j = 0; j < m; j++)\n\t\t\tC[i][j] = scalea*A[i][j] + scaleb*B[i][j];\n\t    else if ((typeof scaleb == 'number') && (scalea instanceof Array))\n\t\tfor (var i = 0; i < n; i++)\n\t\t    for (var j = 0; j < m; j++)\n\t\t\tC[i][j] = scalea[i]*A[i][j] + scaleb*B[i][j];\n\t    else if ((typeof scaleb instanceof Array) && (scalea instanceof Array))\n\t\tfor (var i = 0; i < n; i++)\n\t\t    for (var j = 0; j < m; j++)\n\t\t\tC[i][j] = scalea[i]*A[i][j] + scaleb[i]*B[i][j];\n\t    else\n\t\tthrow 'scalea and scaleb must be scalars or Arrays';\n\t}\n\n        // Returns a vector of ones and zeros, ones denote algebraic\n        // variables (rows that can be removed without changing rank(M).\n        Circuit.prototype.algebraic = function(M) {\n\t    var Nr = M.length\n\t    var Mc = mat_make(Nr, Nr);\n\t    mat_copy(M,Mc);\n\t    var R = mat_rank(Mc);\n\n\t    var one_if_alg = new Array(Nr);\n\t    for (var row = 0; row < Nr; row++) {  // psuedo gnd row small\n\t\tfor (var col = Nr - 1; col >= 0; --col)\n\t\t    Mc[row][col] = 0;\n\t\tif (mat_rank(Mc) == R)  // Zeroing row left rank unchanged\n\t\t    one_if_alg[row] = 1;\n\t\telse { // Zeroing row changed rank, put back\n\t\t    for (var col = Nr - 1; col >= 0; --col)\n\t\t\tMc[row][col] = M[row][col];\n\t\t    one_if_alg[row] = 0;\n\t\t}\n\t    }\n\t    return one_if_alg;\n\t}\n\n        // Copy A -> using the bounds of A\n\tfunction mat_copy(src,dest) {\n\t    var n = src.length;\n\t    var m = src[0].length;\n\t    if (n > dest.length || m >  dest[0].length)\n\t\tthrow 'Rows or cols > rows or cols of dest';\n\n\t    for (var i = 0; i < n; i++)\n\t\tfor (var j = 0; j < m; j++)\n\t\t    dest[i][j] = src[i][j];\n\t}\n        // Copy and transpose A -> using the bounds of A\n\tfunction mat_copy_transposed(src,dest) {\n\t    var n = src.length;\n\t    var m = src[0].length;\n\t    if (n > dest[0].length || m >  dest.length)\n\t\tthrow 'Rows or cols > cols or rows of dest';\n\n\t    for (var i = 0; i < n; i++)\n\t\tfor (var j = 0; j < m; j++)\n\t\t    dest[j][i] = src[i][j];\n\t}\n\n\n\t// Uses GE to determine rank.\n        function mat_rank(Mo) {\n\t    var Nr = Mo.length;  // Number of rows\n\t    var Nc = Mo[0].length;  // Number of columns\n\t    var temp,i,j;\n\t    // Make a copy to avoid overwriting\n        var M = mat_make(Nr, Nc);\n\t    mat_copy(Mo,M);\n\n\t    // Find matrix maximum entry\n\t    var max_abs_entry = 0;\n\t    for(var row = Nr-1; row >= 0; --row) {\n\t\tfor(var col = Nr-1; col >= 0; --col) {\n\t\t    if (Math.abs(M[row][col]) > max_abs_entry)\n\t\t\tmax_abs_entry = Math.abs(M[row][col]);\n\t\t}\n\t    }\n\n\t    // Gaussian elimination to find rank\n\t    var the_rank = 0;\n\t    var start_col = 0;\n\t    for (var row = 0; row < Nr; row++) {\n\t\t// Search for first nonzero column in the remaining rows.\n\t\tfor (var col = start_col; col < Nc; col++) {\n\t\t    var max_v = Math.abs(M[row][col]);\n\t\t    var max_row = row;\n\t\t    for (var i = row + 1; i < Nr; i++) {\n\t\t\ttemp = Math.abs(M[i][col]);\n\t\t\tif (temp > max_v) { max_v = temp; max_row = i; }\n\t\t    }\n\t\t    // if max_v non_zero, column is nonzero, eliminate in subsequent rows\n\t\t    if (Math.abs(max_v) > eps*max_abs_entry) {\n\t\t\tstart_col = col+1;\n\t\t\tthe_rank += 1;\n\t\t        // Swap rows to get max in M[row][col]\n\t\t\ttemp = M[row];\n\t\t\tM[row] = M[max_row];\n\t\t\tM[max_row] = temp;\n\n\t\t\t// now eliminate this column for all subsequent rows\n\t\t\tfor (var i = row + 1; i < Nr; i++) {\n\t\t\t    temp = M[i][col]/M[row][col];   // multiplier for current row\n\t\t\t    if (temp != 0)  // subtract\n\t\t\t    for (var j = col; j < Nc; j++) M[i][j] -= M[row][j]*temp;\n\t\t\t}\n\t\t\t// Now move on to the next row\n\t\t\tbreak;\n\t\t    }\n\t\t}\n\t    }\n\n\t    return the_rank;\n\t}\n\n\t// Solve Mx=b and return vector x using R^TQ^T factorization.\n        // Multiplication by R^T implicit, should be null-space free soln.\n        // M should have the extra column!\n        // Almost everything is in-lined for speed, sigh.\n        function mat_solve_rq(M, rhs) {\n            var scale;\n\t    var Nr = M.length;  // Number of rows\n\t    var Nc = M[0].length;  // Number of columns\n\n\t    // Copy the rhs in to the last column of M if one is given.\n\t    if (rhs != null) {\n\t\tfor (var row = Nr - 1; row >= 0; --row)\n\t\t    M[row][Nc-1] = rhs[row];\n\t    }\n\n\t    var mat_scale = 0; // Sets the scale for comparison to zero.\n\t    var max_nonzero_row = Nr-1;  // Assumes M nonsingular.\n\t    for (var row = 0; row < Nr; row++) {\n\t\t// Find largest row with largest 2-norm\n\t\tvar max_row = row;\n\t\tvar maxsumsq = 0;\n\t\tfor (var rowp = row; rowp < Nr; rowp++) {\n\t\t    var Mr = M[rowp];\n\t\t    var sumsq = 0;\n\t\t    for (var col = Nc-2; col >= 0; --col)  // Last col=rhs\n\t\t\tsumsq += Mr[col]*Mr[col];\n\t\t    if ((row == rowp) || (sumsq > maxsumsq)) {\n\t\t\tmax_row = rowp;\n\t\t\tmaxsumsq = sumsq;\n\t\t    }\n\t\t}\n\t\tif (max_row > row) { // Swap rows if not max row\n\t\t    var temp = M[row];\n\t\t    M[row] = M[max_row];\n\t\t    M[max_row] = temp;\n\t\t}\n\n\t\t// Calculate row norm, save if this is first (largest)\n        var row_norm = Math.sqrt(maxsumsq);\n\t\tif (row == 0) mat_scale = row_norm;\n\n\t\t// Check for all zero rows\n\t\tif (row_norm > mat_scale*eps)\n\t\t    scale = 1.0/row_norm;\n\t\telse {\n\t\t    max_nonzero_row = row - 1;  // Rest will be nullspace of M\n\t\t    break;\n\t\t}\n\n\t\t// Nonzero row, eliminate from rows below\n\t\tvar Mr = M[row];\n\t\tfor (var col =  Nc-1; col >= 0; --col) // Scale rhs also\n\t\t    Mr[col] *= scale;\n\t\tfor (var rowp = row + 1; rowp < Nr; rowp++) { // Update.\n\t\t    var Mrp = M[rowp];\n\t\t    var inner = 0;\n\t\t    for (var col =  Nc-2; col >= 0; --col)  // Project\n\t\t\tinner += Mr[col]*Mrp[col];\n\t\t    for (var col =  Nc-1; col >= 0; --col) // Ortho (rhs also)\n\t\t\tMrp[col] -= inner *Mr[col];\n\t\t}\n\t    }\n\n\t    // Last Column of M has inv(R^T)*rhs.  Scale rows of Q to get x.\n\t    var x = new Array(Nc-1);\n\t    for (var col = Nc-2; col >= 0; --col)\n\t\tx[col] = 0;\n\t    for (var row = max_nonzero_row; row >= 0; --row) {\n\t\tMr = M[row];\n\t\tfor (var col = Nc-2; col >= 0; --col) {\n\t\t    x[col] += Mr[col]*Mr[Nc-1];\n\t\t}\n\t    }\n\n\t    return x;\n\t}\n\n\t// solve Mx=b and return vector x given augmented matrix M = [A | b]\n\t// Uses Gaussian elimination with partial pivoting\n        function mat_solve(M,rhs) {\n\t    var N = M.length;      // augmented matrix M has N rows, N+1 columns\n\t    var temp,i,j;\n\n\t    // Copy the rhs in to the last column of M if one is given.\n\t    if (rhs != null) {\n\t\tfor (var row = 0; row < N ; row++)\n\t\t    M[row][N] = rhs[row];\n\t    }\n\n\t    // gaussian elimination\n\t    for (var col = 0; col < N ; col++) {\n\t\t// find pivot: largest abs(v) in this column of remaining rows\n\t\tvar max_v = Math.abs(M[col][col]);\n\t\tvar max_col = col;\n\t\tfor (i = col + 1; i < N; i++) {\n\t\t    temp = Math.abs(M[i][col]);\n\t\t    if (temp > max_v) { max_v = temp; max_col = i; }\n\t\t}\n\n\t\t// if no value found, generate a small conductance to gnd\n\t\t// otherwise swap current row with pivot row\n\t\tif (max_v == 0) M[col][col] = eps;\n\t\telse {\n\t\t    temp = M[col];\n\t\t    M[col] = M[max_col];\n\t\t    M[max_col] = temp;\n\t\t}\n\n\t\t// now eliminate this column for all subsequent rows\n\t\tfor (i = col + 1; i < N; i++) {\n\t\t    temp = M[i][col]/M[col][col];   // multiplier we'll use for current row\n\t\t    if (temp != 0)\n\t\t\t// subtract current row from row we're working on\n\t\t\t// remember to process b too!\n\t\t\tfor (j = col; j <= N; j++) M[i][j] -= M[col][j]*temp;\n\t\t}\n\t    }\n\n\t    // matrix is now upper triangular, so solve for elements of x starting\n\t    // with the last row\n\t    var x = new Array(N);\n\t    for (i = N-1; i >= 0; --i) {\n\t\ttemp = M[i][N];   // grab b[i] from augmented matrix as RHS\n\t\t// subtract LHS term from RHS using known x values\n\t\tfor (j = N-1; j > i; --j) temp -= M[i][j]*x[j];\n\t\t// now compute new x value\n\t\tx[i] = temp/M[i][i];\n\t    }\n\n\t    return x;\n\t}\n\n\t// test solution code, expect x = [2,3,-1]\n\t//M = [[2,1,-1,8],[-3,-1,2,-11],[-2,1,2,-3]];\n\t//x = mat_solve(M);\n\t//y = 1;  // so we have place to set a breakpoint :)\n\n\t///////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Device base class\n\t//\n\t////////////////////////////////////////////////////////////////////////////////\n\n\tfunction Device() {\n\t}\n\n\t// complete initial set up of device\n\tDevice.prototype.finalize = function() {\n\t}\n\n        // Load the linear elements in to Gl and C\n        Device.prototype.load_linear = function(ckt) {\n\t}\n\n\t// load linear system equations for dc analysis\n\t// (inductors shorted and capacitors opened)\n        Device.prototype.load_dc = function(ckt,soln,rhs) {\n\t}\n\n\t// load linear system equations for tran analysis\n\tDevice.prototype.load_tran = function(ckt,soln) {\n\t}\n\n\t// load linear system equations for ac analysis:\n\t// current sources open, voltage sources shorted\n\t// linear models at operating point for everyone else\n\tDevice.prototype.load_ac = function(ckt,rhs) {\n\t}\n\n\t// return time of next breakpoint for the device\n\tDevice.prototype.breakpoint = function(time) {\n\t    return undefined;\n\t}\n\n\t///////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Parse numbers in engineering notation\n\t//\n\t///////////////////////////////////////////////////////////////////////////////\n\n\t// convert first character of argument into an integer\n\tfunction ord(ch) {\n\t    return ch.charCodeAt(0);\n\t}\n\n\t// convert string argument to a number, accepting usual notations\n\t// (hex, octal, binary, decimal, floating point) plus engineering\n\t// scale factors (eg, 1k = 1000.0 = 1e3).\n\t// return default if argument couldn't be interpreted as a number\n\tfunction parse_number(s,default_v) {\n\t    var slen = s.length;\n\t    var multiplier = 1;\n\t    var result = 0;\n\t    var index = 0;\n\n\t    // skip leading whitespace\n\t    while (index < slen && s.charAt(index) <= ' ') index += 1;\n\t    if (index == slen) return default_v;\n\n\t    // check for leading sign\n\t    if (s.charAt(index) == '-') {\n\t\tmultiplier = -1;\n\t\tindex += 1;\n\t    } else if (s.charAt(index) == '+')\n\t\tindex += 1;\n\t    var start = index;   // remember where digits start\n\n\t    // if leading digit is 0, check for hex, octal or binary notation\n\t    if (index >= slen) return default_v;\n\t    else if (s.charAt(index) == '0') {\n\t\tindex += 1;\n\t\tif (index >= slen) return 0;\n\t\tif (s.charAt(index) == 'x' || s.charAt(index) == 'X') { // hex\n\t\t    while (true) {\n\t\t\tindex += 1;\n\t\t\tif (index >= slen) break;\n\t\t\tif (s.charAt(index) >= '0' && s.charAt(index) <= '9')\n\t\t\t    result = result*16 + ord(s.charAt(index)) - ord('0');\n\t\t\telse if (s.charAt(index) >= 'A' && s.charAt(index) <= 'F')\n\t\t\t    result = result*16 + ord(s.charAt(index)) - ord('A') + 10;\n\t\t\telse if (s.charAt(index) >= 'a' && s.charAt(index) <= 'f')\n\t\t\t    result = result*16 + ord(s.charAt(index)) - ord('a') + 10;\n\t\t\telse break;\n\t\t    }\n\t\t    return result*multiplier;\n\t\t} else if (s.charAt(index) == 'b' || s.charAt(index) == 'B') {  // binary\n\t\t    while (true) {\n\t\t\tindex += 1;\n\t\t\tif (index >= slen) break;\n\t\t\tif (s.charAt(index) >= '0' && s.charAt(index) <= '1')\n\t\t\t    result = result*2 + ord(s.charAt(index)) - ord('0');\n\t\t\telse break;\n\t\t    }\n\t\t    return result*multiplier;\n\t\t} else if (s.charAt(index) != '.') { // octal\n\t\t    while (true) {\n\t\t\tif (s.charAt(index) >= '0' && s.charAt(index) <= '7')\n\t\t\t    result = result*8 + ord(s.charAt(index)) - ord('0');\n\t\t\telse break;\n\t\t\tindex += 1;\n\t\t\tif (index >= slen) break;\n\t\t    }\n\t\t    return result*multiplier;\n\t\t}\n\t    }\n\t    // read decimal integer or floating-point number\n\t    while (true) {\n\t\tif (s.charAt(index) >= '0' && s.charAt(index) <= '9')\n\t\t    result = result*10 + ord(s.charAt(index)) - ord('0');\n\t\telse break;\n\t\tindex += 1;\n\t\tif (index >= slen) break;\n\t    }\n\n\t    // fractional part?\n\t    if (index < slen && s.charAt(index) == '.') {\n\t\twhile (true) {\n\t\t    index += 1;\n\t\t    if (index >= slen) break;\n\t\t    if (s.charAt(index) >= '0' && s.charAt(index) <= '9') {\n\t\t\tresult = result*10 + ord(s.charAt(index)) - ord('0');\n\t\t\tmultiplier *= 0.1;\n\t\t    } else break;\n\t\t}\n\t    }\n\n\t    // if we haven't seen any digits yet, don't check\n\t    // for exponents or scale factors\n\t    if (index == start) return default_v;\n\n\t    // type of multiplier determines type of result:\n\t    // multiplier is a float if we've seen digits past\n\t    // a decimal point, otherwise it's an int or long.\n\t    // Up to this point result is an int or long.\n\t    result *= multiplier;\n\n\t    // now check for exponent or engineering scale factor.  If there\n\t    // is one, result will be a float.\n\t    if (index < slen) {\n\t\tvar scale = s.charAt(index);\n\t\tindex += 1;\n\t\tif (scale == 'e' || scale == 'E') {\n\t\t    var exponent = 0;\n\t\t    multiplier = 10.0;\n\t\t    if (index < slen) {\n\t\t\tif (s.charAt(index) == '+') index += 1;\n\t\t\telse if (s.charAt(index) == '-') {\n\t\t\t    index += 1;\n\t\t\t    multiplier = 0.1;\n\t\t\t}\n\t\t    }\n\t\t    while (index < slen) {\n\t\t\tif (s.charAt(index) >= '0' && s.charAt(index) <= '9') {\n\t\t\t    exponent = exponent*10 + ord(s.charAt(index)) - ord('0');\n\t\t\t    index += 1;\n\t\t\t} else break;\n\t\t    }\n\t\t    while (exponent > 0) {\n\t\t\texponent -= 1;\n\t\t\tresult *= multiplier;\n\t\t    }\n\t\t} else if (scale == 't' || scale == 'T') result *= 1e12;\n\t\telse if (scale == 'g' || scale == 'G') result *= 1e9;\n\t\telse if (scale == 'M') result *= 1e6;\n\t\telse if (scale == 'k' || scale == 'K') result *= 1e3;\n\t\telse if (scale == 'm') result *= 1e-3;\n\t\telse if (scale == 'u' || scale == 'U') result *= 1e-6;\n\t\telse if (scale == 'n' || scale == 'N') result *= 1e-9;\n\t\telse if (scale == 'p' || scale == 'P') result *= 1e-12;\n\t\telse if (scale == 'f' || scale == 'F') result *= 1e-15;\n\t    }\n\t    // ignore any remaining chars, eg, 1kohms returns 1000\n\t    return result;\n\t}\n\n\tCircuit.prototype.parse_number = parse_number;  // make it easy to call from outside\n\n\t///////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Sources\n\t//\n\t///////////////////////////////////////////////////////////////////////////////\n\n\t// argument is a string describing the source's value (see comments for details)\n\t// source types: dc,step,square,triangle,sin,pulse,pwl,pwl_repeating\n\n\t// returns an object with the following attributes:\n\t//   fun -- name of source function\n\t//   args -- list of argument values\n\t//   value(t) -- compute source value at time t\n\t//   inflection_point(t) -- compute time after t when a time point is needed\n\t//   dc -- value at time 0\n\t//   period -- repeat period for periodic sources (0 if not periodic)\n\n\tfunction parse_source(v) {\n\t    // generic parser: parse v as either <value> or <fun>(<value>,...)\n        var src = {};\n\t    src.period = 0; // Default not periodic\n\t    src.value = function(t) { return 0; }  // overridden below\n\t    src.inflection_point = function(t) { return undefined; };  // may be overridden below\n\n\t    // see if there's a \"(\" in the description\n\t    var index = v.indexOf('(');\n\t    var ch;\n\t    if (index >= 0) {\n\t\tsrc.fun = v.slice(0,index);   // function name is before the \"(\"\n\t\tsrc.args = [];\t// we'll push argument values onto this list\n\t\tvar end = v.indexOf(')',index);\n\t\tif (end == -1) end = v.length;\n\n\t\tindex += 1;     // start parsing right after \"(\"\n\t\twhile (index < end) {\n\t\t    // figure out where next argument value starts\n\t\t    ch = v.charAt(index);\n\t\t    if (ch <= ' ') { index++; continue; }\n\t\t    // and where it ends\n\t\t    var arg_end = v.indexOf(',',index);\n\t\t    if (arg_end == -1) arg_end = end;\n\t\t    // parse and save result in our list of arg values\n\t\t    src.args.push(parse_number(v.slice(index,arg_end),undefined));\n\t\t    index = arg_end + 1;\n\t\t}\n\t    } else {\n\t\tsrc.fun = 'dc';\n\t\tsrc.args = [parse_number(v,0)];\n\t    }\n\n\t    // post-processing for constant sources\n\t    // dc(v)\n\t    if (src.fun == 'dc') {\n\t\tvar v = arg_value(src.args,0,0);\n\t\tsrc.args = [v];\n\t\tsrc.value = function(t) { return v; }  // closure\n\t    }\n\n\t    // post-processing for impulse sources\n\t    // impulse(height,width)\n\t    else if (src.fun == 'impulse') {\n\t\tvar h = arg_value(src.args,0,1);  // default height: 1\n\t\tvar w = Math.abs(arg_value(src.args,2,1e-9));  // default width: 1ns\n\t\tsrc.args = [h,w];  // remember any defaulted values\n\t\tpwl_source(src,[0,0,w/2,h,w,0],false);\n\t    }\n\n\t    // post-processing for step sources\n\t    // step(v_init,v_plateau,t_delay,t_rise)\n\t    else if (src.fun == 'step') {\n\t\tvar v1 = arg_value(src.args,0,0);  // default init value: 0V\n\t\tvar v2 = arg_value(src.args,1,1);  // default plateau value: 1V\n\t\tvar td = Math.max(0,arg_value(src.args,2,0));  // time step starts\n\t\tvar tr = Math.abs(arg_value(src.args,3,1e-9));  // default rise time: 1ns\n\t\tsrc.args = [v1,v2,td,tr];  // remember any defaulted values\n\t\tpwl_source(src,[td,v1,td+tr,v2],false);\n\t    }\n\n\t    // post-processing for square wave\n\t    // square(v_init,v_plateau,freq,duty_cycle)\n\t    else if (src.fun == 'square') {\n\t\tvar v1 = arg_value(src.args,0,0);  // default init value: 0V\n\t\tvar v2 = arg_value(src.args,1,1);  // default plateau value: 1V\n\t\tvar freq = Math.abs(arg_value(src.args,2,1));  // default frequency: 1Hz\n\t\tvar duty_cycle  = Math.min(100,Math.abs(arg_value(src.args,3,50)));  // default duty cycle: 0.5\n\t\tsrc.args = [v1,v2,freq,duty_cycle];  // remember any defaulted values\n\n\t\tvar per = freq == 0 ? Infinity : 1/freq;\n\t\tvar t_change = 0.01 * per;   // rise and fall time\n\t\tvar t_pw = .01 * duty_cycle * 0.98 * per;  // fraction of cycle minus rise and fall time\n\t\tpwl_source(src,[0,v1,t_change,v2,t_change+t_pw,\n\t\t\t\tv2,t_change+t_pw+t_change,v1,per,v1],true);\n\t    }\n\n\t    // post-processing for triangle\n\t    // triangle(v_init,v_plateua,t_period)\n\t    else if (src.fun == 'triangle') {\n\t\tvar v1 = arg_value(src.args,0,0);  // default init value: 0V\n\t\tvar v2 = arg_value(src.args,1,1);  // default plateau value: 1V\n\t\tvar freq = Math.abs(arg_value(src.args,2,1));  // default frequency: 1s\n\t\tsrc.args = [v1,v2,freq];  // remember any defaulted values\n\n\t\tvar per = freq == 0 ? Infinity : 1/freq;\n\t\tpwl_source(src,[0,v1,per/2,v2,per,v1],true);\n\t    }\n\n\t    // post-processing for pwl and pwlr sources\n\t    // pwl[r](t1,v1,t2,v2,...)\n\t    else if (src.fun == 'pwl' || src.fun == 'pwl_repeating') {\n\t\tpwl_source(src,src.args,src.fun == 'pwl_repeating');\n\t    }\n\n\t    // post-processing for pulsed sources\n\t    // pulse(v_init,v_plateau,t_delay,t_rise,t_fall,t_width,t_period)\n\t    else if (src.fun == 'pulse') {\n\t\tvar v1 = arg_value(src.args,0,0);  // default init value: 0V\n\t\tvar v2 = arg_value(src.args,1,1);  // default plateau value: 1V\n\t\tvar td = Math.max(0,arg_value(src.args,2,0));  // time pulse starts\n\t\tvar tr = Math.abs(arg_value(src.args,3,1e-9));  // default rise time: 1ns\n\t\tvar tf = Math.abs(arg_value(src.args,4,1e-9));  // default rise time: 1ns\n\t\tvar pw = Math.abs(arg_value(src.args,5,1e9));  // default pulse width: \"infinite\"\n\t\tvar per = Math.abs(arg_value(src.args,6,1e9));  // default period: \"infinite\"\n\t\tsrc.args = [v1,v2,td,tr,tf,pw,per];\n\n\t\tvar t1 = td;       // time when v1 -> v2 transition starts\n\t\tvar t2 = t1 + tr;  // time when v1 -> v2 transition ends\n\t\tvar t3 = t2 + pw;  // time when v2 -> v1 transition starts\n\t\tvar t4 = t3 + tf;  // time when v2 -> v1 transition ends\n\n\t\tpwl_source(src,[t1,v1, t2,v2, t3,v2, t4,v1, per,v1],true);\n\t    }\n\n\t    // post-processing for sinusoidal sources\n\t    // sin(v_offset,v_amplitude,freq_hz,t_delay,phase_offset_degrees)\n\t    else if (src.fun == 'sin') {\n\t\tvar voffset = arg_value(src.args,0,0);  // default offset voltage: 0V\n\t\tvar va = arg_value(src.args,1,1);  // default amplitude: -1V to 1V\n\t\tvar freq = Math.abs(arg_value(src.args,2,1));  // default frequency: 1Hz\n\t\tsrc.period = 1.0/freq;\n\n\t\tvar td = Math.max(0,arg_value(src.args,3,0));  // default time delay: 0sec\n\t\tvar phase = arg_value(src.args,4,0);  // default phase offset: 0 degrees\n\t\tsrc.args = [voffset,va,freq,td,phase];\n\n\t\tphase /= 360.0;\n\n\t\t// return value of source at time t\n\t\tsrc.value = function(t) {  // closure\n\t\t    if (t < td) return voffset + va*Math.sin(2*Math.PI*phase);\n\t\t    else return voffset + va*Math.sin(2*Math.PI*(freq*(t - td) + phase));\n\t\t}\n\n\t\t// return time of next inflection point after time t\n\t\tsrc.inflection_point = function(t) {\t// closure\n\t\t    if (t < td) return td;\n\t\t    else return undefined;\n\t\t}\n\t    }\n\n\t    // object has all the necessary info to compute the source value and inflection points\n\t    src.dc = src.value(0);   // DC value is value at time 0\n\t    return src;\n\t}\n\n\tfunction pwl_source(src,tv_pairs,repeat) {\n\t    var nvals = tv_pairs.length;\n\t    if (repeat)\n\t\tsrc.period = tv_pairs[nvals-2];  // Repeat period of source\n\t    if (nvals % 2 == 1) npts -= 1;  // make sure it's even!\n\n\t    if (nvals <= 2) {\n\t\t// handle degenerate case\n\t\tsrc.value = function(t) { return nvals == 2 ? tv_pairs[1] : 0; }\n\t\tsrc.inflection_point = function(t) { return undefined; }\n\t    } else {\n\t\tsrc.value = function(t) { // closure\n\t\t    if (repeat)\n\t\t\t// make time periodic if values are to be repeated\n\t\t\tt = Math.fmod(t,tv_pairs[nvals-2]);\n\t\t    var last_t = tv_pairs[0];\n\t\t    var last_v = tv_pairs[1];\n\t\t    if (t > last_t) {\n\t\t\tvar next_t,next_v;\n\t\t\tfor (var i = 2; i < nvals; i += 2) {\n\t\t\t    next_t = tv_pairs[i];\n\t\t\t    next_v = tv_pairs[i+1];\n\t\t\t    if (next_t > last_t)  // defend against bogus tv pairs\n\t\t\t\tif (t < next_t)\n\t\t\t\t    return last_v + (next_v - last_v)*(t - last_t)/(next_t - last_t);\n\t\t\t    last_t = next_t;\n\t\t\t    last_v = next_v;\n\t\t\t}\n\t\t    }\n\t\t    return last_v;\n\t\t}\n\t\tsrc.inflection_point = function(t) {  // closure\n\t\t    if (repeat)\n\t\t\t// make time periodic if values are to be repeated\n\t\t\tt = Math.fmod(t,tv_pairs[nvals-2]);\n\t\t    for (var i = 0; i < nvals; i += 2) {\n\t\t\tvar next_t = tv_pairs[i];\n\t\t\tif (t < next_t) return next_t;\n\t\t    }\n\t\t    return undefined;\n\t\t}\n\t    }\n\t}\n\n\t// helper function: return args[index] if present, else default_v\n\tfunction arg_value(args,index,default_v) {\n\t    if (index < args.length) {\n\t\tvar result = args[index];\n\t\tif (result === undefined) result = default_v;\n\t\treturn result;\n\t    } else return default_v;\n\t}\n\n\t// we need fmod in the Math library!\n\tMath.fmod = function(numerator,denominator) {\n\t    var quotient = Math.floor(numerator/denominator);\n\t    return numerator - quotient*denominator;\n\t}\n\n\t///////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Sources\n\t//\n\t///////////////////////////////////////////////////////////////////////////////\n\n        function VSource(npos,nneg,branch,v) {\n\t    Device.call(this);\n\t    this.src = parse_source(v);\n\t    this.npos = npos;\n\t    this.nneg = nneg;\n\t    this.branch = branch;\n\t}\n\tVSource.prototype = new Device();\n\tVSource.prototype.constructor = VSource;\n\n\t// load linear part for source evaluation\n        VSource.prototype.load_linear = function(ckt) {\n\t    // MNA stamp for independent voltage source\n\t    ckt.add_to_Gl(this.branch,this.npos,1.0);\n\t    ckt.add_to_Gl(this.branch,this.nneg,-1.0);\n\t    ckt.add_to_Gl(this.npos,this.branch,1.0);\n\t    ckt.add_to_Gl(this.nneg,this.branch,-1.0);\n\t}\n\n\t// Source voltage added to b.\n        VSource.prototype.load_dc = function(ckt,soln,rhs) {\n\t    ckt.add_to_rhs(this.branch,this.src.dc,rhs);\n\t}\n\n\t// Load time-dependent value for voltage source for tran\n        VSource.prototype.load_tran = function(ckt,soln,rhs,time) {\n\t    ckt.add_to_rhs(this.branch,this.src.value(time),rhs);\n\t}\n\n\t// return time of next breakpoint for the device\n\tVSource.prototype.breakpoint = function(time) {\n\t    return this.src.inflection_point(time);\n\t}\n\n\t// small signal model ac value\n        VSource.prototype.load_ac = function(ckt,rhs) {\n\t    ckt.add_to_rhs(this.branch,1.0,rhs);\n\t}\n\n\tfunction ISource(npos,nneg,v) {\n\t    Device.call(this);\n\t    this.src = parse_source(v);\n\t    this.npos = npos;\n\t    this.nneg = nneg;\n\t}\n\tISource.prototype = new Device();\n\tISource.prototype.constructor = ISource;\n\n        ISource.prototype.load_linear = function(ckt) {\n\t    // Current source is open when off, no linear contribution\n\t}\n\n\t// load linear system equations for dc analysis\n\tISource.prototype.load_dc = function(ckt,soln,rhs) {\n\t    var is = this.src.dc;\n\n\t    // MNA stamp for independent current source\n\t    ckt.add_to_rhs(this.npos,-is,rhs);  // current flow into npos\n\t    ckt.add_to_rhs(this.nneg,is,rhs);   // and out of nneg\n\t}\n\n\t// load linear system equations for tran analysis (just like DC)\n        ISource.prototype.load_tran = function(ckt,soln,rhs,time) {\n\t    var is = this.src.value(time);\n\n\t    // MNA stamp for independent current source\n\t    ckt.add_to_rhs(this.npos,-is,rhs);  // current flow into npos\n\t    ckt.add_to_rhs(this.nneg,is,rhs);   // and out of nneg\n\t}\n\n\t// return time of next breakpoint for the device\n\tISource.prototype.breakpoint = function(time) {\n\t    return this.src.inflection_point(time);\n\t}\n\n\t// small signal model: open circuit\n        ISource.prototype.load_ac = function(ckt,rhs) {\n\t    // MNA stamp for independent current source\n\t    ckt.add_to_rhs(this.npos,-1.0,rhs);  // current flow into npos\n\t    ckt.add_to_rhs(this.nneg,1.0,rhs);   // and out of nneg\n\t}\n\n\t///////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Resistor\n\t//\n\t///////////////////////////////////////////////////////////////////////////////\n\n\tfunction Resistor(n1,n2,v) {\n\t    Device.call(this);\n\t    this.n1 = n1;\n\t    this.n2 = n2;\n\t    this.g = 1.0/v;\n\t}\n\tResistor.prototype = new Device();\n\tResistor.prototype.constructor = Resistor;\n\n        Resistor.prototype.load_linear = function(ckt) {\n\t    // MNA stamp for admittance g\n\t    ckt.add_conductance_l(this.n1,this.n2,this.g);\n\t}\n\n\tResistor.prototype.load_dc = function(ckt) {\n\t    // Nothing to see here, move along.\n\t}\n\n\tResistor.prototype.load_tran = function(ckt,soln) {\n\t}\n\n\tResistor.prototype.load_ac = function(ckt) {\n\t}\n\n\t///////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Diode\n\t//\n\t///////////////////////////////////////////////////////////////////////////////\n\n\tfunction Diode(n1,n2,v,type) {\n\t    Device.call(this);\n\t    this.anode = n1;\n\t    this.cathode = n2;\n\t    this.area = v;\n\t    this.type = type;  // 'normal' or 'ideal'\n\t    this.is = 1.0e-14;\n\t    this.ais = this.area * this.is;\n\t    this.vt = (type == 'normal') ? 25.8e-3 : 0.1e-3;  // 26mv or .1mv\n\t    this.exp_arg_max = 50;  // less than single precision max.\n\t    this.exp_max = Math.exp(this.exp_arg_max);\n\t}\n\tDiode.prototype = new Device();\n        Diode.prototype.constructor = Diode;\n\n        Diode.prototype.load_linear = function(ckt) {\n\t    // Diode is not linear, has no linear piece.\n\t}\n\n        Diode.prototype.load_dc = function(ckt,soln,rhs) {\n\t    var vd = ckt.get_two_terminal(this.anode, this.cathode, soln);\n\t    var exp_arg = vd / this.vt;\n\t    var temp1, temp2;\n\t    // Estimate exponential with a quadratic if arg too big.\n\t    var abs_exp_arg = Math.abs(exp_arg);\n\t    var d_arg = abs_exp_arg - this.exp_arg_max;\n\t    if (d_arg > 0) {\n\t\tvar quad = 1 + d_arg + 0.5*d_arg*d_arg;\n\t\ttemp1 = this.exp_max * quad;\n\t\ttemp2 = this.exp_max * (1 + d_arg);\n\t    } else {\n\t\ttemp1 = Math.exp(abs_exp_arg);\n\t\ttemp2 = temp1;\n\t    }\n\t    if (exp_arg < 0) {  // Use exp(-x) = 1.0/exp(x)\n\t\ttemp1 = 1.0/temp1;\n\t\ttemp2 = (temp1*temp2)*temp1;\n\t    }\n\t    var id = this.ais * (temp1 - 1);\n\t    var gd = this.ais * (temp2 / this.vt);\n\n\t    // MNA stamp for independent current source\n\t    ckt.add_to_rhs(this.anode,-id,rhs);  // current flows into anode\n\t    ckt.add_to_rhs(this.cathode,id,rhs);   // and out of cathode\n\t    ckt.add_conductance(this.anode,this.cathode,gd);\n\t}\n\n        Diode.prototype.load_tran = function(ckt,soln,rhs,time) {\n\t    this.load_dc(ckt,soln,rhs);\n\t}\n\n\tDiode.prototype.load_ac = function(ckt) {\n\t}\n\n\n\t///////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Capacitor\n\t//\n\t///////////////////////////////////////////////////////////////////////////////\n\n\tfunction Capacitor(n1,n2,v) {\n\t    Device.call(this);\n\t    this.n1 = n1;\n\t    this.n2 = n2;\n\t    this.value = v;\n\t}\n\tCapacitor.prototype = new Device();\n\tCapacitor.prototype.constructor = Capacitor;\n\n        Capacitor.prototype.load_linear = function(ckt) {\n\t    // MNA stamp for capacitance matrix\n\t    ckt.add_capacitance(this.n1,this.n2,this.value);\n\t}\n\n\tCapacitor.prototype.load_dc = function(ckt,soln,rhs) {\n\t}\n\n\tCapacitor.prototype.load_ac = function(ckt) {\n\t}\n\n\tCapacitor.prototype.load_tran = function(ckt) {\n\t}\n\n\t///////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Inductor\n\t//\n\t///////////////////////////////////////////////////////////////////////////////\n\n\tfunction Inductor(n1,n2,branch,v) {\n\t    Device.call(this);\n\t    this.n1 = n1;\n\t    this.n2 = n2;\n\t    this.branch = branch;\n\t    this.value = v;\n\t}\n\tInductor.prototype = new Device();\n\tInductor.prototype.constructor = Inductor;\n\n        Inductor.prototype.load_linear = function(ckt) {\n\t    // MNA stamp for inductor linear part\n\t    // L on diag of C because L di/dt = v(n1) - v(n2)\n\t    ckt.add_to_Gl(this.n1,this.branch,1);\n\t    ckt.add_to_Gl(this.n2,this.branch,-1);\n\t    ckt.add_to_Gl(this.branch,this.n1,-1);\n\t    ckt.add_to_Gl(this.branch,this.n2,1);\n\t    ckt.add_to_C(this.branch,this.branch,this.value)\n\t}\n\n\tInductor.prototype.load_dc = function(ckt,soln,rhs) {\n\t    // Inductor is a short at dc, so is linear.\n\t}\n\n\tInductor.prototype.load_ac = function(ckt) {\n\t}\n\n\tInductor.prototype.load_tran = function(ckt) {\n\t}\n\n\n\t///////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Simple Voltage-Controlled Voltage Source Op Amp model\n\t//\n\t///////////////////////////////////////////////////////////////////////////////\n\n        function Opamp(np,nn,no,ng,branch,A,name) {\n\t    Device.call(this);\n\t    this.np = np;\n\t    this.nn = nn;\n\t    this.no = no;\n\t    this.ng = ng;\n\t    this.branch = branch;\n\t    this.gain = A;\n\t    this.name = name;\n\t}\n\n\tOpamp.prototype = new Device();\n        Opamp.prototype.constructor = Opamp;\n        Opamp.prototype.load_linear = function(ckt) {\n            // MNA stamp for VCVS: 1/A(v(no) - v(ng)) - (v(np)-v(nn))) = 0.\n\t    var invA = 1.0/this.gain;\n\t    ckt.add_to_Gl(this.no,this.branch,1);\n\t    ckt.add_to_Gl(this.ng,this.branch,-1);\n\t    ckt.add_to_Gl(this.branch,this.no,invA);\n\t    ckt.add_to_Gl(this.branch,this.ng,-invA);\n\t    ckt.add_to_Gl(this.branch,this.np,-1);\n\t    ckt.add_to_Gl(this.branch,this.nn,1);\n\t}\n\n\tOpamp.prototype.load_dc = function(ckt,soln,rhs) {\n\t    // Op-amp is linear.\n\t}\n\n\tOpamp.prototype.load_ac = function(ckt) {\n\t}\n\n\tOpamp.prototype.load_tran = function(ckt) {\n\t}\n\n\n\t///////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Simplified MOS FET with no bulk connection and no body effect.\n\t//\n\t///////////////////////////////////////////////////////////////////////////////\n\n        function Fet(d,g,s,ratio,name,type) {\n\t    Device.call(this);\n\t    this.d = d;\n\t    this.g = g;\n\t    this.s = s;\n\t    this.name = name;\n\t    this.ratio = ratio;\n\t    if (type != 'n' && type != 'p')\n\t    { throw 'fet type is not n or p';\n\t    }\n\t    this.type_sign = (type == 'n') ? 1 : -1;\n\t    this.vt = 0.5;\n\t    this.kp = 20e-6;\n            this.beta = this.kp * this.ratio;\n\t    this.lambda = 0.05;\n\t}\n\tFet.prototype = new Device();\n        Fet.prototype.constructor = Fet;\n\n        Fet.prototype.load_linear = function(ckt) {\n\t    // FET's are nonlinear, just like javascript progammers\n\t}\n\n        Fet.prototype.load_dc = function(ckt,soln,rhs) {\n\t    var vds = this.type_sign * ckt.get_two_terminal(this.d, this.s, soln);\n\t    if (vds < 0) { // Drain and source have swapped roles\n\t\tvar temp = this.d;\n\t\tthis.d = this.s;\n\t\tthis.s = temp;\n\t\tvds = this.type_sign * ckt.get_two_terminal(this.d, this.s, soln);\n\t    }\n\t    var vgs = this.type_sign * ckt.get_two_terminal(this.g, this.s, soln);\n\t    var vgst = vgs - this.vt;\n\t    var gmgs,ids,gds;\n\t    if (vgst > 0.0 ) { // vgst < 0, transistor off, no subthreshold here.\n\t\tif (vgst < vds) { /* Saturation. */\n\t    \tgmgs =  this.beta * (1 + (this.lambda * vds)) * vgst;\n\t    \tids = this.type_sign * 0.5 * gmgs * vgst;\n\t    \tgds = 0.5 * this.beta * vgst * vgst * this.lambda;\n\t\t} else {  /* Linear region */\n\t    \tgmgs =  this.beta * (1 + this.lambda * vds);\n\t    \tids = this.type_sign * gmgs * vds * (vgst - 0.50 * vds);\n\t    \tgds = gmgs * (vgst - vds) + this.beta * this.lambda * vds * (vgst - 0.5 * vds);\n\t    \tgmgs *= vds;\n\t\t}\n\t\tckt.add_to_rhs(this.d,-ids,rhs);  // current flows into the drain\n\t\tckt.add_to_rhs(this.s, ids,rhs);   // and out the source\n\t\tckt.add_conductance(this.d,this.s,gds);\n\t\tckt.add_to_G(this.s,this.s, gmgs);\n\t\tckt.add_to_G(this.d,this.s,-gmgs);\n\t\tckt.add_to_G(this.d,this.g, gmgs);\n\t\tckt.add_to_G(this.s,this.g,-gmgs);\n\t    }\n\t}\n\n\tFet.prototype.load_tran = function(ckt,soln,rhs) {\n\t    this.load_dc(ckt,soln,rhs);\n\t}\n\n\tFet.prototype.load_ac = function(ckt) {\n\t}\n\n\n\t///////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Module definition\n\t//\n\t///////////////////////////////////////////////////////////////////////////////\n\tvar module = {\n\t    'Circuit': Circuit,\n\t    'parse_number': parse_number,\n\t    'parse_source': parse_source\n\t}\n\treturn module;\n    }());\n\n/////////////////////////////////////////////////////////////////////////////\n//\n//  Simple schematic capture\n//\n////////////////////////////////////////////////////////////////////////////////\n\n// Copyright (C) 2011 Massachusetts Institute of Technology\n\n// add schematics to a document with\n//\n//   <input type=\"hidden\" class=\"schematic\" name=\"unique_form_id\" value=\"JSON netlist...\" .../>\n//\n// other attributes you can add to the input tag:\n//   width -- width in pixels of diagram\n//   height -- height in pixels of diagram\n//   parts -- comma-separated list of parts for parts bin (see parts_map),\n//            parts=\"\" disables editing of diagram\n\n// JSON schematic representation:\n//  sch :=  [part, part, ...]\n//  part := [type, coords, properties, connections]\n//  type := string (see parts_map)\n//  coords := [number, ...]  // (x,y,rot) or (x1,y1,x2,y2)\n//  properties := {name: value, ...}\n//  connections := [node, ...]   // one per connection point in canoncial order\n//  node := string\n// need a netlist? just use the part's type, properites and connections\n\n// TO DO:\n// - wire labels?\n// - zoom/scroll canvas\n// - rotate multiple objects around their center of mass\n// - rubber band wires when moving components\n\n// set up each schematic entry widget\nfunction update_schematics() {\n    // set up each schematic on the page\n    var schematics = $('.schematic');\n    for (var i = 0; i < schematics.length; ++i)\n\tif (schematics[i].getAttribute(\"loaded\") != \"true\") {\n\t    try {\n\t\tnew schematic.Schematic(schematics[i]);\n\t    } catch (err) {\n\t\tvar msgdiv = document.createElement('div');\n\t\tmsgdiv.style.border = 'thick solid #FF0000';\n\t\tmsgdiv.style.margins = '20px';\n\t\tmsgdiv.style.padding = '20px';\n\t\tvar msg = document.createTextNode('Sorry, there a browser error in starting the schematic tool.  The tool is known to be compatible with the latest versions of Firefox and Chrome, which we recommend you use.');\n\t\tmsgdiv.appendChild(msg);\n\t\tschematics[i].parentNode.insertBefore(msgdiv,schematics[i]);\n\t    }\n\t    schematics[i].setAttribute(\"loaded\",\"true\");\n\t}\n}\nwindow.update_schematics = update_schematics;\n\nschematic = (function() {\n    var background_style = 'rgb(220,220,220)';\n    var element_style = 'rgb(255,255,255)';\n    var thumb_style = 'rgb(128,128,128)';\n    var normal_style = 'rgb(0,0,0)';  // default drawing color\n    var component_style = 'rgb(64,64,255)';  // color for unselected components\n    var selected_style = 'rgb(64,255,64)';  // highlight color for selected components\n    var grid_style = \"rgb(128,128,128)\";\n    var annotation_style = 'rgb(255,64,64)';  // color for diagram annotations\n    var property_size = 5;  // point size for Component property text\n    var annotation_size = 6;  // point size for diagram annotations\n\n    var parts_map = {\n\t    'g': [Ground, 'Ground connection'],\n\t    'L': [Label, 'Node label'],\n\t    'v': [VSource, 'Voltage source'],\n\t    'i': [ISource, 'Current source'],\n\t    'r': [Resistor, 'Resistor'],\n\t    'c': [Capacitor, 'Capacitor'],\n\t    'l': [Inductor, 'Inductor'],\n\t    'o': [OpAmp, 'Op Amp'],\n\t    'd': [Diode, 'Diode'],\n\t    'n': [NFet, 'NFet'],\n\t    'p': [PFet, 'PFet'],\n\t    's': [Probe, 'Voltage Probe'],\n\t    'a': [Ammeter, 'Current Probe']\n\t};\n\n\t// global clipboard\n\tif (typeof sch_clipboard == 'undefined')\n\t    sch_clipboard = [];\n\n\t///////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Schematic = diagram + parts bin + status area\n\t//\n\t////////////////////////////////////////////////////////////////////////////////\n\n\t// setup a schematic by populating the <div> with the appropriate children\n\tfunction Schematic(input) {\n\t    // set up diagram viewing parameters\n\t    this.show_grid = true;\n\t    this.grid = 8;\n\t    this.scale = 2;\n\t    this.origin_x = input.getAttribute(\"origin_x\");\n\t    if (this.origin_x == undefined) this.origin_x = 0;\n\t    this.origin_y = input.getAttribute(\"origin_y\");\n\t    if (this.origin_y == undefined) this.origin_y = 0;\n\t    this.cursor_x = 0;\n\t    this.cursor_y = 0;\n\t    this.window_list = [];  // list of pop-up windows in increasing z order\n\n\t    // use user-supplied list of parts if supplied\n\t    // else just populate parts bin with all the parts\n\t    this.edits_allowed = true;\n\t    var parts = input.getAttribute('parts');\n\t    if (parts == undefined || parts == 'None') {\n            parts = [];\n\t\tfor (var p in parts_map) parts.push(p);\n\t    } else if (parts == '') {\n\t\tthis.edits_allowed = false;\n\t\tparts = [];\n\t    } else parts = parts.split(',');\n\n\t    // now add the parts to the parts bin\n\t    this.parts_bin = [];\n\t    for (var i = 0; i < parts.length; i++) {\n\t\tvar part = new Part(this);\n\t\tvar pm = parts_map[parts[i]];\n\t\tpart.set_component(new pm[0](0,0,0),pm[1]);\n\t\tthis.parts_bin.push(part);\n\t    }\n\n\t    // use user-supplied list of analyses, otherwise provide them all\n\t    // analyses=\"\" means no analyses\n\t    var analyses = input.getAttribute('analyses');\n\t    if (analyses == undefined || analyses == 'None')\n\t\tanalyses = ['dc','ac','tran'];\n\t    else if (analyses == '') analyses = [];\n\t    else analyses = analyses.split(',');\n\n\t    if (parts.length == 0 && analyses.length == 0) this.diagram_only = true;\n\t    else this.diagram_only = false;\n\n\t    // see what we need to submit.  Expecting attribute of the form\n\t    // submit_analyses=\"{'tran':[[node_name,t1,t2,t3],...],\n\t    //                   'ac':[[node_name,f1,f2,...],...]}\"\n\t    var submit = input.getAttribute('submit_analyses');\n\t    if (submit && submit.indexOf('{') != -1)\n\t\tthis.submit_analyses = JSON.parse(submit);\n\t    else\n\t\tthis.submit_analyses = undefined;\n\n\t    // toolbar\n        this.tools = [];\n\t    this.toolbar = [];\n\n        /* DISABLE HELP BUTTON (target URL not consistent with multicourse hierarchy) -- SJSU\n\t    if (!this.diagram_only) {\n\t\tthis.tools['help'] = this.add_tool(help_icon,'Help: display help page',this.help);\n\t\tthis.enable_tool('help',true);\n\t\tthis.toolbar.push(null);  // spacer\n\t    }\n        END DISABLE HELP BUTTON -- SJSU */\n\n\t    if (this.edits_allowed) {\n\t\tthis.tools['grid'] = this.add_tool(grid_icon,'Grid: toggle grid display',this.toggle_grid);\n\t\tthis.enable_tool('grid',true);\n\t\tthis.tools['cut'] = this.add_tool(cut_icon,'Cut: move selected components from diagram to the clipboard',this.cut);\n\t\tthis.tools['copy'] = this.add_tool(copy_icon,'Copy: copy selected components into the clipboard',this.copy);\n\t\tthis.tools['paste'] = this.add_tool(paste_icon,'Paste: copy clipboard into the diagram',this.paste);\n\t\tthis.toolbar.push(null);  // spacer\n\t    }\n\n\t    // simulation interface if cktsim.js is loaded\n\t    if (typeof cktsim != 'undefined') {\n\t\tif (analyses.indexOf('dc') != -1) {\n\t\t    this.tools['dc'] = this.add_tool('DC','DC Analysis',this.dc_analysis);\n\t\t    this.enable_tool('dc',true);\n\t\t    this.dc_max_iters = '1000';  // default values dc solution\n\t\t}\n\n\t\tif (analyses.indexOf('ac') != -1) {\n\t\t    this.tools['ac'] = this.add_tool('AC','AC Small-Signal Analysis',this.setup_ac_analysis);\n\t\t    this.enable_tool('ac',true);\n\t\t    this.ac_npts = '50'; // default values for AC Analysis\n\t\t    this.ac_fstart = '10';\n\t\t    this.ac_fstop = '1G';\n\t\t    this.ac_source_name = undefined;\n\t\t}\n\n\t\tif (analyses.indexOf('tran') != -1) {\n\t\t    this.tools['tran'] = this.add_tool('TRAN','Transient Analysis',this.transient_analysis);\n\t\t    this.enable_tool('tran',true);\n\t\t    this.tran_npts = '100';  // default values for transient analysis\n\t\t    this.tran_tstop = '1';\n\t\t}\n\t    }\n\n\t    // set up diagram canvas\n\t    this.canvas = document.createElement('canvas');\n\t    this.width = input.getAttribute('width');\n\t    this.width = parseInt(this.width == undefined ? '400' : this.width);\n\t    this.canvas.width = this.width;\n\t    this.height = input.getAttribute('height');\n\t    this.height = parseInt(this.height == undefined ? '300' : this.height);\n\t    this.canvas.height = this.height;\n\n\t    this.sctl_r = 16;   // scrolling control parameters\n\t    this.sctl_x = this.sctl_r + 8;   // upper left\n\t    this.sctl_y = this.sctl_r + 8;\n\t    this.zctl_left = this.sctl_x - 8;\n\t    this.zctl_top = this.sctl_y + this.sctl_r + 8;\n\n\t    // repaint simply draws this buffer and then adds selected elements on top\n\t    this.bg_image = document.createElement('canvas');\n\t    this.bg_image.width = this.width;\n\t    this.bg_image.height = this.height;\n\n\t    if (!this.diagram_only) {\n        this.canvas.tabIndex = 0; // so we get keystrokes\n\t\tthis.canvas.style.borderStyle = 'solid';\n\t\tthis.canvas.style.borderWidth = '1px';\n\t\tthis.canvas.style.borderColor = grid_style;\n\t\tthis.canvas.style.outline = 'none';\n\t    }\n\n\t    this.canvas.schematic = this;\n\t    if (this.edits_allowed) {\n\t\tthis.canvas.addEventListener('mousemove',schematic_mouse_move,false);\n\t\tthis.canvas.addEventListener('mouseover',schematic_mouse_enter,false);\n\t\tthis.canvas.addEventListener('mouseout',schematic_mouse_leave,false);\n\t\tthis.canvas.addEventListener('mousedown',schematic_mouse_down,false);\n\t\tthis.canvas.addEventListener('mouseup',schematic_mouse_up,false);\n\t\tthis.canvas.addEventListener('mousewheel',schematic_mouse_wheel,false);\n\t\tthis.canvas.addEventListener('DOMMouseScroll',schematic_mouse_wheel,false);  // for FF\n\t\tthis.canvas.addEventListener('dblclick',schematic_double_click,false);\n\t\tthis.canvas.addEventListener('keydown',schematic_key_down,false);\n\t\tthis.canvas.addEventListener('keyup',schematic_key_up,false);\n\t    }\n\n\t    // set up message area\n\t    if (!this.diagram_only) {\n\t\tthis.status_div = document.createElement('div');\n\t\tthis.status = document.createTextNode('');\n\t\tthis.status_div.appendChild(this.status);\n\t\tthis.status_div.style.height = status_height + 'px';\n\t    } else this.status_div = undefined;\n\n        this.connection_points = []; // location string => list of cp's\n\t    this.components = [];\n\t    this.dragging = false;\n\t    this.select_rect = undefined;\n\t    this.wire = undefined;\n\t    this.operating_point = undefined;  // result from DC analysis\n\t    this.dc_results = undefined;   // saved analysis results for submission\n\t    this.ac_results = undefined;   // saved analysis results for submission\n\t    this.transient_results = undefined;   // saved analysis results for submission\n\n\t    // state of modifier keys\n\t    this.ctrlKey = false;\n\t    this.shiftKey = false;\n\t    this.altKey = false;\n\t    this.cmdKey = false;\n\n\t    // make sure other code can find us!\n\t    input.schematic = this;\n\t    this.input = input;\n\n\t    // set up DOM -- use nested tables to do the layout\n\t    var table,tr,td;\n\t    table = document.createElement('table');\n\t    table.rules = 'none';\n\t    if (!this.diagram_only) {\n\t\ttable.frame = 'box';\n\t\ttable.style.borderStyle = 'solid';\n\t\ttable.style.borderWidth = '2px';\n\t\ttable.style.borderColor = normal_style;\n\t\ttable.style.backgroundColor = background_style;\n\t    }\n\n\t    // add tools to DOM\n\t    if (this.toolbar.length > 0) {\n\t\ttr = document.createElement('tr');\n\t\ttable.appendChild(tr);\n\t\ttd = document.createElement('td');\n\t\ttd.style.verticalAlign = 'top';\n\t\ttd.colSpan = 2;\n\t\ttr.appendChild(td);\n\t\tfor (var i = 0; i < this.toolbar.length; ++i) {\n\t\t    var tool = this.toolbar[i];\n\t\t    if (tool != null) td.appendChild(tool);\n\t\t}\n\t    }\n\n\t    // add canvas and parts bin to DOM\n\t    tr = document.createElement('tr');\n\t    table.appendChild(tr);\n\n\t    td = document.createElement('td');\n\t    tr.appendChild(td);\n\t    var wrapper = document.createElement('div'); // for inserting pop-up windows\n\t    td.appendChild(wrapper);\n\t    wrapper.style.position = 'relative';  // so we can position subwindows\n\t    wrapper.appendChild(this.canvas);\n\n\t    td = document.createElement('td');\n\t    td.style.verticalAlign = 'top';\n\t    tr.appendChild(td);\n\t    var parts_table = document.createElement('table');\n\t    td.appendChild(parts_table);\n\t    parts_table.rules = 'none';\n\t    parts_table.frame = 'void';\n\t    parts_table.cellPadding = '0';\n\t    parts_table.cellSpacing = '0';\n\n\t    // fill in parts_table\n\t    var parts_per_column = Math.floor(this.height / (part_h + 5));  // mysterious extra padding\n\t    for (var i = 0; i < parts_per_column; ++i) {\n\t\ttr = document.createElement('tr');\n\t\tparts_table.appendChild(tr);\n\t\tfor (var j = i; j < this.parts_bin.length; j += parts_per_column) {\n\t\t    td = document.createElement('td');\n\t\t    tr.appendChild(td);\n\t\t    td.appendChild(this.parts_bin[j].canvas);\n\t\t}\n\t    }\n\n\t    if (this.status_div != undefined) {\n\t\ttr = document.createElement('tr');\n\t\ttable.appendChild(tr);\n\t\ttd = document.createElement('td');\n\t\ttr.appendChild(td);\n\t\ttd.colSpan = 2;\n\t\ttd.appendChild(this.status_div);\n\t    }\n\n\t    // add to dom\n\t    // avoid Chrome bug that changes to text cursor whenever\n\t    // drag starts.  Just do this in schematic tool...\n\t    var toplevel = document.createElement('div');\n\t    toplevel.onselectstart = function(){ return false; };\n\t    toplevel.appendChild(table);\n\t    this.input.parentNode.insertBefore(toplevel,this.input.nextSibling);\n\n\t    // process initial contents of diagram\n\t    this.load_schematic(this.input.getAttribute('value'),\n\t\t\t\tthis.input.getAttribute('initial_value'));\n\n\t    // start by centering diagram on the screen\n\t    this.zoomall();\n\t}\n\n\tvar part_w = 42;   // size of a parts bin compartment\n\tvar part_h = 42;\n\tvar status_height = 18;\n\n\tSchematic.prototype.add_component = function(new_c) {\n\t    this.components.push(new_c);\n\t    // create undoable edit record here\n\t}\n\n\tSchematic.prototype.remove_component = function(c) {\n\t    var index = this.components.indexOf(c);\n\t    if (index != -1) this.components.splice(index,1);\n\t}\n\n\tSchematic.prototype.find_connections = function(cp) {\n\t    return this.connection_points[cp.location];\n\t}\n\n\tSchematic.prototype.add_connection_point = function(cp) {\n\t    var cplist = this.connection_points[cp.location];\n\t    if (cplist) cplist.push(cp);\n\t    else {\n\t\tcplist = [cp];\n\t\tthis.connection_points[cp.location] = cplist;\n\t    }\n\n\t    return cplist;\n\t}\n\n\tSchematic.prototype.remove_connection_point = function(cp,old_location) {\n\t    // remove cp from list at old location\n\t    var cplist = this.connection_points[old_location];\n\t    if (cplist) {\n\t\tvar index = cplist.indexOf(cp);\n\t\tif (index != -1) {\n\t\t    cplist.splice(index,1);\n\t\t    // if no more connections at this location, remove\n\t\t    // entry from array to keep our search time short\n\t\t    if (cplist.length == 0)\n\t\t\tdelete this.connection_points[old_location];\n\t\t}\n\t    }\n\t}\n\n\tSchematic.prototype.update_connection_point = function(cp,old_location) {\n\t    this.remove_connection_point(cp,old_location);\n\t    return this.add_connection_point(cp);\n\t}\n\n\tSchematic.prototype.add_wire = function(x1,y1,x2,y2) {\n\t    var new_wire = new Wire(x1,y1,x2,y2);\n\t    new_wire.add(this);\n\t    new_wire.move_end();\n\t    return new_wire;\n\t}\n\n\tSchematic.prototype.split_wire = function(w,cp) {\n\t    // remove bisected wire\n\t    w.remove();\n\n\t    // add two new wires with connection point cp in the middle\n\t    this.add_wire(w.x,w.y,cp.x,cp.y);\n\t    this.add_wire(w.x+w.dx,w.y+w.dy,cp.x,cp.y);\n\t}\n\n\t// see if connection points of component c split any wires\n\tSchematic.prototype.check_wires = function(c) {\n\t    for (var i = 0; i < this.components.length; i++) {\n\t\tvar cc = this.components[i];\n\t\tif (cc != c) {  // don't check a component against itself\n\t\t    // only wires will return non-null from a bisect call\n\t\t    var cp = cc.bisect(c);\n\t\t    if (cp) {\n\t\t\t// cc is a wire bisected by connection point cp\n\t\t\tthis.split_wire(cc,cp);\n\t\t\tthis.redraw_background();\n\t\t    }\n\t\t}\n\t    }\n\t}\n\n\t// see if there are any existing connection points that bisect wire w\n\tSchematic.prototype.check_connection_points = function(w) {\n\t    for (var locn in this.connection_points) {\n\t\tvar cplist = this.connection_points[locn];\n\t\tif (cplist && w.bisect_cp(cplist[0])) {\n\t\t    this.split_wire(w,cplist[0]);\n\t\t    this.redraw_background();\n\n\t\t    // stop here, new wires introduced by split will do their own checks\n\t\t    return;\n\t\t}\n\t    }\n\t}\n\n\t// merge collinear wires sharing an end point\n\tSchematic.prototype.clean_up_wires = function() {\n\t    for (var locn in this.connection_points) {\n\t\tvar cplist = this.connection_points[locn];\n\t\tif (cplist && cplist.length == 2) {\n\t\t    // found a connection with just two connections, see if they're wires\n\t\t    var c1 = cplist[0].parent;\n\t\t    var c2 = cplist[1].parent;\n\t\t    if (c1.type == 'w' && c2.type == 'w') {\n\t\t\tvar e1 = c1.other_end(cplist[0]);\n\t\t\tvar e2 = c2.other_end(cplist[1]);\n\t\t\tvar e3 = cplist[0];  // point shared by the two wires\n\t\t\tif (collinear(e1,e2,e3)) {\n\t\t\t    c1.remove();\n\t\t\t    c2.remove();\n\t\t\t    this.add_wire(e1.x,e1.y,e2.x,e2.y);\n\t\t\t}\n\t\t    }\n\t\t}\n\t    }\n\t}\n\n\tSchematic.prototype.unselect_all = function(which) {\n\t    this.operating_point = undefined;  // remove annotations\n\t    for (var i = this.components.length - 1; i >= 0; --i)\n\t\tif (i != which) this.components[i].set_select(false);\n\t}\n\n\tSchematic.prototype.drag_begin = function() {\n\t    // let components know they're about to move\n\t    for (var i = this.components.length - 1; i >= 0; --i) {\n\t\tvar component = this.components[i];\n\t\tif (component.selected) component.move_begin();\n\t    }\n\n\t    // remember where drag started\n\t    this.drag_x = this.cursor_x;\n\t    this.drag_y = this.cursor_y;\n\t    this.dragging = true;\n\t}\n\n\tSchematic.prototype.drag_end = function() {\n\t    // let components know they're done moving\n\t    for (var i = this.components.length - 1; i >= 0; --i) {\n\t\tvar component = this.components[i];\n\t\tif (component.selected) component.move_end();\n\t    }\n\t    this.dragging = false;\n\t    this.clean_up_wires();\n\t    this.redraw_background();\n\t}\n\n\tSchematic.prototype.help = function() {\n\t    window.open('/static/handouts/schematic_tutorial.pdf');\n\t}\n\n\t// zoom diagram around given coords\n\tSchematic.prototype.rescale = function(nscale,cx,cy) {\n\t    if (cx == undefined) {\n\t\t// use current center point if no point has been specified\n\t\tcx = this.origin_x + this.width/(2*this.scale);\n\t\tcy = this.origin_y + this.height/(2*this.scale);\n\t    }\n\n\t    this.origin_x += cx*(this.scale - nscale);\n\t    this.origin_y += cy*(this.scale - nscale);\n\t    this.scale = nscale;\n\t    this.redraw_background();\n\t}\n\n\tSchematic.prototype.toggle_grid = function() {\n\t    this.show_grid = !this.show_grid;\n\t    this.redraw_background();\n\t}\n\n\tvar zoom_factor = 1.25;    // scaling is some power of zoom_factor\n\tvar zoom_min = 0.5;\n\tvar zoom_max = 4.0;\n\tvar origin_min = -200;    // in grids\n\tvar origin_max = 200;\n\n\tSchematic.prototype.zoomin = function() {\n\t    var nscale = this.scale * zoom_factor;\n\t    if (nscale < zoom_max) {\n\t\t// keep center of view unchanged\n\t\tthis.origin_x += (this.width/2)*(1.0/this.scale - 1.0/nscale);\n\t\tthis.origin_y += (this.height/2)*(1.0/this.scale - 1.0/nscale);\n\t\tthis.scale = nscale;\n\t\tthis.redraw_background();\n\t    }\n\t}\n\n\tSchematic.prototype.zoomout = function() {\n\t    var nscale = this.scale / zoom_factor;\n\t    if (nscale > zoom_min) {\n\t\t// keep center of view unchanged\n\t\tthis.origin_x += (this.width/2)*(1.0/this.scale - 1.0/nscale);\n\t\tthis.origin_y += (this.height/2)*(1.0/this.scale - 1.0/nscale);\n\t\tthis.scale = nscale;\n\t\tthis.redraw_background();\n\t    }\n\t}\n\n\tSchematic.prototype.zoomall = function() {\n\t    // w,h for schematic including a 25% margin on all sides\n\t    var sch_w = 1.5*(this.bbox[2] - this.bbox[0]);\n\t    var sch_h = 1.5*(this.bbox[3] - this.bbox[1]);\n\n\t    if (sch_w == 0 && sch_h == 0) {\n\t\tthis.origin_x = 0;\n\t\tthis.origin_y = 0;\n\t\tthis.scale = 2;\n\t    } else {\n\t\t// compute scales that would make schematic fit, choose smallest\n\t\tvar scale_x = this.width/sch_w;\n\t\tvar scale_y = this.height/sch_h;\n\t\tthis.scale = Math.pow(zoom_factor,Math.ceil(Math.log(Math.min(scale_x,scale_y))/Math.log(zoom_factor)));\n\t\tif (this.scale < zoom_min) this.scale = zoom_min;\n\t\telse if (this.scale > zoom_max) this.scale = zoom_max;\n\n\t\t// center the schematic\n\t\tthis.origin_x = (this.bbox[2] + this.bbox[0])/2 - this.width/(2*this.scale);\n\t\tthis.origin_y = (this.bbox[3] + this.bbox[1])/2 - this.height/(2*this.scale);\n\t    }\n\n\t    this.redraw_background();\n\t}\n\n\tSchematic.prototype.cut = function() {\n\t    // clear previous contents\n\t    sch_clipboard = [];\n\n\t    // look for selected components, move them to clipboard.\n\t    for (var i = this.components.length - 1; i >=0; --i) {\n\t\tvar c = this.components[i];\n\t\tif (c.selected) {\n\t\t    c.remove();\n\t\t    sch_clipboard.push(c);\n\t\t}\n\t    }\n\n\t    // update diagram view\n\t    this.redraw();\n\t}\n\n\tSchematic.prototype.copy = function() {\n\t    // clear previous contents\n\t    sch_clipboard = [];\n\n\t    // look for selected components, copy them to clipboard.\n\t    for (var i = this.components.length - 1; i >=0; --i) {\n\t\tvar c = this.components[i];\n\t\tif (c.selected)\n\t\t    sch_clipboard.push(c.clone(c.x,c.y));\n\t    }\n\t}\n\n\tSchematic.prototype.paste = function() {\n\t    // compute left,top of bounding box for origins of\n\t    // components in the clipboard\n\t    var left = undefined;\n\t    var top = undefined;\n\t    for (var i = sch_clipboard.length - 1; i >= 0; --i) {\n\t\tvar c = sch_clipboard[i];\n\t\tleft = left ? Math.min(left,c.x) : c.x;\n\t\ttop = top ? Math.min(top,c.y) : c.y;\n\t    }\n\n\t    this.message('cursor '+this.cursor_x+','+this.cursor_y);\n\n\t    // clear current selections\n\t    this.unselect_all(-1);\n\t    this.redraw_background();  // so we see any components that got unselected\n\n\t    // make clones of components on the clipboard, positioning\n\t    // them relative to the cursor\n\t    for (var i = sch_clipboard.length - 1; i >= 0; --i) {\n\t\tvar c = sch_clipboard[i];\n\t\tvar new_c = c.clone(this.cursor_x + (c.x - left),this.cursor_y + (c.y - top));\n\t\tnew_c.set_select(true);\n\t\tnew_c.add(this);\n\t    }\n\n\t    this.redraw();\n\t}\n\n\t///////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Netlist and Simulation interface\n\t//\n\t////////////////////////////////////////////////////////////////////////////////\n\n\t// load diagram from JSON representation\n\tSchematic.prototype.load_schematic = function(value,initial_value) {\n\t    // use default value if no schematic info in value\n\t    if (value == undefined || value.indexOf('[') == -1)\n\t\tvalue = initial_value;\n\t    if (value && value.indexOf('[') != -1) {\n\t\t// convert string value into data structure\n\t\tvar json = JSON.parse(value);\n\n\t\t// top level is a list of components\n\t\tfor (var i = json.length - 1; i >= 0; --i) {\n\t\t    var c = json[i];\n\t\t    if (c[0] == 'view') {\n\t\t\tthis.ac_fstart = c[5];\n\t\t\tthis.ac_fstop = c[6];\n\t\t\tthis.ac_source_name = c[7];\n\t\t\tthis.tran_npts = c[8];\n\t\t\tthis.tran_tstop = c[9];\n\t\t\tthis.dc_max_iters = c[10];\n\t\t    } else if (c[0] == 'w') {\n\t\t\t// wire\n\t\t\tthis.add_wire(c[1][0],c[1][1],c[1][2],c[1][3]);\n\t\t    } else if (c[0] == 'dc') {\n\t\t\tthis.dc_results = c[1];\n\t\t    } else if (c[0] == 'transient') {\n\t\t\tthis.transient_results = c[1];\n\t\t    } else if (c[0] == 'ac') {\n\t\t\tthis.ac_results = c[1];\n\t\t    } else {\n\t\t\t// ordinary component\n\t\t\t//  c := [type, coords, properties, connections]\n\t\t\tvar type = c[0];\n\t\t\tvar coords = c[1];\n\t\t\tvar properties = c[2];\n\n\t\t\tvar part = new parts_map[type][0](coords[0],coords[1],coords[2]);\n\t\t\tfor (var name in properties)\n\t\t\t    part.properties[name] = properties[name];\n\n\t\t\tpart.add(this);\n\t\t    }\n\t\t}\n\t    }\n\n\t    this.redraw_background();\n\t}\n\n\t// label all the nodes in the circuit\n\tSchematic.prototype.label_connection_points = function() {\n\t    // start by clearing all the connection point labels\n\t    for (var i = this.components.length - 1; i >=0; --i)\n\t\tthis.components[i].clear_labels();\n\n\t    // components are in charge of labeling their unlabeled connections.\n\t    // labels given to connection points will propagate to coincident connection\n\t    // points and across Wires.\n\n\t    // let special components like GND label their connection(s)\n\t    for (var i = this.components.length - 1; i >=0; --i)\n\t\tthis.components[i].add_default_labels();\n\n\t    // now have components generate labels for unlabeled connections\n\t    this.next_label = 0;\n\t    for (var i = this.components.length - 1; i >=0; --i)\n\t\tthis.components[i].label_connections();\n\t}\n\n\tSchematic.prototype.get_next_label = function() {\n\t    // generate next label in sequence\n\t    this.next_label += 1;\n\t    return this.next_label.toString();\n\t}\n\n\t// propagate label to coincident connection points\n\tSchematic.prototype.propagate_label = function(label,location) {\n\t    var cplist = this.connection_points[location];\n\t    for (var i = cplist.length - 1; i >= 0; --i)\n\t\tcplist[i].propagate_label(label);\n\t}\n\n\t// update the value field of our corresponding input field with JSON\n\t// representation of schematic\n\tSchematic.prototype.update_value = function() {\n\t    // label connection points\n\t    this.label_connection_points();\n\n\t    // build JSON data structure, convert to string value for\n\t    // input field\n\t    this.input.value = JSON.stringify(this.json_with_analyses());\n\t}\n\n\tSchematic.prototype.json = function() {\n\t    var json = [];\n\n\t    // output all the components/wires in the diagram\n\t    var n = this.components.length;\n\t    for (var i = 0; i < n; i++)\n\t\tjson.push(this.components[i].json(i));\n\n\t    // capture the current view parameters\n\t    json.push(['view',this.origin_x,this.origin_y,this.scale,\n\t\t       this.ac_npts,this.ac_fstart,this.ac_fstop,\n\t\t       this.ac_source_name,this.tran_npts,this.tran_tstop,\n\t\t       this.dc_max_iters]);\n\n\t    return json;\n\t}\n\n\tSchematic.prototype.json_with_analyses = function() {\n\t    var json = this.json();\n\n\t    if (this.dc_results != undefined) json.push(['dc',this.dc_results]);\n\t    if (this.ac_results != undefined) json.push(['ac',this.ac_results]);\n\t    if (this.transient_results != undefined) json.push(['transient',this.transient_results]);\n\n\t    return json;\n\t}\n\n\t///////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Simulation interface\n\t//\n\t////////////////////////////////////////////////////////////////////////////////\n\n\tSchematic.prototype.extract_circuit = function() {\n\t    // give all the circuit nodes a name, extract netlist\n\t    this.label_connection_points();\n\t    var netlist = this.json();\n\n\t    // since we've done the heavy lifting, update input field value\n\t    // so user can grab diagram if they want\n\t    this.input.value = JSON.stringify(netlist);\n\n\t    // create a circuit from the netlist\n\t    var ckt = new cktsim.Circuit();\n\t    if (ckt.load_netlist(netlist))\n\t\treturn ckt;\n\t    else\n\t\treturn null;\n\t}\n\n\tSchematic.prototype.dc_analysis = function() {\n\t    // remove any previous annotations\n\t    this.unselect_all(-1);\n\t    this.redraw_background();\n\n\t    var ckt = this.extract_circuit();\n\t    if (ckt === null) return;\n\n\t    // run the analysis\n\t    this.operating_point = ckt.dc();\n\n\t    if (this.operating_point != undefined) {\n\t\t// save a copy of the results for submission\n\t\tthis.dc_results = {};\n\t\tfor (var i in this.operating_point) this.dc_results[i] = this.operating_point[i];\n\n\t\t// display results on diagram\n\t\tthis.redraw();\n\t    }\n\t}\n\n\t// return a list of [color,node_label,offset,type] for each probe in the diagram\n\t// type == 'voltage' or 'current'\n\tSchematic.prototype.find_probes = function() {\n\t    var result = [];\n\t    var result = [];\n\t    for (var i = this.components.length - 1; i >= 0; --i) {\n\t\tvar c = this.components[i];\n\t\tvar info = c.probe_info();\n\t\tif (info != undefined) result.push(c.probe_info());\n\t    }\n\t    return result;\n\t}\n\n\t// use a dialog to get AC analysis parameters\n\tSchematic.prototype.setup_ac_analysis = function() {\n\t    this.unselect_all(-1);\n\t    this.redraw_background();\n\n\t    var npts_lbl = 'Number of points/decade';\n\t    var fstart_lbl = 'Starting frequency (Hz)';\n\t    var fstop_lbl = 'Ending frequency (Hz)';\n\t    var source_name_lbl = 'Name of V or I source for ac'\n\n\t    if (this.find_probes().length == 0) {\n\t\talert(\"AC Analysis: there are no voltage probes in the diagram!\");\n\t\treturn;\n\t    }\n\n        var fields = [];\n\t    fields[fstart_lbl] = build_input('text',10,this.ac_fstart);\n\t    fields[fstop_lbl] = build_input('text',10,this.ac_fstop);\n\t    fields[source_name_lbl] = build_input('text',10,this.ac_source_name);\n\n\t    var content = build_table(fields);\n\t    content.fields = fields;\n\t    content.sch = this;\n\n\t    this.dialog('AC Analysis',content,function(content) {\n\t\t    var sch = content.sch;\n\n\t\t    // retrieve parameters, remember for next time\n\t\t    sch.ac_fstart = content.fields[fstart_lbl].value;\n\t\t    sch.ac_fstop = content.fields[fstop_lbl].value;\n\t\t    sch.ac_source_name = content.fields[source_name_lbl].value;\n\n\t\t    sch.ac_analysis(cktsim.parse_number(sch.ac_npts),\n\t\t\t\t    cktsim.parse_number(sch.ac_fstart),\n\t\t\t\t    cktsim.parse_number(sch.ac_fstop),\n\t\t\t\t    sch.ac_source_name);\n\t\t});\n\t}\n\n\tSchematic.prototype.ac_analysis = function(npts,fstart,fstop,ac_source_name) {\n\t    var ckt = this.extract_circuit();\n\t    if (ckt === null) return;\n\t    var results = ckt.ac(npts,fstart,fstop,ac_source_name);\n\n\t    if (typeof results == 'string')\n\t\tthis.message(results);\n\t    else {\n\t\tvar x_values = results['_frequencies_'];\n\n\t\t// x axis will be a log scale\n\t\tfor (var i = x_values.length - 1; i >= 0; --i)\n\t\t    x_values[i] = Math.log(x_values[i])/Math.LN10;\n\n\t\tif (this.submit_analyses != undefined) {\n\t\t    var submit = this.submit_analyses['ac'];\n\t\t    if (submit != undefined) {\n\t\t\t// save a copy of the results for submission\n\t\t\tthis.ac_results = {};\n\n\t\t\t// save requested values for each requested node\n\t\t\tfor (var j = 0; j < submit.length; j++) {\n\t\t\t    var flist = submit[j];    // [node_name,f1,f2,...]\n\t\t\t    var node = flist[0];\n\t\t\t    var values = results[node];\n\t\t\t    var fvlist = [];\n\t\t\t    // for each requested freq, interpolate response value\n\t\t\t    for (var k = 1; k < flist.length; k++) {\n\t\t\t\tvar f = flist[k];\n\t\t\t\tvar v = interpolate(f,x_values,values);\n\t\t\t\t// convert to dB\n\t\t\t\tfvlist.push([f,v == undefined ? 'undefined' : 20.0 * Math.log(v)/Math.LN10]);\n\t\t\t    }\n\t\t\t    // save results as list of [f,response] paris\n\t\t\t    this.ac_results[node] = fvlist;\n\t\t\t}\n\t\t    }\n\t\t}\n\n\t\t// set up plot values for each node with a probe\n\t\tvar y_values = [];  // list of [color, result_array]\n\t\tvar z_values = [];  // list of [color, result_array]\n\t\tvar probes = this.find_probes();\n\t\tvar probe_maxv = [];\n\t\tvar probe_color = [];\n\n\t\t// Check for probe with near zero transfer function and warn\n\t\tfor (var i = probes.length - 1; i >= 0; --i) {\n\t\t    if (probes[i][3] != 'voltage') continue;\n\t\t    probe_color[i] = probes[i][0];\n\t\t    var label = probes[i][1];\n\t\t    var v = results[label];\n\t\t    probe_maxv[i] = array_max(v); // magnitudes always > 0\n\t\t}\n\n        var all_max = array_max(probe_maxv);\n\t\tif (all_max < 1.0e-16) {\n\t\t    alert('Zero ac response, -infinity on DB scale.');\n\t\t} else {\n\t\t    for (var i = probes.length - 1; i >= 0; --i) {\n\t\t\tif (probes[i][3] != 'voltage') continue;\n\t\t\tif ((probe_maxv[i] / all_max) < 1.0e-10) {\n\t\t\t    alert('Near zero ac response, remove ' + probe_color[i] + ' probe');\n\t\t\t    return;\n\t\t\t}\n\t\t    }\n\t\t}\n\n\t\tfor (var i = probes.length - 1; i >= 0; --i) {\n\t\t    if (probes[i][3] != 'voltage') continue;\n\t\t    var color = probes[i][0];\n\t\t    var label = probes[i][1];\n\t\t    var offset = cktsim.parse_number(probes[i][2]);\n\t\t    var v = results[label];\n\t\t    // convert values into dB relative to source amplitude\n\t\t    var v_max = 1;\n\t\t    for (var j = v.length - 1; j >= 0; --j)\n\t\t\t// convert each value to dB relative to max\n\t\t\tv[j] = 20.0 * Math.log(v[j]/v_max)/Math.LN10;\n\t\t    y_values.push([color,offset,v]);\n\n\t\t    var v = results[label+'_phase'];\n\t\t    z_values.push([color,0,v]);\n\t\t}\n\n\t\t// graph the result and display in a window\n\t\tvar graph2 = this.graph(x_values,'log(Frequency in Hz)',z_values,'degrees');\n\t\tthis.window('AC Analysis - Phase',graph2);\n\t\tvar graph1 = this.graph(x_values,'log(Frequency in Hz)',y_values,'dB');\n\t\tthis.window('AC Analysis - Magnitude',graph1,50);\n\t    }\n\t}\n\n\tSchematic.prototype.transient_analysis = function() {\n\t    this.unselect_all(-1);\n\t    this.redraw_background();\n\n\t    var npts_lbl = 'Minimum number of timepoints';\n\t    var tstop_lbl = 'Stop Time (seconds)';\n\t    var probes = this.find_probes();\n\t    if (probes.length == 0) {\n\t\talert(\"Transient Analysis: there are no probes in the diagram!\");\n\t\treturn;\n\t    }\n\n        var fields = [];\n\t    fields[tstop_lbl] = build_input('text',10,this.tran_tstop);\n\n\t    var content = build_table(fields);\n\t    content.fields = fields;\n\t    content.sch = this;\n\n\t    this.dialog('Transient Analysis',content,function(content) {\n\t\t    var sch = content.sch;\n\t\t    var ckt = sch.extract_circuit();\n\t\t    if (ckt === null) return;\n\n\t\t    // retrieve parameters, remember for next time\n\t\t    sch.tran_tstop = content.fields[tstop_lbl].value;\n\n\t\t    // gather a list of nodes that are being probed.  These\n\t\t    // will be added to the list of nodes checked during the\n\t\t    // LTE calculations in transient analysis\n\t\t    var probe_list = sch.find_probes();\n\t\t    var probe_names = new Array(probe_list.length);\n\t\t    for (var i = probe_list.length - 1; i >= 0; --i)\n\t\t\tprobe_names[i] = probe_list[i][1];\n\n\t\t    // run the analysis\n\t\t    var results = ckt.tran(ckt.parse_number(sch.tran_npts), 0,\n\t\t\t\t\t   ckt.parse_number(sch.tran_tstop), probe_names, false);\n\n\t\t    if (typeof results == 'string')\n\t\t\tsch.message(results);\n\t\t    else {\n\t\t\tif (sch.submit_analyses != undefined) {\n\t\t\t    var submit = sch.submit_analyses['tran'];\n\t\t\t    if (submit != undefined) {\n\t\t\t\t// save a copy of the results for submission\n\t\t\t\tsch.transient_results = {};\n\t\t\t\tvar times = results['_time_'];\n\n\t\t\t\t// save requested values for each requested node\n\t\t\t\tfor (var j = 0; j < submit.length; j++) {\n\t\t\t\t    var tlist = submit[j];    // [node_name,t1,t2,...]\n\t\t\t\t    var node = tlist[0];\n\t\t\t\t    var values = results[node];\n\t\t\t\t    var tvlist = [];\n\t\t\t\t    // for each requested time, interpolate waveform value\n\t\t\t\t    for (var k = 1; k < tlist.length; k++) {\n\t\t\t\t\tvar t = tlist[k];\n\t\t\t\t\tvar v = interpolate(t,times,values);\n\t\t\t\t\ttvlist.push([t,v == undefined ? 'undefined' : v]);\n\t\t\t\t    }\n\t\t\t\t    // save results as list of [t,value] pairs\n\t\t\t\t    sch.transient_results[node] = tvlist;\n\t\t\t\t}\n\t\t\t    }\n\t\t\t}\n\n\t\t\tvar x_values = results['_time_'];\n\t\t\tvar x_legend = 'Time';\n\n\t\t\t// set up plot values for each node with a probe\n\t\t\tvar v_values = [];  // voltage values: list of [color, result_array]\n\t\t\tvar i_values = [];  // current values: list of [color, result_array]\n\t\t\tvar probes = sch.find_probes();\n\n\t\t\tfor (var i = probes.length - 1; i >= 0; --i) {\n\t\t\t    var color = probes[i][0];\n\t\t\t    var label = probes[i][1];\n\t\t\t    var offset = cktsim.parse_number(probes[i][2]);\n\t\t\t    var v = results[label];\n\t\t\t    if (v == undefined) {\n\t\t\t\talert('The ' + color + ' probe is connected to node ' + '\"' + label + '\"' + ' which is not an actual circuit node');\n\t\t\t    } else if (probes[i][3] == 'voltage') {\n\t\t\t\tif (color == 'x-axis') {\n\t\t\t\t    x_values = v;\n\t\t\t\t    x_legend = 'Voltage';\n\t\t\t\t} else v_values.push([color,offset,v]);\n\t\t\t    } else {\n\t\t\t\tif (color == 'x-axis') {\n\t\t\t\t    x_values = v;\n\t\t\t\t    x_legend = 'Current';\n\t\t\t\t} else i_values.push([color,offset,v]);\n\t\t\t    }\n\t\t\t}\n\n\t\t\t// graph the result and display in a window\n\t\t\tvar graph = sch.graph(x_values,x_legend,v_values,'Voltage',i_values,'Current');\n\t\t\tsch.window('Results of Transient Analysis',graph);\n\t\t    }\n\t    })\n\t}\n\n\t// t is the time at which we want a value\n\t// times is a list of timepoints from the simulation\n\tfunction interpolate(t,times,values) {\n\t    if (values == undefined) return undefined;\n\n\t    for (var i = 0; i < times.length; i++)\n\t\tif (t < times[i]) {\n\t\t    // t falls between times[i-1] and times[i]\n\t\t    var t1 = (i == 0) ? times[0] : times[i-1];\n\t\t    var t2 = times[i];\n\n\t\t    if (t2 == undefined) return undefined;\n\n\t\t    var v1 = (i == 0) ? values[0] : values[i-1];\n\t\t    var v2 = values[i];\n\t\t    var v = v1;\n\t\t    if (t != t1) v += (t - t1)*(v2 - v1)/(t2 - t1);\n\t\t    return v;\n\t\t}\n\t}\n\n\t// external interface for setting the property value of a named component\n\tSchematic.prototype.set_property = function(component_name,property,value) {\n\t    this.unselect_all(-1);\n\n\t    for (var i = this.components.length - 1; i >= 0; --i) {\n\t\tvar component = this.components[i];\n\t\tif (component.properties['name'] == component_name) {\n\t\t    component.properties[property] = value.toString();\n\t\t    break;\n\t\t}\n\t    }\n\n\t    this.redraw_background();\n\t}\n\n\t///////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Drawing support -- deals with scaling and scrolling of diagrama\n\t//\n\t////////////////////////////////////////////////////////////////////////////////\n\n\t// here to redraw background image containing static portions of the schematic.\n\t// Also redraws dynamic portion.\n\tSchematic.prototype.redraw_background = function() {\n\t    var c = this.bg_image.getContext('2d');\n\n\t    c.lineCap = 'round';\n\n\t    // paint background color\n\t    c.fillStyle = element_style;\n\t    c.fillRect(0,0,this.width,this.height);\n\n\t    if (!this.diagram_only && this.show_grid) {\n\t\t// grid\n\t\tc.strokeStyle = grid_style;\n\t\tvar first_x = this.origin_x;\n\t\tvar last_x = first_x + this.width/this.scale;\n\t\tvar first_y = this.origin_y;\n\t\tvar last_y = first_y + this.height/this.scale;\n\n\t\tfor (var i = this.grid*Math.ceil(first_x/this.grid); i < last_x; i += this.grid)\n\t\t    this.draw_line(c,i,first_y,i,last_y,0.1);\n\n\t\tfor (var i = this.grid*Math.ceil(first_y/this.grid); i < last_y; i += this.grid)\n\t\t    this.draw_line(c,first_x,i,last_x,i,0.1);\n\t    }\n\n\t    // unselected components\n\t    var min_x = Infinity;  // compute bounding box for diagram\n\t    var max_x = -Infinity;\n\t    var min_y = Infinity;\n\t    var max_y = -Infinity;\n\t    for (var i = this.components.length - 1; i >= 0; --i) {\n\t\tvar component = this.components[i];\n\t\tif (!component.selected) {\n\t\t    component.draw(c);\n\t\t    min_x = Math.min(component.bbox[0],min_x);\n\t\t    max_x = Math.max(component.bbox[2],max_x);\n\t\t    min_y = Math.min(component.bbox[1],min_y);\n\t\t    max_y = Math.max(component.bbox[3],max_y);\n\t\t}\n\t    }\n\t    this.unsel_bbox = [min_x,min_y,max_x,max_y];\n\t    this.redraw();   // background changed, redraw on screen\n\t}\n\n\t// redraw what user sees = static image + dynamic parts\n\tSchematic.prototype.redraw = function() {\n\t    var c = this.canvas.getContext('2d');\n\n\t    // put static image in the background\n\t    c.drawImage(this.bg_image, 0, 0);\n\n\t    // selected components\n\t    var min_x = this.unsel_bbox[0];   // compute bounding box for diagram\n\t    var max_x = this.unsel_bbox[2];\n\t    var min_y = this.unsel_bbox[1];\n\t    var max_y = this.unsel_bbox[3];\n\t    var selections = false;\n\t    for (var i = this.components.length - 1; i >= 0; --i) {\n\t\tvar component = this.components[i];\n\t\tif (component.selected) {\n\t\t    component.draw(c);\n\t\t    selections = true;\n\t\t    min_x = Math.min(component.bbox[0],min_x);\n\t\t    max_x = Math.max(component.bbox[2],max_x);\n\t\t    min_y = Math.min(component.bbox[1],min_y);\n\t\t    max_y = Math.max(component.bbox[3],max_y);\n\t\t}\n\t    }\n\t    if (min_x == Infinity) this.bbox = [0,0,0,0];\n\t    else this.bbox = [min_x,min_y,max_x,max_y];\n\t    this.enable_tool('cut',selections);\n\t    this.enable_tool('copy',selections);\n\t    this.enable_tool('paste',sch_clipboard.length > 0);\n\n\t    // connection points: draw one at each location\n\t    for (var location in this.connection_points) {\n\t\tvar cplist = this.connection_points[location];\n\t\tcplist[0].draw(c,cplist.length);\n\t    }\n\n\t    // draw new wire\n\t    if (this.wire) {\n\t\tvar r = this.wire;\n\t\tc.strokeStyle = selected_style;\n\t\tthis.draw_line(c,r[0],r[1],r[2],r[3],1);\n\t    }\n\n\t    // draw selection rectangle\n\t    if (this.select_rect) {\n\t\tvar r = this.select_rect;\n\t\tc.lineWidth = 1;\n\t\tc.strokeStyle = selected_style;\n\t\tc.beginPath();\n\t\tc.moveTo(r[0],r[1]);\n\t\tc.lineTo(r[0],r[3]);\n\t\tc.lineTo(r[2],r[3]);\n\t\tc.lineTo(r[2],r[1]);\n\t\tc.lineTo(r[0],r[1]);\n\t\tc.stroke();\n\t    }\n\n\t    // display operating point results\n\t    if (this.operating_point) {\n\t\tif (typeof this.operating_point == 'string')\n\t\t    this.message(this.operating_point);\n\t\telse {\n\t\t    // make a copy of the operating_point info so we can mess with it\n            var temp = [];\n\t\t    for (var i in this.operating_point) temp[i] = this.operating_point[i];\n\n\t\t    // run through connection points displaying (once) the voltage\n\t\t    // for each electrical node\n\t\t    for (var location in this.connection_points)\n\t\t\t(this.connection_points[location])[0].display_voltage(c,temp);\n\n\t\t    // let components display branch current info if available\n\t\t    for (var i = this.components.length - 1; i >= 0; --i)\n\t\t\tthis.components[i].display_current(c,temp)\n\t\t}\n\t    }\n\n\t    // add scrolling/zooming control\n\t    if (!this.diagram_only) {\n\t\tvar r = this.sctl_r;\n\t\tvar x = this.sctl_x;\n\t\tvar y = this.sctl_y;\n\n\t\t// circle with border\n\t\tc.fillStyle = element_style;\n\t\tc.beginPath();\n\t\tc.arc(x,y,r,0,2*Math.PI);\n\t\tc.fill();\n\n\t\tc.strokeStyle = grid_style;\n\t\tc.lineWidth = 0.5;\n\t\tc.beginPath();\n\t\tc.arc(x,y,r,0,2*Math.PI);\n\t\tc.stroke();\n\n\t\t// direction markers for scroll\n\t\tc.lineWidth = 3;\n\t\tc.beginPath();\n\n\t\tc.moveTo(x + 4,y - r + 8);   // north\n\t\tc.lineTo(x,y - r + 4);\n\t\tc.lineTo(x - 4,y - r + 8);\n\n\t\tc.moveTo(x + r - 8,y + 4);   // east\n\t\tc.lineTo(x + r - 4,y);\n\t\tc.lineTo(x + r - 8,y - 4);\n\n\t\tc.moveTo(x + 4,y + r - 8);   // south\n\t\tc.lineTo(x,y + r - 4);\n\t\tc.lineTo(x - 4,y + r - 8);\n\n\t\tc.moveTo(x - r + 8,y + 4);   // west\n\t\tc.lineTo(x - r + 4,y);\n\t\tc.lineTo(x - r + 8,y - 4);\n\n\t\tc.stroke();\n\n\t\t// zoom control\n\t\tx = this.zctl_left;\n\t\ty = this.zctl_top;\n\t\tc.lineWidth = 0.5;\n\t\tc.fillStyle = element_style;    // background\n\t\tc.fillRect(x,y,16,48);\n\t\tc.strokeStyle = grid_style;     // border\n\t\tc.strokeRect(x,y,16,48);\n\t\tc.lineWidth = 1.0;\n\t\tc.beginPath();\n\t\t// zoom in label\n\t\tc.moveTo(x+4,y+8); c.lineTo(x+12,y+8); c.moveTo(x+8,y+4); c.lineTo(x+8,y+12);\n\t\t// zoom out label\n\t\tc.moveTo(x+4,y+24); c.lineTo(x+12,y+24);\n\t\t// surround label\n\t\tc.strokeRect(x+4,y+36,8,8);\n\t\tc.stroke();\n\t    }\n\t}\n\n\t// draws a cross cursor\n\tSchematic.prototype.cross_cursor = function(c,x,y) {\n\t    this.draw_line(c,x-this.grid,y,x+this.grid,y,1);\n\t    this.draw_line(c,x,y-this.grid,x,y+this.grid,1);\n\t}\n\n\tSchematic.prototype.moveTo = function(c,x,y) {\n\t    c.moveTo((x - this.origin_x) * this.scale,(y - this.origin_y) * this.scale);\n\t}\n\n\tSchematic.prototype.lineTo = function(c,x,y) {\n\t    c.lineTo((x - this.origin_x) * this.scale,(y - this.origin_y) * this.scale);\n\t}\n\n\tSchematic.prototype.draw_line = function(c,x1,y1,x2,y2,width) {\n\t    c.lineWidth = width*this.scale;\n\t    c.beginPath();\n\t    c.moveTo((x1 - this.origin_x) * this.scale,(y1 - this.origin_y) * this.scale);\n\t    c.lineTo((x2 - this.origin_x) * this.scale,(y2 - this.origin_y) * this.scale);\n\t    c.stroke();\n\t}\n\n\tSchematic.prototype.draw_arc = function(c,x,y,radius,start_radians,end_radians,anticlockwise,width,filled) {\n\t    c.lineWidth = width*this.scale;\n\t    c.beginPath();\n\t    c.arc((x - this.origin_x)*this.scale,(y - this.origin_y)*this.scale,radius*this.scale,\n\t\t  start_radians,end_radians,anticlockwise);\n\t    if (filled) c.fill();\n\t    else c.stroke();\n\t}\n\n\tSchematic.prototype.draw_text = function(c,text,x,y,size) {\n\t    c.font = size*this.scale+'pt sans-serif'\n\t    c.fillText(text,(x - this.origin_x) * this.scale,(y - this.origin_y) * this.scale);\n\t}\n\n\t// add method to canvas to compute relative coords for event\n\ttry {\n\t\tif (HTMLCanvasElement)\n\t\t HTMLCanvasElement.prototype.relMouseCoords = function(event){\n\t\t    // run up the DOM tree to figure out coords for top,left of canvas\n\t\t    var totalOffsetX = 0;\n\t\t    var totalOffsetY = 0;\n\t\t    var currentElement = this;\n\t\t    do {\n\t\t\ttotalOffsetX += currentElement.offsetLeft;\n\t\t\ttotalOffsetY += currentElement.offsetTop;\n\t\t    }\n\t\t    while (currentElement = currentElement.offsetParent);\n\n\t\t    // now compute relative position of click within the canvas\n\t\t    this.mouse_x = event.pageX - totalOffsetX;\n\t\t    this.mouse_y = event.pageY - totalOffsetY;\n\t\t    this.page_x = event.pageX;\n\t\t    this.page_y = event.pageY;\n\t\t }\n\t}\n\tcatch (err) { // ignore\n\t}\n\n\t///////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Event handling\n\t//\n\t////////////////////////////////////////////////////////////////////////////////\n\n\t// process keystrokes, consuming those that are meaningful to us\n\tfunction schematic_key_down(event) {\n\t    if (!event) event = window.event;\n\t    var sch = (window.event) ? event.srcElement.schematic : event.target.schematic;\n\t    var code = event.keyCode;\n\n\t    // keep track of modifier key state\n\t    if (code == 16) sch.shiftKey = true;\n\t    else if (code == 17) sch.ctrlKey = true;\n\t    else if (code == 18) sch.altKey = true;\n\t    else if (code == 91) sch.cmdKey = true;\n\n\t    // backspace or delete: delete selected components\n\t    else if (code == 8 || code == 46) {\n\t\t// delete selected components\n\t\tfor (var i = sch.components.length - 1; i >= 0; --i) {\n\t\t    var component = sch.components[i];\n\t\t    if (component.selected) component.remove();\n\t\t}\n\t\tsch.clean_up_wires();\n\t\tsch.redraw_background();\n\t\tevent.preventDefault();\n\t\treturn false;\n\t    }\n\n\t    // cmd/ctrl x: cut\n\t    else if ((sch.ctrlKey || sch.cmdKey) && code == 88) {\n\t\tsch.cut();\n\t\tevent.preventDefault();\n\t\treturn false;\n\t    }\n\n\t    // cmd/ctrl c: copy\n\t    else if ((sch.ctrlKey || sch.cmdKey) && code == 67) {\n\t\tsch.copy();\n\t\tevent.preventDefault();\n\t\treturn false;\n\t    }\n\n\t    // cmd/ctrl v: paste\n\t    else if ((sch.ctrlKey || sch.cmdKey) && code == 86) {\n\t\tsch.paste();\n\t\tevent.preventDefault();\n\t\treturn false;\n\t    }\n\n\t    // 'r': rotate component\n\t    else if (!sch.ctrlKey && !sch.altKey && !sch.cmdKey && code == 82) {\n\t\t// rotate\n\t\tfor (var i = sch.components.length - 1; i >= 0; --i) {\n\t\t    var component = sch.components[i];\n\t\t    if (component.selected) {\n\t\t\tcomponent.rotate(1);\n\t\t\tsch.check_wires(component);\n\t\t    }\n\t\t}\n\t\tsch.clean_up_wires();\n\t\tsch.redraw_background();\n\t\tevent.preventDefault();\n\t\treturn false;\n\t    }\n\n\t    else return true;\n\n\t    // consume keystroke\n\t    sch.redraw();\n\t    event.preventDefault();\n\t    return false;\n\t}\n\n\tfunction schematic_key_up(event) {\n\t    if (!event) event = window.event;\n\t    var sch = (window.event) ? event.srcElement.schematic : event.target.schematic;\n\t    var code = event.keyCode;\n\n\t    if (code == 16) sch.shiftKey = false;\n\t    else if (code == 17) sch.ctrlKey = false;\n\t    else if (code == 18) sch.altKey = false;\n\t    else if (code == 91) sch.cmdKey = false;\n\t}\n\n\tfunction schematic_mouse_enter(event) {\n\t    if (!event) event = window.event;\n\t    var sch = (window.event) ? event.srcElement.schematic : event.target.schematic;\n\n\t    // see if user has selected a new part\n\t    if (sch.new_part) {\n\t\t// grab incoming part, turn off selection of parts bin\n\t\tvar part = sch.new_part;\n\t\tsch.new_part = undefined;\n\t\tpart.select(false);\n\n\t\t// unselect everything else in the schematic, add part and select it\n\t\tsch.unselect_all(-1);\n\t\tsch.redraw_background();  // so we see any components that got unselected\n\n\t\t// make a clone of the component in the parts bin\n\t\tpart = part.component.clone(sch.cursor_x,sch.cursor_y);\n\t\tpart.add(sch);  // add it to schematic\n\t\tpart.set_select(true);\n\n\t\t// and start dragging it\n\t\tsch.drag_begin();\n\t    }\n\n\t    sch.drawCursor = true;\n\t    sch.redraw();\n\t    sch.canvas.focus();  // capture key strokes\n\t    return false;\n\t}\n\n\tfunction schematic_mouse_leave(event) {\n\t    if (!event) event = window.event;\n\t    var sch = (window.event) ? event.srcElement.schematic : event.target.schematic;\n\t    sch.drawCursor = false;\n\t    sch.redraw();\n\t    return false;\n\t}\n\n\tfunction schematic_mouse_down(event) {\n\t    if (!event) event = window.event;\n\t    else event.preventDefault();\n\t    var sch = (window.event) ? event.srcElement.schematic : event.target.schematic;\n\n\t    // determine where event happened in schematic coordinates\n\t    sch.canvas.relMouseCoords(event);\n\n\t    var mx = sch.canvas.mouse_x;\n\t    var my = sch.canvas.mouse_y;\n\t    var sx = mx - sch.sctl_x;\n\t    var sy = my - sch.sctl_y;\n\t    var zx = mx - sch.zctl_left;\n\t    var zy = my - sch.zctl_top;\n\t    if (sx*sx + sy*sy <= sch.sctl_r*sch.sctl_r) {   // click in scrolling control\n\t\t// click on scrolling control, check which quadrant\n\t\tif (Math.abs(sy) > Math.abs(sx)) {   // N or S\n\t\t    var delta = this.height / 8;\n\t\t    if (sy > 0) delta = -delta;\n\t\t    var temp = sch.origin_y - delta;\n\t\t    if (temp > origin_min*sch.grid && temp < origin_max*sch.grid) sch.origin_y = temp;\n\t\t} else {\t\t\t    // E or W\n\t\t    var delta = this.width / 8;\n\t\t    if (sx < 0) delta = -delta;\n\t\t    var temp = sch.origin_x + delta;\n\t\t    if (temp > origin_min*sch.grid && temp < origin_max*sch.grid) sch.origin_x = temp;\n\t\t}\n\t    } else if (zx >= 0 && zx < 16 && zy >= 0 && zy < 48) {   // click in zoom control\n\t\tif (zy < 16) sch.zoomin();\n\t\telse if (zy < 32) sch.zoomout();\n\t\telse sch.zoomall();\n\t    } else {\n\t\tvar x = mx/sch.scale + sch.origin_x;\n\t\tvar y = my/sch.scale + sch.origin_y;\n\t\tsch.cursor_x = Math.round(x/sch.grid) * sch.grid;\n\t\tsch.cursor_y = Math.round(y/sch.grid) * sch.grid;\n\n\t\t// is mouse over a connection point?  If so, start dragging a wire\n\t\tvar cplist = sch.connection_points[sch.cursor_x + ',' + sch.cursor_y];\n\t\tif (cplist && !event.shiftKey) {\n\t\t    sch.unselect_all(-1);\n\t\t    sch.wire = [sch.cursor_x,sch.cursor_y,sch.cursor_x,sch.cursor_y];\n\t\t} else {\n\t\t    // give all components a shot at processing the selection event\n\t\t    var which = -1;\n\t\t    for (var i = sch.components.length - 1; i >= 0; --i)\n\t\t\tif (sch.components[i].select(x,y,event.shiftKey)) {\n\t\t\t    if (sch.components[i].selected) {\n\t\t\t\tsch.drag_begin();\n\t\t\t\twhich = i;  // keep track of component we found\n\t\t\t    }\n\t\t\t    break;\n\t\t\t}\n\t\t    // did we just click on a previously selected component?\n\t\t    var reselect = which!=-1 && sch.components[which].was_previously_selected;\n\n\t\t    if (!event.shiftKey) {\n\t\t\t// if shift key isn't pressed and we didn't click on component\n\t\t\t// that was already selected, unselect everyone except component\n\t\t\t// we just clicked on\n\t\t\tif (!reselect) sch.unselect_all(which);\n\n\t\t\t// if there's nothing to drag, set up a selection rectangle\n\t\t\tif (!sch.dragging) sch.select_rect = [sch.canvas.mouse_x,sch.canvas.mouse_y,\n\t\t\t\t\t\t\t      sch.canvas.mouse_x,sch.canvas.mouse_y];\n\t\t    }\n\t\t}\n\t    }\n\n\t    sch.redraw_background();\n\t    return false;\n\t}\n\n\tfunction schematic_mouse_move(event) {\n\t    if (!event) event = window.event;\n\t    var sch = (window.event) ? event.srcElement.schematic : event.target.schematic;\n\n\t    sch.canvas.relMouseCoords(event);\n\t    var x = sch.canvas.mouse_x/sch.scale + sch.origin_x;\n\t    var y = sch.canvas.mouse_y/sch.scale + sch.origin_y;\n\t    sch.cursor_x = Math.round(x/sch.grid) * sch.grid;\n\t    sch.cursor_y = Math.round(y/sch.grid) * sch.grid;\n\n\t    if (sch.wire) {\n\t\t// update new wire end point\n\t\tsch.wire[2] = sch.cursor_x;\n\t\tsch.wire[3] = sch.cursor_y;\n\t    } else if (sch.dragging) {\n\t\t// see how far we moved\n\t\tvar dx = sch.cursor_x - sch.drag_x;\n\t\tvar dy = sch.cursor_y - sch.drag_y;\n\t\tif (dx != 0 || dy != 0) {\n\t\t    // update position for next time\n\t\t    sch.drag_x = sch.cursor_x;\n\t\t    sch.drag_y = sch.cursor_y;\n\n\t\t    // give all components a shot at processing the event\n\t\t    for (var i = sch.components.length - 1; i >= 0; --i) {\n\t\t\tvar component = sch.components[i];\n\t\t\tif (component.selected) component.move(dx,dy);\n\t\t    }\n\t\t}\n\t    } else if (sch.select_rect) {\n\t\t// update moving corner of selection rectangle\n\t\tsch.select_rect[2] = sch.canvas.mouse_x;\n\t\tsch.select_rect[3] = sch.canvas.mouse_y;\n\t    }\n\n\t    // just redraw dynamic components\n\t    sch.redraw();\n\n\t    return false;\n\t}\n\n\tfunction schematic_mouse_up(event) {\n\t    if (!event) event = window.event;\n\t    else event.preventDefault();\n\t    var sch = (window.event) ? event.srcElement.schematic : event.target.schematic;\n\n\t    // drawing a new wire\n\t    if (sch.wire) {\n\t\tvar r = sch.wire;\n\t\tsch.wire = undefined;\n\n\t\tif (r[0]!=r[2] || r[1]!=r[3]) {\n\t\t    // insert wire component\n\t\t    sch.add_wire(r[0],r[1],r[2],r[3]);\n\t\t    sch.clean_up_wires();\n\t\t    sch.redraw_background();\n\t\t} else sch.redraw();\n\t    }\n\n\t    // dragging\n\t    if (sch.dragging) sch.drag_end();\n\n\t    // selection rectangle\n\t    if (sch.select_rect) {\n\t\tvar r = sch.select_rect;\n\n\t\t// if select_rect is a point, we've already dealt with selection\n\t\t// in mouse_down handler\n\t\tif (r[0]!=r[2] || r[1]!=r[3]) {\n\t\t    // convert to schematic coordinates\n\t\t    var s = [r[0]/sch.scale + sch.origin_x, r[1]/sch.scale + sch.origin_y,\n\t\t\t     r[2]/sch.scale + sch.origin_x, r[3]/sch.scale + sch.origin_y];\n\t\t    canonicalize(s);\n\n\t\t    if (!event.shiftKey) sch.unselect_all();\n\n\t\t    // select components that intersect selection rectangle\n\t\t    for (var i = sch.components.length - 1; i >= 0; --i)\n\t\t\tsch.components[i].select_rect(s,event.shiftKey);\n\t\t}\n\n\t\tsch.select_rect = undefined;\n\t\tsch.redraw_background();\n\t    }\n\t    return false;\n\t}\n\n\tfunction schematic_mouse_wheel(event) {\n\t    if (!event) event = window.event;\n\t    else event.preventDefault();\n\t    var sch = (window.event) ? event.srcElement.schematic : event.target.schematic;\n\n\t    var delta = 0;\n\t    if (event.wheelDelta) delta = event.wheelDelta;\n\t    else if (event.detail) delta = -event.detail;\n\n\t    if (delta) {\n\t\tvar nscale = (delta > 0) ? sch.scale*zoom_factor : sch.scale/zoom_factor;\n\n\t\tif (nscale > zoom_min && nscale < zoom_max) {\n\t\t    // zoom around current mouse position\n\t\t    sch.canvas.relMouseCoords(event);\n\t\t    var s = 1.0/sch.scale - 1.0/nscale;\n\t\t    sch.origin_x += sch.canvas.mouse_x*s;\n\t\t    sch.origin_y += sch.canvas.mouse_y*s;\n\t\t    sch.scale = nscale;\n\t\t    sch.redraw_background();\n\t\t}\n\t    }\n\t}\n\n\tfunction schematic_double_click(event) {\n\t    if (!event) event = window.event;\n\t    else event.preventDefault();\n\t    var sch = (window.event) ? event.srcElement.schematic : event.target.schematic;\n\n\t    // determine where event happened in schematic coordinates\n\t    sch.canvas.relMouseCoords(event);\n\t    var x = sch.canvas.mouse_x/sch.scale + sch.origin_x;\n\t    var y = sch.canvas.mouse_y/sch.scale + sch.origin_y;\n\t    sch.cursor_x = Math.round(x/sch.grid) * sch.grid;\n\t    sch.cursor_y = Math.round(y/sch.grid) * sch.grid;\n\n\t    // see if we double-clicked a component.  If so, edit it's properties\n\t    for (var i = sch.components.length - 1; i >= 0; --i)\n\t\tif (sch.components[i].edit_properties(x,y))\n\t\t    break;\n\n\t    return false;\n\t}\n\n\t///////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Status message and dialogs\n\t//\n\t////////////////////////////////////////////////////////////////////////////////\n\n\tSchematic.prototype.message = function(message) {\n\t    this.status.nodeValue = message;\n\t}\n\n\tSchematic.prototype.append_message = function(message) {\n\t    this.status.nodeValue += ' / '+message;\n\t}\n\n\t// set up a dialog with specified title, content and two buttons at\n\t// the bottom: OK and Cancel.  If Cancel is clicked, dialog goes away\n\t// and we're done.  If OK is clicked, dialog goes away and the\n\t// callback function is called with the content as an argument (so\n\t// that the values of any fields can be captured).\n\tSchematic.prototype.dialog = function(title,content,callback) {\n\t    // create the div for the top level of the dialog, add to DOM\n\t    var dialog = document.createElement('div');\n\t    dialog.sch = this;\n\t    dialog.content = content;\n\t    dialog.callback = callback;\n\n\t    // look for property input fields in the content and give\n\t    // them a keypress listener that interprets ENTER as\n\t    // clicking OK.\n\t    var plist = content.getElementsByClassName('property');\n\t    for (var i = plist.length - 1; i >= 0; --i) {\n\t\tvar field = plist[i];\n\t\tfield.dialog = dialog;  // help event handler find us...\n\t\tfield.addEventListener('keypress',dialog_check_for_ENTER,false);\n\t    }\n\n\t    // div to hold the content\n\t    var body = document.createElement('div');\n\t    content.style.marginBotton = '5px';\n\t    body.appendChild(content);\n\t    body.style.padding = '5px';\n\t    dialog.appendChild(body);\n\n\t    var ok_button = document.createElement('span');\n\t    ok_button.appendChild(document.createTextNode('OK'));\n\t    ok_button.dialog = dialog;   // for the handler to use\n\t    ok_button.addEventListener('click',dialog_okay,false);\n\t    ok_button.style.display = 'inline';\n\t    ok_button.style.border = '1px solid';\n\t    ok_button.style.padding = '5px';\n\t    ok_button.style.margin = '10px';\n\n\t    var cancel_button = document.createElement('span');\n\t    cancel_button.appendChild(document.createTextNode('Cancel'));\n\t    cancel_button.dialog = dialog;   // for the handler to use\n\t    cancel_button.addEventListener('click',dialog_cancel,false);\n\t    cancel_button.style.display = 'inline';\n\t    cancel_button.style.border = '1px solid';\n\t    cancel_button.style.padding = '5px';\n\t    cancel_button.style.margin = '10px';\n\n\t    // div to hold the two buttons\n\t    var buttons = document.createElement('div');\n\t    buttons.style.textAlign = 'center';\n\t    buttons.appendChild(ok_button);\n\t    buttons.appendChild(cancel_button);\n\t    buttons.style.padding = '5px';\n\t    buttons.style.margin = '10px';\n\t    dialog.appendChild(buttons);\n\n\t    // put into an overlay window\n\t    this.window(title,dialog);\n\t}\n\n\tfunction dialog_cancel(event) {\n\t    if (!event) event = window.event;\n\t    var dialog = (window.event) ? event.srcElement.dialog : event.target.dialog;\n\n\t    window_close(dialog.win);\n\t}\n\n\tfunction dialog_okay(event) {\n\t    if (!event) event = window.event;\n\t    var dialog = (window.event) ? event.srcElement.dialog : event.target.dialog;\n\n\t    window_close(dialog.win);\n\n\t    if (dialog.callback) dialog.callback(dialog.content);\n\t}\n\n\t// callback for keypress in input fields: if user typed ENTER, act\n\t// like they clicked OK button.\n\tfunction dialog_check_for_ENTER(event) {\n\t    var key = (window.event) ? window.event.keyCode : event.keyCode;\n\t    if (key == 13) dialog_okay(event);\n\t}\n\n\t///////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Draggable, resizeable, closeable window\n\t//\n\t////////////////////////////////////////////////////////////////////////////////\n\n\t// build a 2-column HTML table from an associative array (keys as text in\n\t// column 1, values in column 2).\n\tfunction build_table(a) {\n\t    var tbl = document.createElement('table');\n\n\t    // build a row for each element in associative array\n\t    for (var i in a) {\n\t\tvar label = document.createTextNode(i + ': ');\n\t\tvar col1 = document.createElement('td');\n\t\tcol1.appendChild(label);\n\t\tvar col2 = document.createElement('td');\n\t\tcol2.appendChild(a[i]);\n\t\tvar row = document.createElement('tr');\n\t\trow.appendChild(col1);\n\t\trow.appendChild(col2);\n\t\trow.style.verticalAlign = 'center';\n\t\ttbl.appendChild(row);\n\t    }\n\n\t    return tbl;\n\t}\n\n\tfunction build_input(type,size,value) {\n\t    var input = document.createElement('input');\n\t    input.type = type;\n\t    input.size = size;\n\t    input.className = 'property';  // make this easier to find later\n\t    if (value == undefined) input.value = '';\n\t    else input.value = value.toString();\n\t    return input;\n\t}\n\n\t// build a select widget using the strings found in the options array\n\tfunction build_select(options,selected) {\n\t    var select = document.createElement('select');\n\t    for (var i = 0; i < options.length; i++) {\n\t\tvar option = document.createElement('option');\n\t\toption.text = options[i];\n\t\tselect.add(option);\n\t\tif (options[i] == selected) select.selectedIndex = i;\n\t    }\n\t    return select;\n\t}\n\n\tSchematic.prototype.window = function(title,content,offset) {\n\t    // create the div for the top level of the window\n\t    var win = document.createElement('div');\n\t    win.sch = this;\n\t    win.content = content;\n\t    win.drag_x = undefined;\n\t    win.draw_y = undefined;\n\n\t    // div to hold the title\n\t    var head = document.createElement('div');\n\t    head.style.backgroundColor = 'black';\n\t    head.style.color = 'white';\n\t    head.style.textAlign = 'center';\n\t    head.style.padding = '5px';\n\t    head.appendChild(document.createTextNode(title));\n\t    head.win = win;\n\t    win.head = head;\n\n\t    var close_button = new Image();\n\t    close_button.src = close_icon;\n\t    close_button.style.cssFloat = 'right';\n\t    close_button.addEventListener('click',window_close_button,false);\n\t    close_button.win = win;\n\t    head.appendChild(close_button);\n\n\t    win.appendChild(head);\n\n\t    // capture mouse events in title bar\n\t    head.addEventListener('mousedown',window_mouse_down,false);\n\n\t    // div to hold the content\n\t    //var body = document.createElement('div');\n\t    //body.appendChild(content);\n\t    win.appendChild(content);\n\t    content.win = win;   // so content can contact us\n\n\t    // compute location relative to canvas\n\t    if (offset == undefined) offset = 0;\n\t    win.left = this.canvas.mouse_x + offset;\n\t    win.top = this.canvas.mouse_y + offset;\n\n\t    // add to DOM\n\t    win.style.background = 'white';\n\t    win.style.position = 'absolute';\n\t    win.style.left = win.left + 'px';\n\t    win.style.top = win.top + 'px';\n\t    win.style.border = '2px solid';\n\n\t    this.canvas.parentNode.insertBefore(win,this.canvas);\n\t    bring_to_front(win,true);\n\t}\n\n\t// adjust zIndex of pop-up window so that it is in front\n\tfunction bring_to_front(win,insert) {\n\t    var wlist = win.sch.window_list;\n\t    var i = wlist.indexOf(win);\n\n\t    // remove from current position (if any) in window list\n\t    if (i != -1) wlist.splice(i,1);\n\n\t    // if requested, add to end of window list\n\t    if (insert) wlist.push(win);\n\n\t    // adjust all zIndex values\n\t    for (i = 0; i < wlist.length; i += 1)\n\t\twlist[i].style.zIndex = 1000 + i;\n\t}\n\n\t// close the window\n\tfunction window_close(win) {\n\t    // remove the window from the top-level div of the schematic\n\t    win.parentNode.removeChild(win);\n\n\t    // remove from list of pop-up windows\n\t    bring_to_front(win,false);\n\t}\n\n\tfunction window_close_button(event) {\n\t    if (!event) event = window.event;\n\t    var src = (window.event) ? event.srcElement : event.target;\n\t    window_close(src.win);\n\t}\n\n\t// capture mouse events in title bar of window\n\tfunction window_mouse_down(event) {\n\t    if (!event) event = window.event;\n\t    var src = (window.event) ? event.srcElement : event.target;\n\t    var win = src.win;\n\n\t    bring_to_front(win,true);\n\n\t    // add handlers to document so we capture them no matter what\n\t    document.addEventListener('mousemove',window_mouse_move,false);\n\t    document.addEventListener('mouseup',window_mouse_up,false);\n\t    document.tracking_window = win;\n\n\t    // remember where mouse is so we can compute dx,dy during drag\n\t    win.drag_x = event.pageX;\n\t    win.drag_y = event.pageY;\n\n\t    return false;\n\t}\n\n\tfunction window_mouse_up(event) {\n\t    var win = document.tracking_window;\n\n\t    // show's over folks...\n\t    document.removeEventListener('mousemove',window_mouse_move,false);\n\t    document.removeEventListener('mouseup',window_mouse_up,false);\n\t    document.tracking_window = undefined;\n\t    win.drag_x = undefined;\n\t    win.drag_y = undefined;\n\t    return true;  // consume event\n\t}\n\n\tfunction window_mouse_move(event) {\n\t    var win = document.tracking_window;\n\n\t    if (win.drag_x) {\n\t\tvar dx = event.pageX - win.drag_x;\n\t\tvar dy = event.pageY - win.drag_y;\n\n\t\t// move the window\n\t\twin.left += dx;\n\t\twin.top += dy;\n\t\twin.style.left = win.left + 'px';\n\t\twin.style.top = win.top + 'px';\n\n\t\t// update reference point\n\t\twin.drag_x += dx;\n\t\twin.drag_y += dy;\n\n\t\treturn true;  // consume event\n\t    }\n\t}\n\n\t///////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Toolbar\n\t//\n\t////////////////////////////////////////////////////////////////////////////////\n\n\tSchematic.prototype.add_tool = function(icon,tip,callback) {\n\t    var tool, child, label, hidden;\n\n        tool = document.createElement('button');\n        child = document.createElement('img');\n        label = document.createElement('span');\n        hidden = document.createElement('span');\n\n        tool.style.backgroundImage = 'none';\n        tool.setAttribute('title', tip);\n        label.innerHTML = tip;\n        label.classList.add('sr');\n        hidden.setAttribute('aria-hidden', 'true');\n\n\t    if (icon.search('data:image') != -1) {\n            child.setAttribute('src', icon);\n            child.setAttribute('alt', '');\n            tool.appendChild(child);\n\t    } else {\n            tool.style.font = 'small-caps small sans-serif';\n            hidden.innerHTML = icon;\n            tool.appendChild(hidden);\n            tool.appendChild(label);\n\t    }\n\n\t    // decorate tool\n        tool.style.height = '32px';\n        tool.style.width = 'auto';\n        tool.style.verticalAlign = 'top';\n\n\t    // set up event processing\n\t    tool.addEventListener('mouseover',tool_enter,false);\n\t    tool.addEventListener('mouseout',tool_leave,false);\n\t    tool.addEventListener('click',tool_click,false);\n\n\t    // add to toolbar\n\t    tool.sch = this;\n\t    tool.tip = tip;\n\t    tool.callback = callback;\n\t    this.toolbar.push(tool);\n\n\t    tool.enabled = false;\n\n\t    return tool;\n\t}\n\n\tSchematic.prototype.enable_tool = function(tname,which) {\n\t    var tool = this.tools[tname];\n\n\t    if (tool != undefined) {\n        tool.removeAttribute('disabled');\n\t\ttool.enabled = which;\n\n\t\t// if disabling tool, remove border and tip\n\t\tif (!which) {\n\t\t    tool.sch.message('');\n            tool.setAttribute('disabled', 'true');\n\t\t}\n\t    }\n\t}\n\n\t// highlight tool button by turning on border, changing background\n\tfunction tool_enter(event) {\n\t    if (!event) event = window.event;\n        var tool = event.target;\n        if (event.target.tagName.toLowerCase() == 'img' || event.target.tagName.toLowerCase() == 'span') {\n            tool = event.target.parentNode;\n        }\n        if (tool.enabled) {\n\t\ttool.sch.message(tool.tip);\n\t    }\n        event.stopPropagation();\n\t}\n\n\t// unhighlight tool button by turning off border, reverting to normal background\n\tfunction tool_leave(event) {\n\t    if (!event) event = window.event;\n        var tool = event.target;\n        if (event.target.tagName.toLowerCase() == 'img' || event.target.tagName.toLowerCase() == 'span') {\n            tool = event.target.parentNode;\n        }\n\t    if (tool.enabled) {\n\t\ttool.sch.message('');\n\t    }\n        event.stopPropagation();\n\t}\n\n\t// handle click on a tool\n\tfunction tool_click(event) {\n\t    if (!event) event = window.event;\n        var tool = event.target;\n        if (event.target.tagName.toLowerCase() == 'img' || event.target.tagName.toLowerCase() == 'span') {\n            tool = event.target.parentNode;\n        }\n\t    if (tool.enabled) {\n\t\ttool.sch.canvas.relMouseCoords(event);  // so we can position pop-up window correctly\n\t\ttool.callback.call(tool.sch);\n\t    }\n        event.stopPropagation();\n\t}\n\n\tvar help_icon = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAABgFBMVEUARMwAZsz///8AM5kGqP+s1/8AeuARp/8AZ803qPsAXNYAdNwAZcxZuv9auf99xv8AdNoEd9uTzP8AYsgAivQTl/cAj/V9xf8Ad90AeN5PtP8AUMoAj/oRiOgprf84qfwAb9UAifAAdtwAf+UAgOYActgAk/oAie8cqP8AbtQAXtkXof8AatBNuP8AbdMAgukXcOEAXdcAlP0AhuwJmv0prv8YceGCyP8AbtUAZd8elvMAZcsAW9Ucpv8AjfM3sP8AiO4AWdNOuP8AddsPgeIAhOoAbdT///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABH5RCxAAAASHRSTlP//////////////////////////////////////////////////////////////////////////////////////////////wCc7PJgAAAAAWJLR0R/SL9x5QAAAAlwSFlzAAAASAAAAEgARslrPgAAAAl2cEFnAAAAEAAAABAAXMatwwAAAK5JREFUGNM1zwcOwjAMBVAHQ9PFbIG27L333pve/0bEBr5kyf9JkWIIKYLDK3CNcZgUiE0QFIuuu89kBIHIDy5TUOmXSknBsFxDRAXMJ4FIZOeqA41lxQVB+w/1L9RyO+B+fLwJ7q/OOUfd9FvDkQJDmyyuoLqWGtsVBq3RnAHcUlXbNgSEWPY8n570dH2F6h94Sqe3BAdd7xKEKKVTACg4UuL3OMQoB/F3LRGF1w/Arhm2Q9w2ZQAAACV0RVh0Y3JlYXRlLWRhdGUAMjAwOC0xMC0yM1QxMTo1ODozNiswODowMKkTWd4AAAAldEVYdG1vZGlmeS1kYXRlADIwMDgtMTAtMjNUMTE6NTk6NTArMDg6MDC833hpAAAAAElFTkSuQmCC';\n\n\tvar cut_icon = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH1QocFh0xaEFkXgAAArRJREFUOMuFk11Ik1EYx59z3nevr9vUfaXbbPgVaHjRVRB0YZRJV0XeZCIRaGmWWKhpgZAElaV9gYgQlBjoEPRKkCS6DAK1MG0zNvJj7zZ1m+51X+92zttNzmFa5+78/w8//s/znIMg5TzrfXIOAN7zPO9tunm7dI/Xz7LspTvNrbpUHadeGIYZu9XYrI1Go8t9/a87Uz0Fq7hw5nS55sWrnk8HAggh/E+HHdfV1lcQQo7t6E97HpeZc82m7ZCIKKUnDgRgjENLS7+AT0tDsVisdCcFy7JThYWF4HF7KKXU8a8EFTabDVZdK6iutr44kUic6nnePVBSUqJAgMHhdAAAWA8E3G299xljvLy4aAc+jUeSJB3X6/TXZAqwvrFGAWCiraXj4YEAAABKaeXCjwV5bc0DjTeaVPFEHIliEObm5iQA6Npb/xegraVjGmM8ZF+00WBwC2s0GhDcgizL8ru2lo7p/wL+pJianZnGTqcD0jkeMt8ORhBCb/arRXuFMaOxl1B6Pb65qSblZTIz+REVGHNAIHQLITRQ6fG07wsYM5k6437/g6MmEyQoRd6tTdkX3h5mZVRVkJ3D8BxHJVkG5/o6KLKyrla63UPJFsbN5hrJ5+sqNhrpwsrKVDASlgJBEdfEaU2UIzqWwTQQEhOO1dUPR/R6EvP5BsfN5t2XOmowCPNFRWSEYe4DAMxYLCGrUpnY8UcYhnzJNQcBAIYxbv+Wn09GDQZhd4ixmF6SJFJFyKMJleqlgmV5hLE9OWmOm1Hz6arJjIy+y5R2gyxTIMSwC+A4Qa1UMl/z8mImna5pXhC8iszMK8mPpNU2fHe5Ng4fOtQwa7HECKUYMA4AADAAANVarc/l95/0SxIbAJA5tfrsRUFI7twqiu7q7GyPNxDI8YfDGl8k4lOoVOetouj+DaDzOgfcNME8AAAAAElFTkSuQmCC';\n\n\tvar copy_icon = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAAsSAAALEgHS3X78AAAAd0lEQVQ4y9WTsQ7AIAhE7wj//69dHKWLJqSlFOtUFpXA8SAIbBrHaR9yAAA6L2bvGiRvPtltQa+OqMrFPCo1jFhoRytBmXgqUCH5GUEkWCbova8TeBORfBNJVpYIrbVJdwDjY5hjJfk4vFnAzMDxiEqmo/fJAHACspMyA7UYnWgAAAAASUVORK5CYII=';\n\n\tvar paste_icon = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAAsSAAALEgHS3X78AAABZElEQVQ4y6WSMUsDMRiGn6RteoJSENS5oCdFR3+D0MHBciA4uujiVrq0o1NBcBEEFycXRzcnf4GDINTiL7BTr9LeJdfGoaX0ei21+MFHAsn7fG9eAjOqXCwoz/NKgAWs53mlcrGgZt0VE3s7fdhsfgHguttztTHA5+0ZjUaDzdM7HEeRy60C0G7/EASa78cLXNelcPkw1qYnkVprfN/n+6aEUgqlFFJKjDForclms2itYzZigH6/Tz6fp9PpAFC8fp3h/J2rw42P2ksLADkNMMbgOA6O4wzfZW2sAWovrb3janUn4cAYgzGGRWWtRQjRPKpUdmOAKIrGgCiK5gKEGGb/XK9/JhwEQUC32yUMw7nTJ0ExQK/Xw/d9BoPBeMqiigHCMEQIQSqV+pM4AbCAXEKcAGAtKSn/AYCE/UVZpIEVYA1ASkkmkxl/mqfzg5ExG1tP7t8AtoAOwDqwP4pgmd4H1n8B+QWeF/d+HLAAAAAASUVORK5CYII=';\n\n\tvar close_icon = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAACOUlEQVR42m2TzWtTQRTF30ysxE9E0VZKaapBa1OJxtRAW7XVGOrCKijFIEqXbgQFwf/BTReia7GUuBEUF5Y2YiMKKn6iKEqRom1DtAsjStGaGX9v3iQ+Y4Z35t6ZOfe8uXdmhFPVDqRSktYvpBzAxphaBQpKqSdalTLYO7fHxnWZL/zBfclkWAbksBBip7cmHEGvDd3raFlVUoOj2Wz+H4H9vT0RGQhMMLHGkxaienduuJV6p0ql5PjdiRlD2rurO0jwM9zWWnG1dPhyWql9ht3T1XmKwEtAaLNVMUT3AFyBsAz7g9lBbBc4+zcb54joTnQIKeRDZjrcvyNQxG9A5Bd2NwIZ+Gn8e2AxmHNFbTbXRWc8FoRcJLjObtDtbjB3DLtALZbws3l8d/0aOOzLZlYktkfX4eS9epuiehlqZ+TRi5cny8zEtuhVVo/7eabW8a2RFdivwlbPbu079uDT129yZYEd7W17oNzCXe4rdFHE2lrd0SRosbX5TXAK5EAd5NPYi9gF0AtGwSIrcN9IRTeFLxB8zp7RPAExMAUxAw7h3wRpdh+SQjzHBm0KZ4xA+8aWRgivzLU16TvuLZsB8UqyjvMYNDOu98rgfEQ8UklmS6hpQCs9ghuwdShfSKF9Ezb/n5x939upT7mKwOamRogqjchlhit9R+XbhGlfeGgn3k/Pjv33mNwWXl8f4sWdJ+Yow9W+JTetYSkDQ5P5wuear7HcNjSs5Upqd60ZLAXfwPSHwpyu5v4BhpTicEl0i9QAAAAASUVORK5CYII=';\n\n\tvar grid_icon = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAAsSAAALEgHS3X78AAAAMklEQVQ4y2NkYGD4z0ABYGFgYGD4/x/VDEZGRqLFmCixnYGBYRAYwMgwGoijgTgsAhEAq84fH/l+ELYAAAAASUVORK5CYII=';\n\n\t///////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Graphing\n\t//\n\t///////////////////////////////////////////////////////////////////////////////\n\n\t// add dashed lines!\n\t// from http://davidowens.wordpress.com/2010/09/07/html-5-canvas-and-dashed-lines/\n\ttry {\n\t\tif (CanvasRenderingContext2D)\n\t\t\tCanvasRenderingContext2D.prototype.dashedLineTo = function(fromX, fromY, toX, toY, pattern) {\n\t\t\t    // Our growth rate for our line can be one of the following:\n\t\t\t    //   (+,+), (+,-), (-,+), (-,-)\n\t\t\t    // Because of this, our algorithm needs to understand if the x-coord and\n\t\t\t    // y-coord should be getting smaller or larger and properly cap the values\n\t\t\t    // based on (x,y).\n\t\t\t    var lt = function (a, b) { return a <= b; };\n\t\t\t    var gt = function (a, b) { return a >= b; };\n\t\t\t    var capmin = function (a, b) { return Math.min(a, b); };\n\t\t\t    var capmax = function (a, b) { return Math.max(a, b); };\n\t\t\t    var checkX = { thereYet: gt, cap: capmin };\n\t\t\t    var checkY = { thereYet: gt, cap: capmin };\n\n\t\t\t    if (fromY - toY > 0) {\n\t\t\t\tcheckY.thereYet = lt;\n\t\t\t\tcheckY.cap = capmax;\n\t\t\t    }\n\t\t\t    if (fromX - toX > 0) {\n\t\t\t\tcheckX.thereYet = lt;\n\t\t\t\tcheckX.cap = capmax;\n\t\t\t    }\n\n\t\t\t    this.moveTo(fromX, fromY);\n\t\t\t    var offsetX = fromX;\n\t\t\t    var offsetY = fromY;\n\t\t\t    var idx = 0, dash = true;\n\t\t\t    while (!(checkX.thereYet(offsetX, toX) && checkY.thereYet(offsetY, toY))) {\n\t\t\t\tvar ang = Math.atan2(toY - fromY, toX - fromX);\n\t\t\t\tvar len = pattern[idx];\n\n\t\t\t\toffsetX = checkX.cap(toX, offsetX + (Math.cos(ang) * len));\n\t\t\t\toffsetY = checkY.cap(toY, offsetY + (Math.sin(ang) * len));\n\n\t\t\t\tif (dash) this.lineTo(offsetX, offsetY);\n\t\t\t\telse this.moveTo(offsetX, offsetY);\n\n\t\t\t\tidx = (idx + 1) % pattern.length;\n\t\t\t\tdash = !dash;\n\t\t\t    }\n\t\t\t};\n\t}\n\tcatch (err) { //noop\n\t}\n\t// given a range of values, return a new range [vmin',vmax'] where the limits\n\t// have been chosen \"nicely\".  Taken from matplotlib.ticker.LinearLocator\n\tfunction view_limits(vmin,vmax) {\n\t    // deal with degenerate case...\n\t    if (vmin == vmax) {\n\t\tif (vmin == 0) { vmin = -0.5; vmax = 0.5; }\n\t\telse {\n\t\t    vmin = vmin > 0 ? 0.9*vmin : 1.1*vmin;\n\t\t    vmax = vmax > 0 ? 1.1*vmax : 0.9*vmax;\n\t\t}\n\t    }\n\n\t    var log_range = Math.log(vmax - vmin)/Math.LN10;\n\t    var exponent = Math.floor(log_range);\n\t    //if (log_range - exponent < 0.5) exponent -= 1;\n\t    var scale = Math.pow(10,-exponent);\n\t    vmin = Math.floor(scale*vmin)/scale;\n\t    vmax = Math.ceil(scale*vmax)/scale;\n\n\t    return [vmin,vmax,1.0/scale];\n\t}\n\n\tfunction engineering_notation(n,nplaces,trim) {\n\t    if (n == 0) return '0';\n\t    if (n == undefined) return 'undefined';\n\t    if (trim == undefined) trim = true;\n\n\t    var sign = n < 0 ? -1 : 1;\n\t    var log10 = Math.log(sign*n)/Math.LN10;\n\t    var exp = Math.floor(log10/3);   // powers of 1000\n\t    var mantissa = sign*Math.pow(10,log10 - 3*exp);\n\n\t    // keep specified number of places following decimal point\n\t    var mstring = (mantissa + sign*0.5*Math.pow(10,-nplaces)).toString();\n\t    var mlen = mstring.length;\n\t    var endindex = mstring.indexOf('.');\n\t    if (endindex != -1) {\n\t\tif (nplaces > 0) {\n\t\t    endindex += nplaces + 1;\n\t\t    if (endindex > mlen) endindex = mlen;\n\t\t    if (trim) {\n\t\t\twhile (mstring.charAt(endindex-1) == '0') endindex -= 1;\n\t\t\tif (mstring.charAt(endindex-1) == '.') endindex -= 1;\n\t\t    }\n\t\t}\n\t\tif (endindex < mlen)\n\t\t    mstring = mstring.substring(0,endindex);\n\t    }\n\n\t    switch(exp) {\n\t    case -5:\treturn mstring+\"f\";\n\t    case -4:\treturn mstring+\"p\";\n\t    case -3:\treturn mstring+\"n\";\n\t    case -2:\treturn mstring+\"u\";\n\t    case -1:\treturn mstring+\"m\";\n\t    case 0:\treturn mstring;\n\t    case 1:\treturn mstring+\"K\";\n\t    case 2:\treturn mstring+\"M\";\n\t    case 3:\treturn mstring+\"G\";\n\t    }\n\n\t    // don't have a good suffix, so just print the number\n\t    return n.toString();\n\t}\n\n\tvar grid_pattern = [1,2];\n\tvar cursor_pattern = [5,5];\n\n\t// x_values is an array of x coordinates for each of the plots\n\t// y_values is an array of [color, value_array], one entry for each plot on left vertical axis\n\t// z_values is an array of [color, value_array], one entry for each plot on right vertical axis\n\tSchematic.prototype.graph = function(x_values,x_legend,y_values,y_legend,z_values,z_legend) {\n\t    var pwidth = 400;\t// dimensions of actual plot\n\t    var pheight = 300;\t// dimensions of actual plot\n\t    var left_margin = (y_values != undefined && y_values.length > 0) ? 55 : 25;\n\t    var top_margin = 25;\n\t    var right_margin = (z_values != undefined && z_values.length > 0) ? 55 : 25;\n\t    var bottom_margin = 45;\n\t    var tick_length = 5;\n\n\t    var w = pwidth + left_margin + right_margin;\n\t    var h = pheight + top_margin + bottom_margin;\n\n\t    var canvas = document.createElement('canvas');\n\t    canvas.width = w;\n\t    canvas.height = h;\n\n\t    // the graph itself will be drawn here and this image will be copied\n\t    // onto canvas, where it can be overlayed with mouse cursors, etc.\n\t    var bg_image = document.createElement('canvas');\n\t    bg_image.width = w;\n\t    bg_image.height = h;\n\t    canvas.bg_image = bg_image;\t// so we can find it during event handling\n\n\t    // start by painting an opaque background\n\t    var c = bg_image.getContext('2d');\n\t    c.fillStyle = background_style;\n\t    c.fillRect(0,0,w,h);\n\t    c.fillStyle = element_style;\n\t    c.fillRect(left_margin,top_margin,pwidth,pheight);\n\n\t    // figure out scaling for plots\n\t    var x_min = array_min(x_values);\n\t    var x_max = array_max(x_values);\n\t    var x_limits = view_limits(x_min,x_max);\n\t    x_min = x_limits[0];\n\t    x_max = x_limits[1];\n\t    var x_scale = pwidth/(x_max - x_min);\n\n\t    function plot_x(x) {\n\t\treturn (x - x_min)*x_scale + left_margin;\n\t    }\n\n\t    // draw x grid\n\t    c.strokeStyle = grid_style;\n\t    c.lineWidth = 1;\n\t    c.fillStyle = normal_style;\n\t    c.font = '10pt sans-serif';\n\t    c.textAlign = 'center';\n\t    c.textBaseline = 'top';\n\t    var end = top_margin + pheight;\n\t    for (var x = x_min; x <= x_max; x += x_limits[2]) {\n\t\tvar temp = plot_x(x) + 0.5;  // keep lines crisp!\n\n\t\t// grid line\n\t\tc.beginPath();\n\t\tif (x == x_min) {\n\t\t    c.moveTo(temp,top_margin);\n\t\t    c.lineTo(temp,end);\n\t\t} else\n\t\t    c.dashedLineTo(temp,top_margin,temp,end,grid_pattern);\n\t\tc.stroke();\n\n\t\t// tick mark\n\t\tc.beginPath();\n\t\tc.moveTo(temp,end);\n\t\tc.lineTo(temp,end + tick_length);\n\t\tc.stroke();\n\t\tc.fillText(engineering_notation(x,2),temp,end + tick_length);\n\t    }\n\n\t    if (y_values != undefined && y_values.length > 0) {\n\t\tvar y_min = Infinity;\n\t\tvar y_max = -Infinity;\n\t\tvar plot;\n\t\tfor (plot = y_values.length - 1; plot >= 0; --plot) {\n\t\t    var values = y_values[plot][2];\n\t\t    if (values == undefined) continue;  // no data points\n\t\t    var offset = y_values[plot][1];\n\t\t    var temp = array_min(values) + offset;\n\t\t    if (temp < y_min) y_min = temp;\n\t\t    temp = array_max(values) + offset;\n\t\t    if (temp > y_max) y_max = temp;\n\t\t}\n\t\tvar y_limits = view_limits(y_min,y_max);\n\t\ty_min = y_limits[0];\n\t\ty_max = y_limits[1];\n\t\tvar y_scale = pheight/(y_max - y_min);\n\n\t\tfunction plot_y(y) {\n\t\t    return (y_max - y)*y_scale + top_margin;\n\t\t}\n\n\t\t// draw y grid\n\t\tc.textAlign = 'right';\n\t\tc.textBaseline = 'middle';\n\t\tfor (var y = y_min; y <= y_max; y += y_limits[2]) {\n\t\t    if (Math.abs(y/y_max) < 0.001) y = 0.0; // Just 3 digits\n\t\t    var temp = plot_y(y) + 0.5;  // keep lines crisp!\n\n\t\t    // grid line\n\t\t    c.beginPath();\n\t\t    if (y == y_min) {\n\t\t\tc.moveTo(left_margin,temp);\n\t\t\tc.lineTo(left_margin + pwidth,temp);\n\t\t    } else\n\t\t\tc.dashedLineTo(left_margin,temp,left_margin + pwidth,temp,grid_pattern);\n\t\t    c.stroke();\n\n\t\t    // tick mark\n\t\t    c.beginPath();\n\t\t    c.moveTo(left_margin - tick_length,temp);\n\t\t    c.lineTo(left_margin,temp);\n\t\t    c.stroke();\n\t\t    c.fillText(engineering_notation(y,2),left_margin - tick_length -2,temp);\n\t\t}\n\n\t\t// now draw each plot\n\t\tvar x,y;\n\t\tvar nx,ny;\n\t\tc.lineWidth = 3;\n\t\tc.lineCap = 'round';\n\t\tfor (plot = y_values.length - 1; plot >= 0; --plot) {\n\t\t    var color = probe_colors_rgb[y_values[plot][0]];\n\t\t    if (color == undefined) continue;  // no plot color (== x-axis)\n\t\t    c.strokeStyle = color;\n\t\t    var values = y_values[plot][2];\n\t\t    if (values == undefined) continue;  // no data points\n\t\t    var offset = y_values[plot][1];\n\n\t\t    x = plot_x(x_values[0]);\n\t\t    y = plot_y(values[0] + offset);\n\t\t    c.beginPath();\n\t\t    c.moveTo(x,y);\n\t\t    for (var i = 1; i < x_values.length; i++) {\n\t\t\tnx = plot_x(x_values[i]);\n\t\t\tny = plot_y(values[i] + offset);\n\t\t\tc.lineTo(nx,ny);\n\t\t\tx = nx;\n\t\t\ty = ny;\n\t\t\tif (i % 100 == 99) {\n\t\t\t    // too many lineTo's cause canvas to break\n\t\t\t    c.stroke();\n\t\t\t    c.beginPath();\n\t\t\t    c.moveTo(x,y);\n\t\t\t}\n\t\t    }\n\t\t    c.stroke();\n\t\t}\n\t    }\n\n\t    if (z_values != undefined && z_values.length > 0) {\n\t\tvar z_min = Infinity;\n\t\tvar z_max = -Infinity;\n\t\tfor (plot = z_values.length - 1; plot >= 0; --plot) {\n\t\t    var values = z_values[plot][2];\n\t\t    if (values == undefined) continue;  // no data points\n\t\t    var offset = z_values[plot][1];\n\t\t    var temp = array_min(values) + offset;\n\t\t    if (temp < z_min) z_min = temp;\n\t\t    temp = array_max(values) + offset;\n\t\t    if (temp > z_max) z_max = temp;\n\t\t}\n\t\tvar z_limits = view_limits(z_min,z_max);\n\t\tz_min = z_limits[0];\n\t\tz_max = z_limits[1];\n\t\tvar z_scale = pheight/(z_max - z_min);\n\n\t\tfunction plot_z(z) {\n\t\t    return (z_max - z)*z_scale + top_margin;\n\t\t}\n\n\t\t// draw z ticks\n\t\tc.textAlign = 'left';\n\t\tc.textBaseline = 'middle';\n\t\tc.lineWidth = 1;\n\t\tc.strokeStyle = normal_style;\n\t\tvar tick_length_half = Math.floor(tick_length/2);\n\t\tvar tick_delta = tick_length - tick_length_half;\n\t\tfor (var z = z_min; z <= z_max; z += z_limits[2]) {\n\t\t    if (Math.abs(z/z_max) < 0.001) z = 0.0; // Just 3 digits\n\t\t    var temp = plot_z(z) + 0.5;  // keep lines crisp!\n\n\t\t    // tick mark\n\t\t    c.beginPath();\n\t\t    c.moveTo(left_margin + pwidth - tick_length_half,temp);\n\t\t    c.lineTo(left_margin + pwidth + tick_delta,temp);\n\t\t    c.stroke();\n\t\t    c.fillText(engineering_notation(z,2),left_margin + pwidth + tick_length + 2,temp);\n\t\t}\n\n\t\tvar z;\n\t\tvar nz;\n\t\tc.lineWidth = 3;\n\t\tfor (plot = z_values.length - 1; plot >= 0; --plot) {\n\t\t    var color = probe_colors_rgb[z_values[plot][0]];\n\t\t    if (color == undefined) continue;  // no plot color (== x-axis)\n\t\t    c.strokeStyle = color;\n\t\t    var values = z_values[plot][2];\n\t\t    if (values == undefined) continue;  // no data points\n\t\t    var offset = z_values[plot][1];\n\n\t\t    x = plot_x(x_values[0]);\n\t\t    z = plot_z(values[0] + offset);\n\t\t    c.beginPath();\n\t\t    c.moveTo(x,z);\n\t\t    for (var i = 1; i < x_values.length; i++) {\n\t\t\tnx = plot_x(x_values[i]);\n\t\t\tnz = plot_z(values[i] + offset);\n\t\t\tc.lineTo(nx,nz);\n\t\t\tx = nx;\n\t\t\tz = nz;\n\t\t\tif (i % 100 == 99) {\n\t\t\t    // too many lineTo's cause canvas to break\n\t\t\t    c.stroke();\n\t\t\t    c.beginPath();\n\t\t\t    c.moveTo(x,z);\n\t\t\t}\n\t\t    }\n\t\t    c.stroke();\n\t\t}\n\t    }\n\n\t    // draw legends\n\t    c.font = '12pt sans-serif';\n\t    c.textAlign = 'center';\n\t    c.textBaseline = 'bottom';\n\t    c.fillText(x_legend,left_margin + pwidth/2,h - 5);\n\n\t    if (y_values != undefined && y_values.length > 0) {\n\t\tc.textBaseline = 'top';\n\t\tc.save();\n\t\tc.translate(5 ,top_margin + pheight/2);\n\t\tc.rotate(-Math.PI/2);\n\t\tc.fillText(y_legend,0,0);\n\t\tc.restore();\n\t    }\n\n\t    if (z_values != undefined && z_values.length > 0) {\n\t\tc.textBaseline = 'bottom';\n\t\tc.save();\n\t\tc.translate(w-5 ,top_margin + pheight/2);\n\t\tc.rotate(-Math.PI/2);\n\t\tc.fillText(z_legend,0,0);\n\t\tc.restore();\n\t    }\n\n\t    // save info need for interactions with the graph\n\t    canvas.x_values = x_values;\n\t    canvas.y_values = y_values;\n\t    canvas.z_values = z_values;\n\t    canvas.x_legend = x_legend;\n\t    canvas.y_legend = y_legend;\n\t    canvas.z_legend = y_legend;\n\t    canvas.x_min = x_min;\n\t    canvas.x_scale = x_scale;\n\t    canvas.y_min = y_min;\n\t    canvas.y_scale = y_scale;\n\t    canvas.z_min = z_min;\n\t    canvas.z_scale = z_scale;\n\t    canvas.left_margin = left_margin;\n\t    canvas.top_margin = top_margin;\n\t    canvas.pwidth = pwidth;\n\t    canvas.pheight = pheight;\n\t    canvas.tick_length = tick_length;\n\n\t    canvas.cursor1_x = undefined;\n\t    canvas.cursor2_x = undefined;\n\t    canvas.sch = this;\n\n\t    // do something useful when user mouses over graph\n\t    canvas.addEventListener('mousemove',graph_mouse_move,false);\n\n\t    // return our masterpiece\n\t    redraw_plot(canvas);\n\t    return canvas;\n\t}\n\n\tfunction array_max(a) {\n        var max = -Infinity;\n\t    for (var i = a.length - 1; i >= 0; --i)\n\t\tif (a[i] > max) max = a[i];\n\t    return max;\n\t}\n\n\tfunction array_min(a) {\n        var min = Infinity;\n\t    for (var i = a.length - 1; i >= 0; --i)\n\t\tif (a[i] < min) min = a[i];\n\t    return min;\n\t}\n\n\tfunction plot_cursor(c,graph,cursor_x,left_margin) {\n\t    // draw dashed vertical marker that follows mouse\n\t    var x = graph.left_margin + cursor_x;\n\t    var end_y = graph.top_margin + graph.pheight + graph.tick_length;\n\t    c.strokeStyle = grid_style;\n\t    c.lineWidth = 1;\n\t    c.beginPath();\n\t    c.dashedLineTo(x,graph.top_margin,x,end_y,cursor_pattern);\n\t    c.stroke();\n\n\t    // add x label at bottom of marker\n\t    var graph_x = cursor_x/graph.x_scale + graph.x_min;\n\t    c.font = '10pt sans-serif';\n\t    c.textAlign = 'center';\n\t    c.textBaseline = 'top';\n\t    c.fillStyle = background_style;\n\t    c.fillText('\\u2588\\u2588\\u2588\\u2588\\u2588',x,end_y);\n\t    c.fillStyle = normal_style;\n\t    c.fillText(engineering_notation(graph_x,3,false),x,end_y);\n\n\t    // compute which points marker is between\n\t    var x_values = graph.x_values;\n\t    var len = x_values.length;\n\t    var index = 0;\n\t    while (index < len && graph_x >= x_values[index]) index += 1;\n\t    var x1 = (index == 0) ? x_values[0] : x_values[index-1];\n\t    var x2 = x_values[index];\n\n\t    if (x2 != undefined) {\n\t\t// for each plot, interpolate and output value at intersection with marker\n\t\tc.textAlign = 'left';\n\t\tvar tx = graph.left_margin + left_margin;\n\t\tvar ty = graph.top_margin;\n\t\tif (graph.y_values != undefined) {\n\t\t    for (var plot = 0; plot < graph.y_values.length; plot++) {\n\t\t\tvar values = graph.y_values[plot][2];\n\t\t\tvar color = probe_colors_rgb[graph.y_values[plot][0]];\n\t\t\tif (values == undefined || color == undefined) continue;  // no data points or x-axis\n\n\t\t\t// interpolate signal value at graph_x using values[index-1] and values[index]\n\t\t\tvar y1 = (index == 0) ? values[0] : values[index-1];\n\t\t\tvar y2 = values[index];\n\t\t\tvar y = y1;\n\t\t\tif (graph_x != x1) y += (graph_x - x1)*(y2 - y1)/(x2 - x1);\n\n\t\t\t// annotate plot with value of signal at marker\n\t\t\tc.fillStyle = element_style;\n\t\t\tc.fillText('\\u2588\\u2588\\u2588\\u2588\\u2588',tx-3,ty);\n\t\t\tc.fillStyle = color;\n\t\t\tc.fillText(engineering_notation(y,3,false),tx,ty);\n\t\t\tty += 14;\n\t\t    }\n\t\t}\n\n\t\tc.textAlign = 'right';\n\t\tif (graph.z_values != undefined) {\n\t\t    var tx = graph.left_margin + graph.pwidth - left_margin;\n\t\t    var ty = graph.top_margin;\n\t\t    for (var plot = 0; plot < graph.z_values.length; plot++) {\n\t\t\tvar values = graph.z_values[plot][2];\n\t\t\tvar color = probe_colors_rgb[graph.z_values[plot][0]];\n\t\t\tif (values == undefined || color == undefined) continue;  // no data points or x-axis\n\n\t\t\t// interpolate signal value at graph_x using values[index-1] and values[index]\n\t\t\tvar z1 = (index == 0) ? values[0]: values[index-1];\n\t\t\tvar z2 = values[index];\n\t\t\tvar z = z1;\n\t\t\tif (graph_x != x1) z += (graph_x - x1)*(z2 - z1)/(x2 - x1);\n\n\t\t\t// annotate plot with value of signal at marker\n\t\t\tc.fillStyle = element_style;\n\t\t\tc.fillText('\\u2588\\u2588\\u2588\\u2588\\u2588',tx+3,ty);\n\t\t\tc.fillStyle = color;\n\t\t\tc.fillText(engineering_notation(z,3,false),tx,ty);\n\t\t\tty += 14;\n\t\t    }\n\t\t}\n\t    }\n\t}\n\n\tfunction redraw_plot(graph) {\n\t    var c = graph.getContext('2d');\n\t    c.drawImage(graph.bg_image,0,0);\n\n\t    if (graph.cursor1_x != undefined) plot_cursor(c,graph,graph.cursor1_x,4);\n\t    if (graph.cursor2_x != undefined) plot_cursor(c,graph,graph.cursor2_x,30);\n\n\t    /*\n\t    if (graph.cursor1_x != undefined) {\n\t\t// draw dashed vertical marker that follows mouse\n\t\tvar x = graph.left_margin + graph.cursor1_x;\n\t\tvar end_y = graph.top_margin + graph.pheight + graph.tick_length;\n\t\tc.strokeStyle = grid_style;\n\t\tc.lineWidth = 1;\n\t\tc.beginPath();\n\t\tc.dashedLineTo(x,graph.top_margin,x,end_y,cursor_pattern);\n\t\tc.stroke();\n\n\t\t// add x label at bottom of marker\n\t\tvar graph_x = graph.cursor1_x/graph.x_scale + graph.x_min;\n\t\tc.font = '10pt sans-serif';\n\t\tc.textAlign = 'center';\n\t\tc.textBaseline = 'top';\n\t\tc.fillStyle = background_style;\n\t\tc.fillText('\\u2588\\u2588\\u2588\\u2588\\u2588',x,end_y);\n\t\tc.fillStyle = normal_style;\n\t\tc.fillText(engineering_notation(graph_x,3,false),x,end_y);\n\n\t\t// compute which points marker is between\n\t\tvar x_values = graph.x_values;\n\t\tvar len = x_values.length;\n\t\tvar index = 0;\n\t\twhile (index < len && graph_x >= x_values[index]) index += 1;\n\t\tvar x1 = (index == 0) ? x_values[0] : x_values[index-1];\n\t\tvar x2 = x_values[index];\n\n\t\tif (x2 != undefined) {\n\t\t    // for each plot, interpolate and output value at intersection with marker\n\t\t    c.textAlign = 'left';\n\t\t    var tx = graph.left_margin + 4;\n\t\t    var ty = graph.top_margin;\n\t\t    for (var plot = 0; plot < graph.y_values.length; plot++) {\n\t\t\tvar values = graph.y_values[plot][1];\n\n\t\t\t// interpolate signal value at graph_x using values[index-1] and values[index]\n\t\t\tvar y1 = (index == 0) ? values[0] : values[index-1];\n\t\t\tvar y2 = values[index];\n\t\t\tvar y = y1;\n\t\t\tif (graph_x != x1) y += (graph_x - x1)*(y2 - y1)/(x2 - x1);\n\n\t\t\t// annotate plot with value of signal at marker\n\t\t\tc.fillStyle = element_style;\n\t\t\tc.fillText('\\u2588\\u2588\\u2588\\u2588\\u2588',tx-3,ty);\n\t\t\tc.fillStyle = probe_colors_rgb[graph.y_values[plot][0]];\n\t\t\tc.fillText(engineering_notation(y,3,false),tx,ty);\n\t\t\tty += 14;\n\t\t    }\n\t\t}\n\t    }\n\t    */\n\t}\n\n\tfunction graph_mouse_move(event) {\n\t    if (!event) event = window.event;\n\t    var g = (window.event) ? event.srcElement : event.target;\n\n\t    g.relMouseCoords(event);\n\t    // not sure yet where the 3,-3 offset correction comes from (borders? padding?)\n\t    var gx = g.mouse_x - g.left_margin - 3;\n\t    var gy = g.pheight - (g.mouse_y - g.top_margin) + 3;\n\t    if (gx >= 0 && gx <= g.pwidth && gy >=0 && gy <= g.pheight) {\n\t\t//g.sch.message('button: '+event.button+', which: '+event.which);\n\t\tg.cursor1_x = gx;\n\t    } else {\n\t\tg.cursor1_x = undefined;\n\t\tg.cursor2_x = undefined;\n\t    }\n\n\t    redraw_plot(g);\n\t}\n\n\t///////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Parts bin\n\t//\n\t////////////////////////////////////////////////////////////////////////////////\n\n\t// one instance will be created for each part in the parts bin\n\tfunction Part(sch) {\n\t    this.sch = sch;\n\t    this.component = undefined;\n\t    this.selected = false;\n\n\t    // set up canvas\n\t    this.canvas = document.createElement('canvas');\n\t    this.canvas.style.borderStyle = 'solid';\n\t    this.canvas.style.borderWidth = '1px';\n\t    this.canvas.style.borderColor = background_style;\n\t    //this.canvas.style.position = 'absolute';\n\t    this.canvas.style.cursor = 'default';\n\t    this.canvas.height = part_w;\n\t    this.canvas.width = part_h;\n\t    this.canvas.part = this;\n\n\t    this.canvas.addEventListener('mouseover',part_enter,false);\n\t    this.canvas.addEventListener('mouseout',part_leave,false);\n\t    this.canvas.addEventListener('mousedown',part_mouse_down,false);\n\t    this.canvas.addEventListener('mouseup',part_mouse_up,false);\n\n\t    // make the part \"clickable\" by registering a dummy click handler\n\t    // this should make things work on the iPad\n\t    this.canvas.addEventListener('click',function(){},false);\n\t}\n\n\tPart.prototype.set_location = function(left,top) {\n\t    this.canvas.style.left = left + 'px';\n\t    this.canvas.style.top = top + 'px';\n\t}\n\n\tPart.prototype.right = function() {\n\t    return this.canvas.offsetLeft + this.canvas.offsetWidth;\n\t}\n\n\tPart.prototype.bottom = function() {\n\t    return this.canvas.offsetTop + this.canvas.offsetHeight;\n\t}\n\n\tPart.prototype.set_component = function(component,tip) {\n\t    component.sch = this;\n\t    this.component = component;\n\t    this.tip = tip;\n\n\t    // figure out scaling and centering of parts icon\n\t    var b = component.bounding_box;\n\t    var dx = b[2] - b[0];\n\t    var dy = b[3] - b[1];\n\t    this.scale = 0.8; //Math.min(part_w/(1.2*dx),part_h/(1.2*dy));\n\t    this.origin_x = b[0] + dx/2.0 - part_w/(2.0*this.scale);\n\t    this.origin_y = b[1] + dy/2.0 - part_h/(2.0*this.scale);\n\n\t    this.redraw();\n\t}\n\n\tPart.prototype.redraw = function(part) {\n\t    var c = this.canvas.getContext('2d');\n\n\t    // paint background color\n\t    c.fillStyle = this.selected ? selected_style : background_style;\n\t    c.fillRect(0,0,part_w,part_h);\n\n\t    if (this.component) this.component.draw(c);\n\t}\n\n\tPart.prototype.select = function(which) {\n\t    this.selected = which;\n\t    this.redraw();\n\t}\n\n\tPart.prototype.update_connection_point = function(cp,old_location) {\n\t    // no connection points in the parts bin\n\t}\n\n\tPart.prototype.moveTo = function(c,x,y) {\n\t    c.moveTo((x - this.origin_x) * this.scale,(y - this.origin_y) * this.scale);\n\t}\n\n\tPart.prototype.lineTo = function(c,x,y) {\n\t    c.lineTo((x - this.origin_x) * this.scale,(y - this.origin_y) * this.scale);\n\t}\n\n\tPart.prototype.draw_line = function(c,x1,y1,x2,y2,width) {\n\t    c.lineWidth = width*this.scale;\n\t    c.beginPath();\n\t    c.moveTo((x1 - this.origin_x) * this.scale,(y1 - this.origin_y) * this.scale);\n\t    c.lineTo((x2 - this.origin_x) * this.scale,(y2 - this.origin_y) * this.scale);\n\t    c.stroke();\n\t}\n\n\tPart.prototype.draw_arc = function(c,x,y,radius,start_radians,end_radians,anticlockwise,width,filled) {\n\t    c.lineWidth = width*this.scale;\n\t    c.beginPath();\n\t    c.arc((x - this.origin_x)*this.scale,(y - this.origin_y)*this.scale,radius*this.scale,\n\t\t  start_radians,end_radians,anticlockwise);\n\t    if (filled) c.fill();\n\t    else c.stroke();\n\t}\n\n\tPart.prototype.draw_text = function(c,text,x,y,size) {\n\t    // no text displayed for the parts icon\n\t}\n\n\tfunction part_enter(event) {\n\t    if (!event) event = window.event;\n\t    var canvas = (window.event) ? event.srcElement : event.target;\n\t    var part = canvas.part;\n\n\t    // avoid Chrome bug that changes to text cursor whenever\n\t    // drag starts.  We'll restore the default handler at\n\t    // the appropriate point so behavior in other parts of\n\t    // the document are unaffected.\n\t    //part.sch.saved_onselectstart = document.onselectstart;\n\t    //document.onselectstart = function () { return false; };\n\n\t    canvas.style.borderColor = normal_style;\n\t    part.sch.message(part.tip+': drag onto diagram to insert');\n\t    return false;\n\t}\n\n\tfunction part_leave(event) {\n\t    if (!event) event = window.event;\n\t    var canvas = (window.event) ? event.srcElement : event.target;\n\t    var part = canvas.part;\n\n\t    if (typeof part.sch.new_part == 'undefined') {\n\t\t// leaving with no part selected?  revert handler\n\t\t//document.onselectstart = part.sch.saved_onselectstart;\n\t    }\n\n\t    canvas.style.borderColor = background_style;\n\t    part.sch.message('');\n\t    return false;\n\t}\n\n\tfunction part_mouse_down(event) {\n\t    if (!event) event = window.event;\n\t    var part = (window.event) ? event.srcElement.part : event.target.part;\n\n\t    part.select(true);\n\t    part.sch.new_part = part;\n\t    return false;\n\t}\n\n\tfunction part_mouse_up(event) {\n\t    if (!event) event = window.event;\n\t    var part = (window.event) ? event.srcElement.part : event.target.part;\n\n\t    part.select(false);\n\t    part.sch.new_part = undefined;\n\t    return false;\n\t}\n\n\t////////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Rectangle helper functions\n\t//\n\t////////////////////////////////////////////////////////////////////////////////\n\n\t// rect is an array of the form [left,top,right,bottom]\n\n\t// ensure left < right, top < bottom\n\tfunction canonicalize(r) {\n\t    var temp;\n\n\t    // canonicalize bounding box\n\t    if (r[0] > r[2]) {\n\t\ttemp = r[0];\n\t\tr[0] = r[2];\n\t\tr[2] = temp;\n\t    }\n\t    if (r[1] > r[3]) {\n\t\ttemp = r[1];\n\t\tr[1] = r[3];\n\t\tr[3] = temp;\n\t    }\n\t}\n\n\tfunction between(x,x1,x2) {\n\t    return x1 <= x && x <= x2;\n\t}\n\n\tfunction inside(rect,x,y) {\n\t    return between(x,rect[0],rect[2]) && between(y,rect[1],rect[3]);\n\t}\n\n\t// only works for manhattan rectangles\n\tfunction intersect(r1,r2) {\n\t    // look for non-intersection, negate result\n\t    var result = !(r2[0] > r1[2] ||\n\t\t\t   r2[2] < r1[0] ||\n\t\t\t   r2[1] > r1[3] ||\n\t\t\t   r2[3] < r1[1]);\n\n\t    // if I try to return the above expression, javascript returns undefined!!!\n\t    return result;\n\t}\n\n\t////////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Component base class\n\t//\n\t////////////////////////////////////////////////////////////////////////////////\n\n\tfunction Component(type,x,y,rotation) {\n\t    this.sch = undefined;\n\t    this.type = type;\n\t    this.x = x;\n\t    this.y = y;\n\t    this.rotation = rotation;\n\t    this.selected = false;\n        this.properties = [];\n\t    this.bounding_box = [0,0,0,0];   // in device coords [left,top,right,bottom]\n\t    this.bbox = this.bounding_box;   // in absolute coords\n\t    this.connections = [];\n\t}\n\n\tComponent.prototype.json = function(index) {\n\t    this.properties['_json_'] = index; // remember where we are in the JSON list\n\n\t    var props = {};\n\t    for (var p in this.properties) props[p] = this.properties[p];\n\n\t    var conns = [];\n\t    for (var i = 0; i < this.connections.length; i++)\n\t\tconns.push(this.connections[i].json());\n\n\t    var json = [this.type,[this.x, this.y, this.rotation],props,conns];\n\t    return json;\n\t}\n\n\tComponent.prototype.add_connection = function(offset_x,offset_y) {\n\t    this.connections.push(new ConnectionPoint(this,offset_x,offset_y));\n\t}\n\n\tComponent.prototype.update_coords = function() {\n\t    var x = this.x;\n\t    var y = this.y;\n\n\t    // update bbox\n\t    var b = this.bounding_box;\n\t    this.bbox[0] = this.transform_x(b[0],b[1]) + x;\n\t    this.bbox[1] = this.transform_y(b[0],b[1]) + y;\n\t    this.bbox[2] = this.transform_x(b[2],b[3]) + x;\n\t    this.bbox[3] = this.transform_y(b[2],b[3]) + y;\n\t    canonicalize(this.bbox);\n\n\t    // update connections\n\t    for (var i = this.connections.length - 1; i >= 0; --i)\n\t\tthis.connections[i].update_location();\n\t}\n\n\tComponent.prototype.rotate = function(amount) {\n\t    var old_rotation = this.rotation;\n\t    this.rotation = (this.rotation + amount) % 8;\n\t    this.update_coords();\n\n\t    // create an undoable edit record here\n\t    // using old_rotation\n\t}\n\n\tComponent.prototype.move_begin = function() {\n\t    // remember where we started this move\n\t    this.move_x = this.x;\n\t    this.move_y = this.y;\n\t}\n\n\tComponent.prototype.move = function(dx,dy) {\n\t    // update coordinates\n\t    this.x += dx;\n\t    this.y += dy;\n\t    this.update_coords();\n\t}\n\n\tComponent.prototype.move_end = function() {\n\t    var dx = this.x - this.move_x;\n\t    var dy = this.y - this.move_y;\n\n\t    if (dx != 0 || dy != 0) {\n\t\t// create an undoable edit record here\n\n\t\tthis.sch.check_wires(this);\n\t    }\n\t}\n\n\tComponent.prototype.add = function(sch) {\n\t    this.sch = sch;   // we now belong to a schematic!\n\t    sch.add_component(this);\n\t    this.update_coords();\n\t}\n\n\tComponent.prototype.remove = function() {\n\t    // remove connection points from schematic\n\t    for (var i = this.connections.length - 1; i >= 0; --i) {\n\t\tvar cp = this.connections[i];\n\t\tthis.sch.remove_connection_point(cp,cp.location);\n\t    }\n\n\t    // remove component from schematic\n\t    this.sch.remove_component(this);\n\t    this.sch = undefined;\n\n\t    // create an undoable edit record here\n\t}\n\n\tComponent.prototype.transform_x = function(x,y) {\n\t    var rot = this.rotation;\n\t    if (rot == 0 || rot == 6) return x;\n\t    else if (rot == 1 || rot == 5) return -y;\n\t    else if (rot == 2 || rot == 4) return -x;\n\t    else return y;\n\t}\n\n\tComponent.prototype.transform_y = function(x,y) {\n\t    var rot = this.rotation;\n\t    if (rot == 1 || rot == 7) return x;\n\t    else if (rot == 2 || rot == 6) return -y;\n\t    else if (rot == 3 || rot == 5) return -x;\n\t    else return y;\n\t}\n\n\tComponent.prototype.moveTo = function(c,x,y) {\n\t    var nx = this.transform_x(x,y) + this.x;\n\t    var ny = this.transform_y(x,y) + this.y;\n\t    this.sch.moveTo(c,nx,ny);\n\t}\n\n\tComponent.prototype.lineTo = function(c,x,y) {\n\t    var nx = this.transform_x(x,y) + this.x;\n\t    var ny = this.transform_y(x,y) + this.y;\n\t    this.sch.lineTo(c,nx,ny);\n\t}\n\n\tComponent.prototype.draw_line = function(c,x1,y1,x2,y2) {\n\t    c.strokeStyle = this.selected ? selected_style :\n                            this.type == 'w' ? normal_style : component_style;\n\t    var nx1 = this.transform_x(x1,y1) + this.x;\n\t    var ny1 = this.transform_y(x1,y1) + this.y;\n\t    var nx2 = this.transform_x(x2,y2) + this.x;\n\t    var ny2 = this.transform_y(x2,y2) + this.y;\n\t    this.sch.draw_line(c,nx1,ny1,nx2,ny2,1);\n\t}\n\n\tComponent.prototype.draw_circle = function(c,x,y,radius,filled) {\n\t    if (filled) c.fillStyle = this.selected ? selected_style : normal_style;\n\t    else c.strokeStyle = this.selected ? selected_style :\n\t\t     this.type == 'w' ? normal_style : component_style;\n\t    var nx = this.transform_x(x,y) + this.x;\n\t    var ny = this.transform_y(x,y) + this.y;\n\n\t    this.sch.draw_arc(c,nx,ny,radius,0,2*Math.PI,false,1,filled);\n\t}\n\n    var rot_angle = [\n\t\t     0.0,\t\t// NORTH (identity)\n\t\t     Math.PI/2,\t// EAST (rot270)\n\t\t     Math.PI,\t// SOUTH (rot180)\n\t\t     3*Math.PI/2,  // WEST (rot90)\n\t\t     0.0,\t\t// RNORTH (negy)\n\t\t     Math.PI/2,\t// REAST (int-neg)\n\t\t     Math.PI,\t// RSOUTH (negx)\n\t\t     3*Math.PI/2,\t// RWEST (int-pos)\n     ];\n\n\tComponent.prototype.draw_arc = function(c,x,y,radius,start_radians,end_radians) {\n\t    c.strokeStyle = this.selected ? selected_style :\n                            this.type == 'w' ? normal_style : component_style;\n\t    var nx = this.transform_x(x,y) + this.x;\n\t    var ny = this.transform_y(x,y) + this.y;\n\t    this.sch.draw_arc(c,nx,ny,radius,\n\t\t\t      start_radians+rot_angle[this.rotation],end_radians+rot_angle[this.rotation],\n\t\t\t      false,1,false);\n\t}\n\n\tComponent.prototype.draw = function(c) {\n\t    /*\n\t    for (var i = this.connections.length - 1; i >= 0; --i) {\n\t\tvar cp = this.connections[i];\n\t\tcp.draw_x(c);\n\t    }\n\t    */\n\t}\n\n\t// result of rotating an alignment [rot*9 + align]\n    var aOrient = [\n\t\t   0, 1, 2, 3, 4, 5, 6, 7, 8,\t\t// NORTH (identity)\n\t\t   2, 5, 8, 1, 4, 7, 0, 3, 6, \t\t// EAST (rot270)\n\t\t   8, 7, 6, 5, 4, 3, 2, 1, 0,\t\t// SOUTH (rot180)\n\t\t   6, 3, 0, 7, 4, 1, 8, 5, 3,\t\t// WEST (rot90)\n\t\t   2, 1, 0, 5, 4, 3, 8, 7, 6,\t\t// RNORTH (negy)\n\t\t   8, 5, 2, 7, 4, 1, 6, 3, 0, \t\t// REAST (int-neg)\n\t\t   6, 7, 8, 3, 4, 5, 0, 1, 2,\t\t// RSOUTH (negx)\n\t\t   0, 3, 6, 1, 4, 7, 2, 5, 8\t\t// RWEST (int-pos)\n\t\t   ];\n\n    var textAlign = [\n\t\t     'left', 'center', 'right',\n\t\t     'left', 'center', 'right',\n\t\t     'left', 'center', 'right'\n\t\t     ];\n\n    var textBaseline = [\n\t\t\t'top', 'top', 'top',\n\t\t\t'middle', 'middle', 'middle',\n\t\t\t'bottom', 'bottom', 'bottom'\n\t\t\t];\n\n\tComponent.prototype.draw_text = function(c,text,x,y,alignment,size,fill) {\n\t    var a = aOrient[this.rotation*9 + alignment];\n\t    c.textAlign = textAlign[a];\n\t    c.textBaseline = textBaseline[a];\n\t    if (fill == undefined)\n\t\tc.fillStyle = this.selected ? selected_style : normal_style;\n\t    else\n\t\tc.fillStyle = fill;\n\t    this.sch.draw_text(c,text,\n\t\t\t       this.transform_x(x,y) + this.x,\n\t\t\t       this.transform_y(x,y) + this.y,\n\t\t\t       size);\n\t}\n\n\tComponent.prototype.set_select = function(which) {\n\t    if (which != this.selected) {\n\t\tthis.selected = which;\n\t\t// create an undoable edit record here\n\t    }\n\t}\n\n\tComponent.prototype.select = function(x,y,shiftKey) {\n\t    this.was_previously_selected = this.selected;\n\t    if (this.near(x,y)) {\n\t\tthis.set_select(shiftKey ? !this.selected : true);\n\t\treturn true;\n\t    } else return false;\n\t}\n\n\tComponent.prototype.select_rect = function(s) {\n\t    this.was_previously_selected = this.selected;\n\t    if (intersect(this.bbox,s))\n\t\tthis.set_select(true);\n\t}\n\n\t// if connection point of component c bisects the\n\t// wire represented by this compononent, return that\n\t// connection point.  Otherwise return null.\n\tComponent.prototype.bisect = function(c) {\n\t    return null;\n\t}\n\n\t// does mouse click fall on this component?\n\tComponent.prototype.near = function(x,y) {\n\t    return inside(this.bbox,x,y);\n\t}\n\n\tComponent.prototype.edit_properties = function(x,y) {\n\t    if (this.near(x,y)) {\n\t\t// make an <input> widget for each property\n        var fields = [];\n\t\tfor (var i in this.properties)\n\t\t    // underscore at beginning of property name => system property\n\t\t    if (i.charAt(0) != '_')\n\t\t\tfields[i] = build_input('text',10,this.properties[i]);\n\n\t\tvar content = build_table(fields);\n\t\tcontent.fields = fields;\n\t\tcontent.component = this;\n\n\t\tthis.sch.dialog('Edit Properties',content,function(content) {\n\t\t\tfor (var i in content.fields)\n\t\t\t    content.component.properties[i] = content.fields[i].value;\n\t\t\tcontent.component.sch.redraw_background();\n\t\t    });\n\t\treturn true;\n\t    } else return false;\n\t}\n\n\tComponent.prototype.clear_labels = function() {\n\t    for (var i = this.connections.length - 1; i >=0; --i) {\n\t\tthis.connections[i].clear_label();\n\t    }\n\t}\n\n\t// default action: don't propagate label\n\tComponent.prototype.propagate_label = function(label) {\n\t}\n\n\t// give components a chance to generate default labels for their connection(s)\n\t// default action: do nothing\n\tComponent.prototype.add_default_labels = function() {\n\t}\n\n\t// component should generate labels for all unlabeled connections\n\tComponent.prototype.label_connections = function() {\n\t    for (var i = this.connections.length - 1; i >=0; --i) {\n\t\tvar cp = this.connections[i];\n\t\tif (!cp.label)\n\t\t    cp.propagate_label(this.sch.get_next_label());\n\t    }\n\t}\n\n\t// default behavior: no probe info\n\tComponent.prototype.probe_info = function() { return undefined; }\n\n\t// default behavior: nothing to display for DC analysis\n\tComponent.prototype.display_current = function(c,vmap) {\n\t}\n\n\t////////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Connection point\n\t//\n\t////////////////////////////////////////////////////////////////////////////////\n\n    var connection_point_radius = 2;\n\n\tfunction ConnectionPoint(parent,x,y) {\n\t    this.parent = parent;\n\t    this.offset_x = x;\n\t    this.offset_y = y;\n\t    this.location = '';\n\t    this.update_location();\n\t    this.label = undefined;\n\t}\n\n\tConnectionPoint.prototype.toString = function() {\n\t    return '<ConnectionPoint ('+this.offset_x+','+this.offset_y+') '+this.parent.toString()+'>';\n\t}\n\n\tConnectionPoint.prototype.json = function() {\n\t    return this.label;\n\t}\n\n\tConnectionPoint.prototype.clear_label = function() {\n\t    this.label = undefined;\n\t}\n\n\tConnectionPoint.prototype.propagate_label = function(label) {\n\t    // should we check if existing label is the same?  it should be...\n\n\t    if (this.label === undefined) {\n\t\t// label this connection point\n\t\tthis.label = label;\n\n\t\t// propagate label to coincident connection points\n\t\tthis.parent.sch.propagate_label(label,this.location);\n\n\t\t// possibly label other cp's for this device?\n\t\tthis.parent.propagate_label(label);\n\t    } else if (this.label != '0' && label != '0' && this.label != label)\n\t\talert(\"Node has two conflicting labels: \"+this.label+\", \"+label);\n\t}\n\n\tConnectionPoint.prototype.update_location = function() {\n\t    // update location string which we use as a key to find coincident connection points\n\t    var old_location = this.location;\n\t    var parent = this.parent;\n\t    var nx = parent.transform_x(this.offset_x,this.offset_y) + parent.x;\n\t    var ny = parent.transform_y(this.offset_x,this.offset_y) + parent.y;\n\t    this.x = nx;\n\t    this.y = ny;\n\t    this.location = nx + ',' + ny;\n\n\t    // add ourselves to the connection list for the new location\n\t    if (parent.sch)\n\t\tparent.sch.update_connection_point(this,old_location);\n\t}\n\n\tConnectionPoint.prototype.coincident = function(x,y) {\n\t    return this.x==x && this.y==y;\n\t}\n\n\tConnectionPoint.prototype.draw = function(c,n) {\n\t    if (n != 2)\n\t\tthis.parent.draw_circle(c,this.offset_x,this.offset_y,connection_point_radius,n > 2);\n\t}\n\n\tConnectionPoint.prototype.draw_x = function(c) {\n\t    this.parent.draw_line(c,this.offset_x-2,this.offset_y-2,this.offset_x+2,this.offset_y+2,grid_style);\n\t    this.parent.draw_line(c,this.offset_x+2,this.offset_y-2,this.offset_x-2,this.offset_y+2,grid_style);\n\t}\n\n\tConnectionPoint.prototype.display_voltage = function(c,vmap) {\n\t    var v = vmap[this.label];\n\t    if (v != undefined) {\n\t\tvar label = v.toFixed(2) + 'V';\n\n\t\t// first draw some solid blocks in the background\n\t\tc.globalAlpha = 0.85;\n\t\tthis.parent.draw_text(c,'\\u2588\\u2588\\u2588',this.offset_x,this.offset_y,\n\t\t\t\t      4,annotation_size,element_style);\n\t\tc.globalAlpha = 1.0;\n\n\t\t// display the node voltage at this connection point\n\t\tthis.parent.draw_text(c,label,this.offset_x,this.offset_y,\n\t\t\t\t      4,annotation_size,annotation_style);\n\n\t\t// only display each node voltage once\n\t\tdelete vmap[this.label];\n\t    }\n\t}\n\n\t// see if three connection points are collinear\n\tfunction collinear(p1,p2,p3) {\n\t    // from http://mathworld.wolfram.com/Collinear.html\n\t    var area = p1.x*(p2.y - p3.y) + p2.x*(p3.y - p1.y) + p3.x*(p1.y - p2.y);\n\t    return area == 0;\n\t}\n\n\t////////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Wire\n\t//\n\t////////////////////////////////////////////////////////////////////////////////\n\n\tvar near_distance = 2;   // how close to wire counts as \"near by\"\n\n\tfunction Wire(x1,y1,x2,y2) {\n\t    // arbitrarily call x1,y1 the origin\n\t    Component.call(this,'w',x1,y1,0);\n\t    this.dx = x2 - x1;\n\t    this.dy = y2 - y1;\n\t    this.add_connection(0,0);\n\t    this.add_connection(this.dx,this.dy);\n\n\t    // compute bounding box (expanded slightly)\n\t    var r = [0,0,this.dx,this.dy];\n\t    canonicalize(r);\n\t    r[0] -= near_distance;\n\t    r[1] -= near_distance;\n\t    r[2] += near_distance;\n\t    r[3] += near_distance;\n\t    this.bounding_box = r;\n\t    this.update_coords();    // update bbox\n\n\t    // used in selection calculations\n\t    this.len = Math.sqrt(this.dx*this.dx + this.dy*this.dy);\n\t}\n\tWire.prototype = new Component();\n\tWire.prototype.constructor = Wire;\n\n\tWire.prototype.toString = function() {\n\t    return '<Wire ('+this.x+','+this.y+') ('+(this.x+this.dx)+','+(this.y+this.dy)+')>';\n\t}\n\n\t// return connection point at other end of wire from specified cp\n\tWire.prototype.other_end = function(cp) {\n\t    if (cp == this.connections[0]) return this.connections[1];\n\t    else if (cp == this.connections[1]) return this.connections[0];\n\t    else return undefined;\n\t}\n\n\tWire.prototype.json = function(index) {\n\t    var json = ['w',[this.x, this.y, this.x+this.dx, this.y+this.dy]];\n\t    return json;\n\t}\n\n\tWire.prototype.draw = function(c) {\n\t    this.draw_line(c,0,0,this.dx,this.dy);\n\t}\n\n\tWire.prototype.clone = function(x,y) {\n\t    return new Wire(x,y,x+this.dx,y+this.dy);\n\t}\n\n\tWire.prototype.near = function(x,y) {\n\t    // crude check: (x,y) within expanded bounding box of wire\n\t    if (inside(this.bbox,x,y)) {\n\t\t// compute distance between x,y and nearst point on line\n\t\t// http://www.allegro.cc/forums/thread/589720\n\t\tvar D = Math.abs((x - this.x)*this.dy - (y - this.y)*this.dx)/this.len;\n\t\tif (D <= near_distance) return true;\n\t    }\n\t    return false;\n\t}\n\n\t// selection rectangle selects wire only if it includes\n\t// one of the end points\n\tWire.prototype.select_rect = function(s) {\n\t    this.was_previously_selected = this.selected;\n\t    if (inside(s,this.x,this.y) || inside(s,this.x+this.dx,this.y+this.dy))\n\t\tthis.set_select(true);\n\t}\n\n\t// if connection point cp bisects the\n\t// wire represented by this compononent, return true\n\tWire.prototype.bisect_cp = function(cp) {\n\t    var x = cp.x;\n\t    var y = cp.y;\n\n\t    // crude check: (x,y) within expanded bounding box of wire\n\t    if (inside(this.bbox,x,y)) {\n\t\t// compute distance between x,y and nearst point on line\n\t\t// http://www.allegro.cc/forums/thread/589720\n\t\tvar D = Math.abs((x - this.x)*this.dy - (y - this.y)*this.dx)/this.len;\n\t\t// final check: ensure point isn't an end point of the wire\n\t\tif (D < 1 && !this.connections[0].coincident(x,y) && !this.connections[1].coincident(x,y))\n\t\t    return true;\n\t    }\n\t    return false;\n\t}\n\n\t// if some connection point of component c bisects the\n\t// wire represented by this compononent, return that\n\t// connection point.  Otherwise return null.\n\tWire.prototype.bisect = function(c) {\n\t    if (c == undefined) return;\n\t    for (var i = c.connections.length - 1; i >= 0; --i) {\n\t\tvar cp = c.connections[i];\n\t\tif (this.bisect_cp(cp)) return cp;\n\t    }\n\t    return null;\n\t}\n\n\tWire.prototype.move_end = function() {\n\t    // look for wires bisected by this wire\n\t    this.sch.check_wires(this);\n\n\t    // look for connection points that might bisect us\n\t    this.sch.check_connection_points(this);\n\t}\n\n\t// wires \"conduct\" their label to the other end\n\tWire.prototype.propagate_label = function(label) {\n\t    // don't worry about relabeling a cp, it won't recurse!\n\t    this.connections[0].propagate_label(label);\n\t    this.connections[1].propagate_label(label);\n\t}\n\n\t// Wires have no properties to edit\n\tWire.prototype.edit_properties = function(x,y) {\n\t    return false;\n\t}\n\n\t// some actual component will start the labeling of electrical nodes,\n\t// so do nothing here\n\tWire.prototype.label_connections = function() {\n\t}\n\n\t////////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Ground\n\t//\n\t////////////////////////////////////////////////////////////////////////////////\n\n\tfunction Ground(x,y,rotation) {\n\t    Component.call(this,'g',x,y,rotation);\n\t    this.add_connection(0,0);\n\t    this.bounding_box = [-6,0,6,8];\n\t    this.update_coords();\n\t}\n\tGround.prototype = new Component();\n\tGround.prototype.constructor = Ground;\n\n\tGround.prototype.toString = function() {\n\t    return '<Ground ('+this.x+','+this.y+')>';\n\t}\n\n\tGround.prototype.draw = function(c) {\n\t    Component.prototype.draw.call(this,c);   // give superclass a shot\n\t    this.draw_line(c,0,0,0,8);\n\t    this.draw_line(c,-6,8,6,8);\n\t}\n\n\tGround.prototype.clone = function(x,y) {\n\t    return new Ground(x,y,this.rotation);\n\t}\n\n\t// Grounds no properties to edit\n\tGround.prototype.edit_properties = function(x,y) {\n\t    return false;\n\t}\n\n\t// give components a chance to generate a label for their connection(s)\n\t// default action: do nothing\n\tGround.prototype.add_default_labels = function() {\n\t    this.connections[0].propagate_label('0');   // canonical label for GND node\n\t}\n\n\t////////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Label\n\t//\n\t////////////////////////////////////////////////////////////////////////////////\n\n\tfunction Label(x,y,rotation,label) {\n\t    Component.call(this,'L',x,y,rotation);\n\t    this.properties['label'] = label ? label : '???';\n\t    this.add_connection(0,0);\n\t    this.bounding_box = [-2,0,2,8];\n\t    this.update_coords();\n\t}\n\tLabel.prototype = new Component();\n\tLabel.prototype.constructor = Label;\n\n\tLabel.prototype.toString = function() {\n\t    return '<Label'+' ('+this.x+','+this.y+')>';\n\t}\n\n\tLabel.prototype.draw = function(c) {\n\t    Component.prototype.draw.call(this,c);   // give superclass a shot\n\t    this.draw_line(c,0,0,0,8);\n\t    this.draw_text(c,this.properties['label'],0,9,1,property_size);\n\t}\n\n\tLabel.prototype.clone = function(x,y) {\n\t    return new Label(x,y,this.rotation,this.properties['label']);\n\t}\n\n\t// give components a chance to generate a label for their connection(s)\n\t// default action: do nothing\n\tLabel.prototype.add_default_labels = function() {\n\t    this.connections[0].propagate_label(this.properties['label']);\n\t}\n\n\t////////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Voltage Probe\n\t//\n\t////////////////////////////////////////////////////////////////////////////////\n\n    var probe_colors = ['red','green','blue','cyan','magenta','yellow','black','x-axis'];\n    var probe_colors_rgb = {\n\t    'red': 'rgb(255,64,64)',\n\t    'green': 'rgb(64,255,64)',\n\t    'blue': 'rgb(64,64,255)',\n\t    'cyan': 'rgb(64,255,255)',\n\t    'magenta' : 'rgb(255,64,255)',\n\t    'yellow': 'rgb(255,255,64)',\n\t    'black': 'rgb(0,0,0)',\n\t    'x-axis': undefined\n\t};\n\n\tfunction Probe(x,y,rotation,color,offset) {\n\t    Component.call(this,'s',x,y,rotation);\n\t    this.add_connection(0,0);\n\t    this.properties['color'] = color ? color : 'cyan';\n\t    this.properties['offset'] = (offset==undefined || offset=='') ? '0' : offset;\n\t    this.bounding_box = [0,0,27,-21];\n\t    this.update_coords();\n\t}\n\tProbe.prototype = new Component();\n\tProbe.prototype.constructor = Probe;\n\n\tProbe.prototype.toString = function() {\n\t    return '<Probe ('+this.x+','+this.y+')>';\n\t}\n\n\tProbe.prototype.draw = function(c) {\n\t    // draw outline\n\t    this.draw_line(c,0,0,4,-4);\n\t    this.draw_line(c,2,-6,6,-2);\n\t    this.draw_line(c,2,-6,17,-21);\n\t    this.draw_line(c,6,-2,21,-17);\n\t    this.draw_line(c,17,-21,21,-17);\n\t    this.draw_arc(c,19,-11,8,3*Math.PI/2,0);\n\n\t    // fill body with plot color\n\t    var color = probe_colors_rgb[this.properties['color']];\n\t    if (color != undefined) {\n\t\tc.fillStyle = color;\n\t\tc.beginPath();\n\t\tthis.moveTo(c,2,-6);\n\t\tthis.lineTo(c,6,-2);\n\t\tthis.lineTo(c,21,-17);\n\t\tthis.lineTo(c,17,-21);\n\t\tthis.lineTo(c,2,-6);\n\t\tc.fill();\n\t    } else {\n\t\tthis.draw_text(c,this.properties['color'],27,-11,1,property_size);\n\t    }\n\t}\n\n\tProbe.prototype.clone = function(x,y) {\n\t    return new Probe(x,y,this.rotation,this.properties['color'],this.properties['offset']);\n\t}\n\n\tProbe.prototype.edit_properties = function(x,y) {\n\t    if (inside(this.bbox,x,y)) {\n        var fields = [];\n\t\tfields['Plot color'] = build_select(probe_colors,this.properties['color']);\n\t\tfields['Plot offset'] = build_input('text',10,this.properties['offset']);\n\n\t\tvar content = build_table(fields);\n\t\tcontent.fields = fields;\n\t\tcontent.component = this;\n\n\t\tthis.sch.dialog('Edit Properties',content,function(content) {\n\t\t\tvar color_choice = content.fields['Plot color'];\n\t\t\tcontent.component.properties['color'] = probe_colors[color_choice.selectedIndex];\n\t\t\tcontent.component.properties['offset'] = content.fields['Plot offset'].value;\n\t\t\tcontent.component.sch.redraw_background();\n\t\t    });\n\t\treturn true;\n\t    } else return false;\n\t}\n\n\t// return [color, node_label, offset, type] for this probe\n\tProbe.prototype.probe_info = function() {\n\t    var color = this.properties['color'];\n\t    var offset = this.properties['offset'];\n\t    if (offset==undefined || offset==\"\") offset = '0';\n\t    return [color,this.connections[0].label,offset,'voltage'];\n\t}\n\n\t////////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Ammeter Probe\n\t//\n\t////////////////////////////////////////////////////////////////////////////////\n\n\tfunction Ammeter(x,y,rotation,color,offset) {\n\t    Component.call(this,'a',x,y,rotation);\n\t    this.add_connection(0,0);   // pos\n\t    this.add_connection(16,0);   // neg\n\t    this.properties['color'] = color ? color : 'magenta';\n\t    this.properties['offset'] = (offset==undefined || offset=='') ? '0' : offset;\n\t    this.bounding_box = [-3,0,16,3];\n\t    this.update_coords();\n\t}\n\tAmmeter.prototype = new Component();\n\tAmmeter.prototype.constructor = Ammeter;\n\n\tAmmeter.prototype.toString = function() {\n\t    return '<Ammeter ('+this.x+','+this.y+')>';\n\t}\n\n\tAmmeter.prototype.move_end = function() {\n\t    Component.prototype.move_end.call(this);   // do the normal processing\n\n\t    // special for current probes: see if probe has been placed\n\t    // in the middle of wire, creating three wire segments one\n\t    // of which is shorting the two terminals of the probe.  If\n\t    // so, auto remove the shorting segment.\n\t    var e1 = this.connections[0].location;\n\t    var e2 = this.connections[1].location;\n\t    var cplist = this.sch.find_connections(this.connections[0]);\n\t    for (var i = cplist.length - 1; i >= 0; --i) {\n\t\tvar c = cplist[i].parent;  // a component connected to ammeter terminal\n\t\t// look for a wire whose end points match those of the ammeter\n\t\tif (c.type == 'w') {\n\t\t    var c_e1 = c.connections[0].location;\n\t\t    var c_e2 = c.connections[1].location;\n\t\t    if ((e1 == c_e1 && c2 == c_e2) || (e1 == c_e2 && e2 == c_e1)) {\n\t\t\tc.remove();\n\t\t\tbreak;\n\t\t    }\n\t\t}\n\t    }\n\t}\n\n\tAmmeter.prototype.draw = function(c) {\n\t    this.draw_line(c,0,0,16,0);\n\n\t    // draw chevron in probe color\n\t    c.strokeStyle = probe_colors_rgb[this.properties['color']];\n\t    if (c.strokeStyle != undefined) {\n\t\tc.beginPath();\n\t\tthis.moveTo(c,6,-3);\n\t\tthis.lineTo(c,10,0);\n\t\tthis.lineTo(c,6,3);\n\t\tc.stroke();\n\t    }\n\t}\n\n\tAmmeter.prototype.clone = function(x,y) {\n\t    return new Ammeter(x,y,this.rotation,this.properties['color'],this.properties['offset']);\n\t}\n\n\t// share code with voltage probe\n\tAmmeter.prototype.edit_properties = Probe.prototype.edit_properties;\n\n\tAmmeter.prototype.label = function() {\n\t    var name = this.properties['name'];\n\t    var label = 'I(' + (name ? name : '_' + this.properties['_json_']) + ')';\n\t    return label;\n\t}\n\n\t// display current for DC analysis\n\tAmmeter.prototype.display_current = function(c,vmap) {\n\t    var label = this.label();\n\t    var v = vmap[label];\n\t    if (v != undefined) {\n\t\tvar i = engineering_notation(v,2) + 'A';\n\t\tthis.draw_text(c,i,8,-5,7,annotation_size,annotation_style);\n\n\t\t// only display each current once\n\t\tdelete vmap[label];\n\t    }\n\t}\n\n\t// return [color, current_label, offset, type] for this probe\n\tAmmeter.prototype.probe_info = function() {\n\t    var color = this.properties['color'];\n\t    var offset = this.properties['offset'];\n\t    if (offset==undefined || offset==\"\") offset = '0';\n\t    return [color,this.label(),offset,'current'];\n\t}\n\n\t////////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Resistor\n\t//\n\t////////////////////////////////////////////////////////////////////////////////\n\n\tfunction Resistor(x,y,rotation,name,r) {\n\t    Component.call(this,'r',x,y,rotation);\n\t    this.properties['name'] = name;\n\t    this.properties['r'] = r ? r : '1';\n\t    this.add_connection(0,0);\n\t    this.add_connection(0,48);\n\t    this.bounding_box = [-5,0,5,48];\n\t    this.update_coords();\n\t}\n\tResistor.prototype = new Component();\n\tResistor.prototype.constructor = Resistor;\n\n\tResistor.prototype.toString = function() {\n\t    return '<Resistor '+this.properties['r']+' ('+this.x+','+this.y+')>';\n\t}\n\n\tResistor.prototype.draw = function(c) {\n\t    Component.prototype.draw.call(this,c);   // give superclass a shot\n\t    this.draw_line(c,0,0,0,12);\n\t    this.draw_line(c,0,12,4,14);\n\t    this.draw_line(c,4,14,-4,18);\n\t    this.draw_line(c,-4,18,4,22);\n\t    this.draw_line(c,4,22,-4,26);\n\t    this.draw_line(c,-4,26,4,30);\n\t    this.draw_line(c,4,30,-4,34);\n\t    this.draw_line(c,-4,34,0,36);\n\t    this.draw_line(c,0,36,0,48);\n\t    if (this.properties['r'])\n\t\tthis.draw_text(c,this.properties['r']+'\\u03A9',5,24,3,property_size);\n\t    if (this.properties['name'])\n\t\tthis.draw_text(c,this.properties['name'],-5,24,5,property_size);\n\t}\n\n\tResistor.prototype.clone = function(x,y) {\n\t    return new Resistor(x,y,this.rotation,this.properties['name'],this.properties['r']);\n\t}\n\n\t////////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Capacitor\n\t//\n\t////////////////////////////////////////////////////////////////////////////////\n\n\tfunction Capacitor(x,y,rotation,name,c) {\n\t    Component.call(this,'c',x,y,rotation);\n\t    this.properties['name'] = name;\n\t    this.properties['c'] = c ? c : '1p';\n\t    this.add_connection(0,0);\n\t    this.add_connection(0,48);\n\t    this.bounding_box = [-8,0,8,48];\n\t    this.update_coords();\n\t}\n\tCapacitor.prototype = new Component();\n\tCapacitor.prototype.constructor = Capacitor;\n\n\tCapacitor.prototype.toString = function() {\n\t    return '<Capacitor '+this.properties['r']+' ('+this.x+','+this.y+')>';\n\t}\n\n\tCapacitor.prototype.draw = function(c) {\n\t    Component.prototype.draw.call(this,c);   // give superclass a shot\n\t    this.draw_line(c,0,0,0,22);\n\t    this.draw_line(c,-8,22,8,22);\n\t    this.draw_line(c,-8,26,8,26);\n\t    this.draw_line(c,0,26,0,48);\n\t    if (this.properties['c'])\n\t\tthis.draw_text(c,this.properties['c']+'F',9,24,3,property_size);\n\t    if (this.properties['name'])\n\t\tthis.draw_text(c,this.properties['name'],-9,24,5,property_size);\n\t}\n\n\tCapacitor.prototype.clone = function(x,y) {\n\t    return new Capacitor(x,y,this.rotation,this.properties['name'],this.properties['c']);\n\t}\n\n\t////////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Inductor\n\t//\n\t////////////////////////////////////////////////////////////////////////////////\n\n\tfunction Inductor(x,y,rotation,name,l) {\n\t    Component.call(this,'l',x,y,rotation);\n\t    this.properties['name'] = name;\n\t    this.properties['l'] = l ? l : '1n';\n\t    this.add_connection(0,0);\n\t    this.add_connection(0,48);\n\t    this.bounding_box = [-4,0,5,48];\n\t    this.update_coords();\n\t}\n\tInductor.prototype = new Component();\n\tInductor.prototype.constructor = Inductor;\n\n\tInductor.prototype.toString = function() {\n\t    return '<Inductor '+this.properties['l']+' ('+this.x+','+this.y+')>';\n\t}\n\n\tInductor.prototype.draw = function(c) {\n\t    Component.prototype.draw.call(this,c);   // give superclass a shot\n\t    this.draw_line(c,0,0,0,14);\n\t    this.draw_arc(c,0,18,4,6*Math.PI/4,3*Math.PI/4);\n\t    this.draw_arc(c,0,24,4,5*Math.PI/4,3*Math.PI/4);\n\t    this.draw_arc(c,0,30,4,5*Math.PI/4,2*Math.PI/4);\n\t    this.draw_line(c,0,34,0,48);\n\n\t    if (this.properties['l'])\n\t\tthis.draw_text(c,this.properties['l']+'H',6,24,3,property_size);\n\t    if (this.properties['name'])\n\t\tthis.draw_text(c,this.properties['name'],-3,24,5,property_size);\n\t}\n\n\tInductor.prototype.clone = function(x,y) {\n\t    return new Inductor(x,y,this.rotation,this.properties['name'],this.properties['l']);\n\t}\n\n\t////////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Diode\n\t//\n\t////////////////////////////////////////////////////////////////////////////////\n\n\tvar diode_types = ['normal','ideal'];\n\n\tfunction Diode(x,y,rotation,name,area,type) {\n\t    Component.call(this,'d',x,y,rotation);\n\t    this.properties['name'] = name;\n\t    this.properties['area'] = area ? area : '1';\n\t    this.properties['type'] = type ? type : 'normal';\n\t    this.add_connection(0,0);   // anode\n\t    this.add_connection(0,48);  // cathode\n\t    this.bounding_box = (type == 'ideal') ? [-12,0,12,48] : [-8,0,8,48];\n\t    this.update_coords();\n\t}\n\tDiode.prototype = new Component();\n\tDiode.prototype.constructor = Diode;\n\n\tDiode.prototype.toString = function() {\n\t    return '<Diode '+this.properties['area']+' ('+this.x+','+this.y+')>';\n\t}\n\n\tDiode.prototype.draw = function(c) {\n\t    Component.prototype.draw.call(this,c);   // give superclass a shot\n\t    this.draw_line(c,0,0,0,16);\n\t    this.draw_line(c,-8,16,8,16);\n\t    this.draw_line(c,-8,16,0,32);\n\t    this.draw_line(c,8,16,0,32);\n\t    this.draw_line(c,-8,32,8,32);\n\t    this.draw_line(c,0,32,0,48);\n\n\t    if (this.properties['type'] == 'ideal') {\n\t\t// put a box around an ideal diode\n\t\tthis.draw_line(c,-10,12,10,12);\n\t\tthis.draw_line(c,-10,12,-10,36);\n\t\tthis.draw_line(c,10,12,10,36);\n\t\tthis.draw_line(c,-10,36,10,36);\n\t    }\n\n\t    if (this.properties['area'])\n\t\tthis.draw_text(c,this.properties['area'],10,24,3,property_size);\n\t    if (this.properties['name'])\n\t\tthis.draw_text(c,this.properties['name'],-10,24,5,property_size);\n\t}\n\n\tDiode.prototype.clone = function(x,y) {\n\t    return new Diode(x,y,this.rotation,this.properties['name'],this.properties['area'],this.properties['type']);\n\t}\n\n\tDiode.prototype.edit_properties = function(x,y) {\n\t    if (inside(this.bbox,x,y)) {\n            var fields = [];\n\t\tfields['name'] = build_input('text',10,this.properties['name']);\n\t\tfields['area'] = build_input('text',10,this.properties['area']);\n\t\tfields['type'] = build_select(diode_types,this.properties['type']);\n\n\t\tvar content = build_table(fields);\n\t\tcontent.fields = fields;\n\t\tcontent.component = this;\n\n\t\tthis.sch.dialog('Edit Properties',content,function(content) {\n\t\t\tcontent.component.properties['name'] = content.fields['name'].value;\n\t\t\tcontent.component.properties['area'] = content.fields['area'].value;\n\t\t\tcontent.component.properties['type'] = diode_types[content.fields['type'].selectedIndex];\n\t\t\tcontent.component.sch.redraw_background();\n\t\t    });\n\t\treturn true;\n\t    } else return false;\n\t}\n\n\t////////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  N-channel Mosfet\n\t//\n\t////////////////////////////////////////////////////////////////////////////////\n\n\tfunction NFet(x,y,rotation,name,w_over_l) {\n\t    Component.call(this,'n',x,y,rotation);\n\t    this.properties['name'] = name;\n\t    this.properties['W/L'] = w_over_l ? w_over_l : '2';\n\t    this.add_connection(0,0);   // drain\n\t    this.add_connection(-24,24);  // gate\n\t    this.add_connection(0,48);  // source\n\t    this.bounding_box = [-24,0,8,48];\n\t    this.update_coords();\n\t}\n\tNFet.prototype = new Component();\n\tNFet.prototype.constructor = NFet;\n\n\tNFet.prototype.toString = function() {\n\t    return '<NFet '+this.properties['W/L']+' ('+this.x+','+this.y+')>';\n\t}\n\n\tNFet.prototype.draw = function(c) {\n\t    Component.prototype.draw.call(this,c);   // give superclass a shot\n\t    this.draw_line(c,0,0,0,16);\n\t    this.draw_line(c,-8,16,0,16);\n\t    this.draw_line(c,-8,16,-8,32);\n\t    this.draw_line(c,-8,32,0,32);\n\t    this.draw_line(c,0,32,0,48);\n\t    this.draw_line(c,-24,24,-12,24);\n\t    this.draw_line(c,-12,16,-12,32);\n\n\t    var dim = this.properties['W/L'];\n\t    if (this.properties['name']) {\n\t\tthis.draw_text(c,this.properties['name'],2,22,6,property_size);\n\t\tthis.draw_text(c,dim,2,26,0,property_size);\n\t    } else\n\t\tthis.draw_text(c,dim,2,24,3,property_size);\n\t}\n\n\tNFet.prototype.clone = function(x,y) {\n\t    return new NFet(x,y,this.rotation,this.properties['name'],this.properties['W/L']);\n\t}\n\n\t////////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  P-channel Mosfet\n\t//\n\t////////////////////////////////////////////////////////////////////////////////\n\n\tfunction PFet(x,y,rotation,name,w_over_l) {\n\t    Component.call(this,'p',x,y,rotation);\n\t    this.properties['name'] = name;\n\t    this.properties['W/L'] = w_over_l ? w_over_l : '2';\n\t    this.add_connection(0,0);   // drain\n\t    this.add_connection(-24,24);  // gate\n\t    this.add_connection(0,48);  // source\n\t    this.bounding_box = [-24,0,8,48];\n\t    this.update_coords();\n\t}\n\tPFet.prototype = new Component();\n\tPFet.prototype.constructor = PFet;\n\n\tPFet.prototype.toString = function() {\n\t    return '<PFet '+this.properties['W/L']+' ('+this.x+','+this.y+')>';\n\t}\n\n\tPFet.prototype.draw = function(c) {\n\t    Component.prototype.draw.call(this,c);   // give superclass a shot\n\t    this.draw_line(c,0,0,0,16);\n\t    this.draw_line(c,-8,16,0,16);\n\t    this.draw_line(c,-8,16,-8,32);\n\t    this.draw_line(c,-8,32,0,32);\n\t    this.draw_line(c,0,32,0,48);\n\t    this.draw_line(c,-24,24,-16,24);\n\t    this.draw_circle(c,-14,24,2,false);\n\t    this.draw_line(c,-12,16,-12,32);\n\n\t    var dim = this.properties['W/L'];\n\t    if (this.properties['name']) {\n\t\tthis.draw_text(c,this.properties['name'],2,22,6,property_size);\n\t\tthis.draw_text(c,dim,2,26,0,property_size);\n\t    } else\n\t\tthis.draw_text(c,dim,2,24,3,property_size);\n\t}\n\n\tPFet.prototype.clone = function(x,y) {\n\t    return new PFet(x,y,this.rotation,this.properties['name'],this.properties['W/L']);\n\t}\n\n\t////////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Op Amp\n\t//\n\t////////////////////////////////////////////////////////////////////////////////\n\n\tfunction OpAmp(x,y,rotation,name,A) {\n\t    Component.call(this,'o',x,y,rotation);\n\t    this.properties['name'] = name;\n\t    this.properties['A'] = A ? A : '30000';\n\t    this.add_connection(0,0);   // +\n\t    this.add_connection(0,16);  // -\n\t    this.add_connection(48,8);  // output\n\t    this.add_connection(24,32);  // ground\n\t    this.bounding_box = [0,-8,48,32];\n\t    this.update_coords();\n\t}\n\tOpAmp.prototype = new Component();\n\tOpAmp.prototype.constructor = OpAmp;\n\n\tOpAmp.prototype.toString = function() {\n\t    return '<OpAmp'+this.properties['A']+' ('+this.x+','+this.y+')>';\n\t}\n\n\tOpAmp.prototype.draw = function(c) {\n\t    Component.prototype.draw.call(this,c);   // give superclass a shot\n\t    // triangle\n\t    this.draw_line(c,8,-8,8,24);\n\t    this.draw_line(c,8,-8,40,8);\n\t    this.draw_line(c,8,24,40,8);\n\t    // inputs and output\n\t    this.draw_line(c,0,0,8,0);\n\t    this.draw_line(c,0,16,8,16);\n\t    this.draw_text(c,'gnd',37,18,property_size);\n\t    this.draw_line(c,40,8,48,8);\n\t    this.draw_line(c,24,16,24,32);\n\t    // + and -\n\t    this.draw_line(c,10,0,16,0);\n\t    this.draw_line(c,13,-3,13,3);\n\t    this.draw_line(c,10,16,16,16);\n\n\t    if (this.properties['name'])\n\t\tthis.draw_text(c,this.properties['name'],32,16,0,property_size);\n\t}\n\n\tOpAmp.prototype.clone = function(x,y) {\n\t    return new OpAmp(x,y,this.rotation,this.properties['name'],this.properties['A']);\n\t}\n\n\t////////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Source\n\t//\n\t////////////////////////////////////////////////////////////////////////////////\n\n\tfunction Source(x,y,rotation,name,type,value) {\n\t    Component.call(this,type,x,y,rotation);\n\t    this.properties['name'] = name;\n\t    if (value == undefined) value = 'dc(1)';\n\t    this.properties['value'] = value;\n\t    this.add_connection(0,0);\n\t    this.add_connection(0,48);\n\t    this.bounding_box = [-12,0,12,48];\n\t    this.update_coords();\n\t    this.content = document.createElement('div');  // used by edit_properties\n\t}\n\tSource.prototype = new Component();\n\tSource.prototype.constructor = Source;\n\n\tSource.prototype.toString = function() {\n\t    return '<'+this.type+'source '+this.properties['params']+' ('+this.x+','+this.y+')>';\n\t}\n\n\tSource.prototype.draw = function(c) {\n\t    Component.prototype.draw.call(this,c);   // give superclass a shot\n\t    this.draw_line(c,0,0,0,12);\n\t    this.draw_circle(c,0,24,12,false);\n\t    this.draw_line(c,0,36,0,48);\n\n\t    if (this.type == 'v') {  // voltage source\n\t\t// draw + and -\n\t\tthis.draw_line(c,0,15,0,21);\n\t\tthis.draw_line(c,-3,18,3,18);\n\t\tthis.draw_line(c,-3,30,3,30);\n\t    } else if (this.type == 'i') {  // current source\n\t\t// draw arrow: pos to neg\n\t\tthis.draw_line(c,0,15,0,32);\n\t\tthis.draw_line(c,-3,26,0,32);\n\t\tthis.draw_line(c,3,26,0,32);\n\t    }\n\n\t    if (this.properties['name'])\n\t\tthis.draw_text(c,this.properties['name'],-13,24,5,property_size);\n\t    if (this.properties['value'])\n\t\tthis.draw_text(c,this.properties['value'],13,24,3,property_size);\n\t}\n\n\t// map source function name to labels for each source parameter\n\tvar source_functions = {\n\t    'dc': ['DC value'],\n\n\t    'impulse': ['Height',\n\t\t\t'Width (secs)'],\n\n\t    'step': ['Initial value',\n\t\t     'Plateau value',\n\t\t     'Delay until step (secs)',\n\t\t     'Rise time (secs)'],\n\n\t    'square': ['Initial value',\n\t\t       'Plateau value',\n\t\t       'Frequency (Hz)',\n\t\t       'Duty cycle (%)'],\n\n\t    'triangle': ['Initial value',\n\t\t\t 'Plateau value',\n\t\t\t 'Frequency (Hz)'],\n\n\t    'pwl': ['Comma-separated list of alternating times and values'],\n\n\t    'pwl_repeating': ['Comma-separated list of alternating times and values'],\n\n\t    'pulse': ['Initial value',\n\t\t      'Plateau value',\n\t\t      'Delay until pulse (secs)',\n\t\t      'Time for first transition (secs)',\n\t\t      'Time for second transition (secs)',\n\t\t      'Pulse width (secs)',\n\t\t      'Period (secs)'],\n\n\t    'sin': ['Offset value',\n\t\t    'Amplitude',\n\t\t    'Frequency (Hz)',\n\t\t    'Delay until sin starts (secs)',\n\t\t    'Phase offset (degrees)']\n\t}\n\n\t// build property editor div\n\tSource.prototype.build_content = function(src) {\n\t    // make an <input> widget for each property\n\t    var fields = []\n\t    fields['name'] = build_input('text',10,this.properties['name']);\n\n\t    if (src == undefined) {\n\t\tfields['value'] = this.properties['value'];\n\t    } else {\n\t\t// fancy version: add select tag for source type\n\t\tvar src_types = [];\n\t\tfor (var t in source_functions) src_types.push(t);\n\t\tvar type_select = build_select(src_types,src.fun);\n\t\ttype_select.component = this;\n\t\ttype_select.addEventListener('change',source_type_changed,false)\n\t\tfields['type'] = type_select;\n\n\t\tif (src.fun == 'pwl' || src.run == 'pwl_repeating') {\n\t\t    var v = '';\n\t\t    var first = true;\n\t\t    for (var i = 0; i < src.args.length; i++) {\n\t\t\tif (first) first = false;\n\t\t\telse v += ',';\n\t\t\tv += engineering_notation(src.args[i],3);\n\t\t\tif (i % 2 == 0) v += 's';\n\t\t    }\n\t\t    fields[source_functions[src.fun][0]] = build_input('text',30,v);\n\t\t} else {\n\t\t    // followed separate input tag for each parameter\n\t\t    var labels = source_functions[src.fun];\n\t\t    for (var i = 0; i < labels.length; i++) {\n\t\t\tvar v = engineering_notation(src.args[i],3);\n\t\t\tfields[labels[i]] = build_input('text',10,v);\n\t\t    }\n\t\t}\n\t    }\n\n\t    var div = this.content;\n\t    if (div.hasChildNodes())\n\t\tdiv.removeChild(div.firstChild);  // remove table of input fields\n\t    div.appendChild(build_table(fields));\n\t    div.fields = fields;\n\t    div.component = this;\n\t    return div;\n\t}\n\n\tfunction source_type_changed(event) {\n\t    if (!event) event = window.event;\n\t    var select = (window.event) ? event.srcElement : event.target;\n\n\t    // see where to get source parameters from\n\t    var type = select.options[select.selectedIndex].value;\n\t    var src = undefined;\n\t    if (this.src != undefined && type == this.src.fun)\n\t\tsrc = this.src;\n\t    else if (typeof cktsim != 'undefined')\n\t\tsrc = cktsim.parse_source(type+'()');\n\n\t    select.component.build_content(src);\n\t}\n\n\tSource.prototype.edit_properties = function(x,y) {\n\t    if (this.near(x,y)) {\n\t\tthis.src = undefined;\n\t\tif (typeof cktsim != 'undefined')\n\t\t    this.src = cktsim.parse_source(this.properties['value']);\n\t\tvar content = this.build_content(this.src);\n\n\t\tthis.sch.dialog('Edit Properties',content,function(content) {\n\t\t\tvar c = content.component;\n\t\t\tvar fields = content.fields;\n\n\t\t\tvar first = true;\n\t\t\tvar value = '';\n\t\t\tfor (var label in fields) {\n\t\t\t    if (label == 'name')\n\t\t\t\tc.properties['name'] = fields['name'].value;\n\t\t\t    else if (label == 'value')  {\n\t\t\t\t// if unknown source type\n\t\t\t\tvalue = fields['value'].value;\n\t\t\t\tc.sch.redraw_background();\n\t\t\t\treturn;\n\t\t\t    } else if (label == 'type') {\n\t\t\t\tvar select = fields['type'];\n\t\t\t\tvalue = select.options[select.selectedIndex].value + '(';\n\t\t\t    } else {\n\t\t\t\tif (first) first = false;\n\t\t\t\telse value += ',';\n\t\t\t\tvalue += fields[label].value;\n\t\t\t    }\n\t\t\t}\n\t\t\tc.properties['value'] = value + ')';\n\t\t\tc.sch.redraw_background();\n\t\t    });\n\t\treturn true;\n\t    } else return false;\n\t}\n\n\tfunction VSource(x,y,rotation,name,value) {\n\t    Source.call(this,x,y,rotation,name,'v',value);\n\t    this.type = 'v';\n\t}\n\tVSource.prototype = new Component();\n\tVSource.prototype.constructor = VSource;\n\tVSource.prototype.toString = Source.prototype.toString;\n\tVSource.prototype.draw = Source.prototype.draw;\n\tVSource.prototype.clone = Source.prototype.clone;\n\tVSource.prototype.build_content = Source.prototype.build_content;\n\tVSource.prototype.edit_properties = Source.prototype.edit_properties;\n\n\t// display current for DC analysis\n\tVSource.prototype.display_current = function(c,vmap) {\n\t    var name = this.properties['name'];\n\t    var label = 'I(' + (name ? name : '_' + this.properties['_json_']) + ')';\n\t    var v = vmap[label];\n\t    if (v != undefined) {\n\t\t// first draw some solid blocks in the background\n\t\tc.globalAlpha = 0.5;\n\t\tthis.draw_text(c,'\\u2588\\u2588\\u2588',-8,8,4,annotation_size,element_style);\n\t\tc.globalAlpha = 1.0;\n\n\t\t// display the element current\n\t\tvar i = engineering_notation(v,2) + 'A';\n\t\tthis.draw_text(c,i,-3,5,5,annotation_size,annotation_style);\n\t\t// draw arrow for current\n\t\tthis.draw_line(c,-3,4,0,8);\n\t\tthis.draw_line(c,3,4,0,8);\n\t\t// only display each current once\n\t\tdelete vmap[label];\n\t    }\n\t}\n\n\tVSource.prototype.clone = function(x,y) {\n\t    return new VSource(x,y,this.rotation,this.properties['name'],this.properties['value']);\n\t}\n\n\tfunction ISource(x,y,rotation,name,value) {\n\t    Source.call(this,x,y,rotation,name,'i',value);\n\t    this.type = 'i';\n\t}\n\tISource.prototype = new Component();\n\tISource.prototype.constructor = ISource;\n\tISource.prototype.toString = Source.prototype.toString;\n\tISource.prototype.draw = Source.prototype.draw;\n\tISource.prototype.clone = Source.prototype.clone;\n\tISource.prototype.build_content = Source.prototype.build_content;\n\tISource.prototype.edit_properties = Source.prototype.edit_properties;\n\n\tISource.prototype.clone = function(x,y) {\n\t    return new ISource(x,y,this.rotation,this.properties['name'],this.properties['value']);\n\t}\n\n\t///////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  JQuery slider support for setting a component value\n\t//\n\t///////////////////////////////////////////////////////////////////////////////\n\n\tfunction component_slider(event,ui) {\n\t    var sname = $(this).slider(\"option\",\"schematic\");\n\n\t    // set value of specified component\n\t    var cname = $(this).slider(\"option\",\"component\");\n\t    var pname = $(this).slider(\"option\",\"property\");\n\t    var suffix = $(this).slider(\"option\",\"suffix\");\n\t    if (typeof suffix != \"string\") suffix = \"\";\n\n\t    var v = ui.value;\n\t    $(this).slider(\"value\",v);  // move slider's indicator\n\n\t    var choices = $(this).slider(\"option\",\"choices\");\n\t    if (choices instanceof Array) v = choices[v];\n\n\t    // selector may match several schematics\n\t    $(\".\" + sname).each(function(index,element) {\n\t\t    element.schematic.set_property(cname,pname,v.toString() + suffix);\n\t\t})\n\n\t    // perform requested analysis\n\t    var analysis = $(this).slider(\"option\",\"analysis\");\n\t    if (analysis == \"dc\")\n\t\t$(\".\" + sname).each(function(index,element) {\n\t\t\telement.schematic.dc_analysis();\n\t\t    })\n\n\t    return false;\n\t}\n\n\t///////////////////////////////////////////////////////////////////////////////\n\t//\n\t//  Module definition\n\t//\n\t///////////////////////////////////////////////////////////////////////////////\n\n\tvar module = {\n\t    'Schematic': Schematic,\n\t    'component_slider': component_slider\n\t}\n\treturn module;\n}());\n\n}.call(window));\n\n\n// WEBPACK FOOTER //\n// ./common/static/xmodule/modules/js/005-24473527e489aa133bd57ca2ab10c21b.js","(function() { module.exports = window[\"jQuery\"]; }());\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jQuery\"\n// module id = 0\n// module chunks = 3 4 5 6 9 10 11 13 14 15 16 17 18 19 20 21 23 24 25 26 27 28 29 30 31 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 84","(function() { module.exports = window[\"_\"]; }());\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"_\"\n// module id = 1\n// module chunks = 3 4 5 6 9 10 11 14 15 16 18 19 20 21 23 24 25 26 27 28 29 30 31 34 35 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75"],"sourceRoot":""}